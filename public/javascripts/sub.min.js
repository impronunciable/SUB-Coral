!function(a,b){return"function"==typeof define&&define.amd?void define("angular-file-upload",["angular"],function(a){return b(a)}):b(a)}(angular||null,function(a){var b=a.module("angularFileUpload",[]);return b.directive("ngFileDrop",["$fileUploader",function(b){"use strict";return{link:b.isHTML5?function(a,b,c){b.bind("drop",function(b){var d=b.dataTransfer?b.dataTransfer:b.originalEvent.dataTransfer;d&&(b.preventDefault(),b.stopPropagation(),a.$broadcast("file:removeoverclass"),a.$emit("file:add",d.files,a.$eval(c.ngFileDrop)))}).bind("dragover",function(b){var c=b.dataTransfer?b.dataTransfer:b.originalEvent.dataTransfer;b.preventDefault(),b.stopPropagation(),c.dropEffect="copy",a.$broadcast("file:addoverclass")}).bind("dragleave",function(){a.$broadcast("file:removeoverclass")})}:a.noop}}]),b.directive("ngFileOver",function(){"use strict";return{link:function(a,b,c){a.$on("file:addoverclass",function(){b.addClass(c.ngFileOver||"ng-file-over")}),a.$on("file:removeoverclass",function(){b.removeClass(c.ngFileOver||"ng-file-over")})}}}),b.directive("ngFileSelect",["$fileUploader",function(a){"use strict";return{link:function(b,c,d){a.isHTML5||c.removeAttr("multiple"),c.bind("change",function(){b.$emit("file:add",a.isHTML5?this.files:this,b.$eval(d.ngFileSelect)),a.isHTML5&&c.attr("multiple")&&c.prop("value",null)}),c.prop("value",null)}}}]),b.factory("$fileUploader",["$compile","$rootScope","$http","$window",function(b,c,d,e){"use strict";function f(b){a.extend(this,{scope:c,url:"/",alias:"file",queue:[],headers:{},progress:null,autoUpload:!1,removeAfterUpload:!1,method:"POST",filters:[],formData:[],isUploading:!1,_nextIndex:0,_timestamp:Date.now()},b),this.filters.unshift(this._filter),this.scope.$on("file:add",function(a,b,c){a.stopPropagation(),this.addToQueue(b,c)}.bind(this)),this.bind("beforeupload",g.prototype._beforeupload),this.bind("in:progress",g.prototype._progress),this.bind("in:success",g.prototype._success),this.bind("in:cancel",g.prototype._cancel),this.bind("in:error",g.prototype._error),this.bind("in:complete",g.prototype._complete),this.bind("in:progress",this._progress),this.bind("in:complete",this._complete)}function g(c){if(!f.prototype.isHTML5){var d=a.element(c.file),e=b(d.clone())(c.uploader.scope),g=d.val();c.file={lastModifiedDate:null,size:null,type:"like/"+g.slice(g.lastIndexOf(".")+1).toLowerCase(),name:g.slice(g.lastIndexOf("/")+g.lastIndexOf("\\")+2)},c._input=d,e.prop("value",null),d.css("display","none").after(e)}a.extend(this,{isReady:!1,isUploading:!1,isUploaded:!1,isSuccess:!1,isCancel:!1,isError:!1,progress:null,index:null},c)}return f.prototype={constructor:f,_filter:function(b){return a.isElement(b)?!0:!!b.size},bind:function(a,b){return this.scope.$on(this._timestamp+":"+a,b.bind(this))},trigger:function(a,b){arguments[0]=this._timestamp+":"+a,this.scope.$broadcast.apply(this.scope,arguments)},isHTML5:!(!e.File||!e.FormData),isCanvasSupported:!(!e.FileReader||!e.CanvasRenderingContext2D),addToQueue:function(b,c){var d=this.queue.length,e="length"in b?b:[b];a.forEach(e,function(b){var d=this.filters.length?this.filters.every(function(a){return a.call(this,b)},this):!0;if(d){var e=new g(a.extend({url:this.url,alias:this.alias,headers:a.copy(this.headers),formData:a.copy(this.formData),removeAfterUpload:this.removeAfterUpload,method:this.method,uploader:this,file:b},c));this.queue.push(e),this.trigger("afteraddingfile",e)}},this),this.queue.length!==d&&(this.trigger("afteraddingall",this.queue),this.progress=this._getTotalProgress()),this._render(),this.autoUpload&&this.uploadAll()},removeFromQueue:function(a){var b=this.getIndexOfItem(a),c=this.queue[b];c.isUploading&&c.cancel(),this.queue.splice(b,1),c._destroy(),this.progress=this._getTotalProgress()},clearQueue:function(){this.queue.forEach(function(a){a.isUploading&&a.cancel(),a._destroy()},this),this.queue.length=0,this.progress=0},getIndexOfItem:function(b){return a.isObject(b)?this.queue.indexOf(b):b},getNotUploadedItems:function(){return this.queue.filter(function(a){return!a.isUploaded})},getReadyItems:function(){return this.queue.filter(function(a){return a.isReady&&!a.isUploading}).sort(function(a,b){return a.index-b.index})},uploadItem:function(a){var b=this.getIndexOfItem(a),c=this.queue[b],d=this.isHTML5?"_xhrTransport":"_iframeTransport";c.index=c.index||this._nextIndex++,c.isReady=!0,this.isUploading||(this.isUploading=!0,this[d](c))},cancelItem:function(a){var b=this.getIndexOfItem(a),c=this.queue[b],d=this.isHTML5?"_xhr":"_form";c[d]&&c[d].abort()},editItem:function(a){console.log(a)},uploadAll:function(){var a=this.getNotUploadedItems().filter(function(a){return!a.isUploading});a.forEach(function(a){a.index=a.index||this._nextIndex++,a.isReady=!0},this),a.length&&this.uploadItem(a[0])},cancelAll:function(){this.getNotUploadedItems().forEach(function(a){this.cancelItem(a)},this)},_render:function(){this.scope.$$phase||this.scope.$digest()},_getTotalProgress:function(a){if(this.removeAfterUpload)return a||0;var b=this.getNotUploadedItems().length,c=b?this.queue.length-b:this.queue.length,d=100/this.queue.length,e=(a||0)*d/100;return Math.round(c*d+e)},_progress:function(a,b,c){var d=this._getTotalProgress(c);this.trigger("progressall",d),this.progress=d,this._render()},_complete:function(){var b=this.getReadyItems()[0];return this.isUploading=!1,a.isDefined(b)?void this.uploadItem(b):(this.trigger("completeall",this.queue),this.progress=this._getTotalProgress(),void this._render())},_xhrTransport:function(b){var c=b._xhr=new XMLHttpRequest,d=new FormData,e=this;this.trigger("beforeupload",b),b.formData.forEach(function(b){a.forEach(b,function(a,b){d.append(b,a)})}),d.append(b.alias,b.file),c.upload.onprogress=function(a){var c=a.lengthComputable?100*a.loaded/a.total:0;e.trigger("in:progress",b,Math.round(c))},c.onload=function(){var a=e._transformResponse(c.response),d=e._isSuccessCode(c.status)?"success":"error";e.trigger("in:"+d,c,b,a),e.trigger("in:complete",c,b,a)},c.onerror=function(){e.trigger("in:error",c,b),e.trigger("in:complete",c,b)},c.onabort=function(){e.trigger("in:cancel",c,b),e.trigger("in:complete",c,b)},c.open(b.method,b.url,!0),a.forEach(b.headers,function(a,b){c.setRequestHeader(b,a)}),c.send(d)},_iframeTransport:function(b){var c=a.element('<form style="display: none;" />'),d=a.element('<iframe name="iframeTransport'+Date.now()+'">'),e=b._input,f=this;b._form&&b._form.replaceWith(e),b._form=c,this.trigger("beforeupload",b),e.prop("name",b.alias),b.formData.forEach(function(b){a.forEach(b,function(b,d){c.append(a.element('<input type="hidden" name="'+d+'" value="'+b+'" />'))})}),c.prop({action:b.url,method:b.method,target:d.prop("name"),enctype:"multipart/form-data",encoding:"multipart/form-data"}),d.bind("load",function(){var a=d[0].contentDocument.body.innerHTML,c={response:a,status:200,dummy:!0},e=f._transformResponse(c.response);f.trigger("in:success",c,b,e),f.trigger("in:complete",c,b,e)}),c.abort=function(){var a={status:0,dummy:!0};d.unbind("load").prop("src","javascript:false;"),c.replaceWith(e),f.trigger("in:cancel",a,b),f.trigger("in:complete",a,b)},e.after(c),c.append(e).append(d),c[0].submit()},_isSuccessCode:function(a){return a>=200&&300>a||304===a},_transformResponse:function(a){return d.defaults.transformResponse.forEach(function(b){a=b(a)}),a}},g.prototype={constructor:g,remove:function(){this.uploader.removeFromQueue(this)},upload:function(){this.uploader.uploadItem(this)},cancel:function(){this.uploader.cancelItem(this)},edit:function(){this.uploader.editItem(this)},_destroy:function(){this._form&&this._form.remove(),this._input&&this._input.remove(),delete this._form,delete this._input},_beforeupload:function(a,b){b.isReady=!0,b.isUploading=!0,b.isUploaded=!1,b.isSuccess=!1,b.isCancel=!1,b.isError=!1,b.progress=0},_progress:function(a,b,c){b.progress=c,b.uploader.trigger("progress",b,c)},_success:function(a,b,c,d){c.isReady=!1,c.isUploading=!1,c.isUploaded=!0,c.isSuccess=!0,c.isCancel=!1,c.isError=!1,c.progress=100,c.index=null,c.uploader.trigger("success",b,c,d)},_cancel:function(a,b,c){c.isReady=!1,c.isUploading=!1,c.isUploaded=!1,c.isSuccess=!1,c.isCancel=!0,c.isError=!1,c.progress=0,c.index=null,c.uploader.trigger("cancel",b,c)},_error:function(a,b,c,d){c.isReady=!1,c.isUploading=!1,c.isUploaded=!0,c.isSuccess=!1,c.isCancel=!1,c.isError=!0,c.progress=100,c.index=null,c.uploader.trigger("error",b,c,d)},_complete:function(a,b,c,d){c.uploader.trigger("complete",b,c,d),c.removeAfterUpload&&c.remove()}},{create:function(a){return new f(a)},isHTML5:f.prototype.isHTML5}}]),b}),angular.module("subPlatformServices",["ngResource"]).factory("subService",["$resource",function(a){return a("/:action/:id",{action:"@action"},{getSingleSub:{method:"GET",params:{action:"sub"}},getSubs:{method:"GET",params:{action:"subs"}},deleteSub:{method:"DELETE",params:{action:"sub"}},deleteAllSubs:{method:"DELETE",params:{action:"subs"}},submitForm:{method:"POST",params:{action:"submission"}},createEmptySubmission:{method:"Post",params:{action:"createEmptySubmission"}},updateSub:{method:"POST",params:{action:"updateSub"}},updateSubTags:{method:"POST",params:{action:"updateSubTags"}},bulkAddTags:{method:"POST",params:{action:"bulkAddSubTags"}},bulkRemoveTags:{method:"POST",params:{action:"bulkRemoveSubTags"}},bulkDeleteSubs:{method:"POST",params:{action:"bulkDeleteSubs"}},updateSubandMed:{method:"POST",params:{action:"updateSubAndMed"}},updatePupSub:{method:"POST",params:{action:"updatePupSub"}},updateEndUser:{method:"POST",params:{action:"updateEndUser"}},updateApproval:{method:"POST",params:{action:"updateApproval"}},saveSearch:{method:"POST",params:{action:"saveSearch"}},importSubs:{method:"POST",params:{action:"import"}}})}]).factory("formService",["$resource",function(a){return a("/:action/:id",{action:"@action"},{getForm:{method:"GET",params:{action:"form"}},getFormNames:{method:"GET",params:{action:"appNames.json"}},addForm:{method:"POST",params:{action:"form"}},updateForm:{method:"POST",params:{action:"updateApp"}},deleteForm:{method:"DELETE",params:{action:"form"}},deleteCategoryFromForms:{method:"DELETE",params:{action:"categories"}}})}]).factory("userService",["$resource",function(a){return a("/:action/:id",{action:"@action"},{getUser:{method:"GET",params:{action:"user"}},getUserForms:{method:"GET",params:{action:"userForms"}},getUserSubs:{method:"GET",params:{action:"customerSubs.json"}},getAllUsers:{method:"GET",params:{action:"users"}},updateUserStatus:{method:"POST",params:{action:"updateUserStatus"}},updateUser:{method:"POST",params:{action:"updateUser"}},updateUserLastActiveDate:{method:"POST",params:{action:"updateUserLastActiveDate"}},register:{method:"POST",params:{action:"register"}},checkUsername:{method:"POST",params:{action:"check",id:"username"}},checkEmail:{method:"POST",params:{action:"check",id:"email"}}})}]).factory("acctService",["$resource",function(a){return a("/:action/:id",{action:"@action"},{getAcct:{method:"GET",params:{action:"account"}},getAcctForms:{method:"GET",params:{action:"accountForms"}},getAcctSubs:{method:"GET",params:{action:"accountSubs"}},updateAccount:{method:"POST",params:{action:"updateAccount"}}})}]);var modalServices=angular.module("modalServices",[]);modalServices.service("modals",["$modal",function(a){var b={backdrop:!0,keyboard:!0,modalFade:!0,templateUrl:"/modal"},c={closeButtonText:"Close",actionButtonText:"OK",headerText:"Proceed?",bodyText:"Perform this action?"};this.showModal=function(a,b){return a||(a={}),a.backdrop="static",this.show(a,b)},this.show=function(d,e){var f={},g={};return angular.extend(f,b,d),angular.extend(g,c,e),f.controller||(f.controller=function(a,b){a.modalOptions=g,a.modalOptions.ok=function(a){b.close(a)},a.modalOptions.close=function(a){b.dismiss("cancel")}}),a.open(f).result}}]),angular.module("admin.controllers",["ui.bootstrap","localytics.directives","admin.filters","admin.directives","imgEditor.directives","ngSanitize","uuids","angularFileUpload","ui.sortable","ngResource","subPlatformServices","modalServices","mentio","pasvaz.bindonce","loggingModuleServices"]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"],a.interceptors.push(["$q","$rootScope",function(a,b){return{request:function(b){return b||a.when(b)},response:function(b){return b||a.when(b)}}}])}]).controller("SettingsCtrl",["$scope",function(a){a.predicate="-_id",a.filterText={},a.filterKey="",a.filterVal="",a.filterActive=!1,a.status=null,a.simple=!0,a.advanced=!1,a.dateSearch=!1,a.info={},a.quotes=[{value:"Hello"}],a.randomQuote=a.quotes[Math.floor(Math.random()*a.quotes.length)]}]).controller("AppCtrl",["$scope","$filter","$http","$location","$window","$anchorScroll","$rootScope","rfc4122","$fileUploader","subService","formService","userService","acctService","modals","$q","subLogService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(a){if(!a)return"";for(var c="",d=0;d<a.rules.length;d++){d>0&&(c+="&");var e=a.rules[d].data,f=a.rules[d].field.key;if("pastDate"==a.rules[d].field.type||"futureDate"==a.rules[d].field.type||"date"==a.rules[d].field.type){var g=new Date(e);e="lt"==a.rules[d].condition?b("date")(g,"yyyy'-'MM'-'dd'T00:00:00'"):"gt"==a.rules[d].condition?b("date")(g,"yyyy'-'MM'-'dd'T23:59:59'"):b("date")(g,"yyyy'-'MM'-'dd'T05:00:00'")}else"checkbox"==a.rules[d].field.type&&(f=a.rules[d].field.key+". "+e,e=!0);c+=a.rules[d].group?q(a.rules[d].group):f+""+a.rules[d].condition+e}return c+""}a.replyToOptions=[],a.updateReplyToOptions=function(){a.replyToOptions.push({forceUpdate:""})},a.removeReplyToOption=function(b){for(var c=0;c<a.replyToOptions.length;c++)b.uniqueId==a.replyToOptions[c].uniqueId&&a.replyToOptions.splice(c,1)},a.comparedSubmissions=[],a.compareSubmission=!1,a.compare=!1,a.isPreview=!0,window.onload=function(){setTimeout(function(){scrollTo(0,0)},5e3)},a.compareSubmissionsModal=function(){var b={closeButtonText:"",actionButtonText:"Okay",headerText:"Compare Submissions",bodyText:"Such a good looking modal."};n.showModal({templateUrl:"compare.html",scope:a},b).then(function(a){})},a.manageTagsModal=function(){var b={closeButtonText:"Cancel",actionButtonText:"Finish",headerText:"Add or remove tags",bodyText:"",close:a.manageTags.error=""};n.showModal({templateUrl:"tags.html",scope:a},b).then(function(a){})},a.saveSearchModal=function(){var b={closeButtonText:"Cancel",actionButtonText:"Save Search",headerText:"Save Search",bodyText:""};n.showModal({templateUrl:"saveSearch.html",scope:a},b).then(function(a){})},a.useSaveSearchModal=function(){var b={closeButtonText:"Close",actionButtonText:"Save Search",headerText:"Use a Save Search",bodyText:""};n.showModal({templateUrl:"useSaveSearch.html",scope:a},b).then(function(a){})},a.documentViewModal=function(b,c,d){var e={closeButtonText:"",actionButtonText:"Finish",headerText:"View Document",bodyText:"",photo:b,sequenceNumber:d,submission:c};n.showModal({templateUrl:"viewDocument.html",scope:a},e).then(function(a){})},a.imgEditModal=function(b,c,d){var e={closeButtonText:"Cancel",actionButtonText:"Save Changes",headerText:"Edit Image",bodyText:"",photo:b,mediaset:c,submission:d};n.showModal({templateUrl:"imgEdit.html",scope:a},e).then(function(a){})},a.addUserModal=function(b,c,d){var e={closeButtonText:"Cancel",actionButtonText:"Finished",headerText:"Add A User",bodyText:"",photo:b,mediaset:c,submission:d};n.showModal({templateUrl:"userManagement.html",scope:a},e).then(function(a){})};var r,s=window.location.hostname;"localhost"==s?(r="//pupscantest.digitalink.com/photo-uploader/newuploader/",a.embedEnvVar="local"):"wp-sub-qa.digitalink.com"==s?(r="//pupscantest.digitalink.com/photo-uploader/newuploader/",a.embedEnvVar="qa"):(r="//pupscan.washingtonpost.com/photo-uploader/newuploader/",a.embedEnvVar="prod");var t='{"group": {"operator": "&","rules": []}}';a.json=null,a.filter=JSON.parse(t),a.searchOptions={},a.$watchCollection("filter",function(b){a.json=JSON.stringify(b,null,2),a.searchOptions=b,a.output=q(b.group),a.operator=b.group.operator},!0),a.clearSearch=function(){a.searchOptions={}},a.searchToApply={},a.applySearch=function(){a.searchOptions=a.searchToApply.search.searchOptions,a.filter=a.searchToApply.search.filter,a.filterActive=!0,a.filterVal=a.searchToApply.search.approved,a.advSearch=a.searchToApply.search.isAdvanced,a.basicSearch=!a.searchToApply.search.isAdvanced,a.searchAll()},a.searchToSave={},a.saveSearch=function(b){if(!b)for(var c in a.app.savedSearches)a.searchToSave.name===a.app.savedSearches[c].name&&(a.searchToSave.overwriteWarning=!0);if(!a.searchToSave.overwriteWarning){a.savedSearch={name:a.searchToSave.name,searchOptions:a.searchOptions,filter:a.filter,isAdvanced:a.advSearch,approved:a.filterVal};var d=angular.copy(a.savedSearch),e={appId:a.approvalApp,overwrite:b,search:d};j.saveSearch(e,function(b){console.log(b),a.app.savedSearches&&a.app.savedSearches.length||(a.app.savedSearches=[]),a.app.savedSearches=b.application.savedSearches,a.searchToSave.success=!0,a.searchToSave.name=null},function(){a.searchToSave.error=err,console.log("can't save search: "+err)})}},a.advSearch=!1,a.searchAll=function(d,e,f){window.console.log("start search"),a.subs=[],c({method:"GET",url:"/elasticSearch/countApproved/"+a.approvalApp}).success(function(b){window.console.log(b),a.info.totalApproved=b.approvedCount,a.info.totalUnapproved=b.unapprovedCount}),a.showSearchCond=!0;var g={},h=[],i={},j={},k=a.searchOptions.group.rules;for(var l in k){var m=k[l].condition,n=k[l].field.key;if("pastDate"==k[l].field.type||"futureDate"==k[l].field.type||"date"==k[l].field.type||"createdDate"==k[l].field.type){var o=new Date(k[l].data);"lt"==k[l].condition?k[l].data=b("date")(o,"yyyy'-'MM'-'dd'T00:00:00'"):"gt"==k[l].condition?k[l].data=b("date")(o,"yyyy'-'MM'-'dd'T23:59:59'"):k[l].data=b("date")(o,"yyyy'-'MM'-'dd'T05:00:00'")}0==n.indexOf("mediasets.")?n="mediasets.media.mediasetFormData."+n.substring(10):"createdDate"==k[l].field.type?n=n:"_all"!=n&&(n="formData."+a.approvalApp+"."+n),"_all"==n?h.push(k[l].data):"="==m?g[n]=k[l].data:"f"==m?i[n]=k[l].data:(j[n]||(j[n]={}),j[n][m]=k[l].data)}a.searchQuery="/elasticSearch/"+a.approvalApp+"/subs.json";var p={};"OR"==a.searchOptions.group.operator?(p.shouldMatch=g,p.shouldFuzzyMatch=i,p.shouldRange=j,p.shouldAllMatch=h):(p.mustMatch=g,p.mustFuzzyMatch=i,p.mustRange=j,p.mustAllMatch=h),d&&(p.mustMatch||(p.mustMatch={}),p.mustMatch.tags=d),e&&(p.mustMatch||(p.mustMatch={}),p.mustMatch.approved=e.approved),f&&(a.pag.bigCurrentPage=f),p.pageSize=a.pag.itemsPerPage,p.page=a.pag.bigCurrentPage,config={},c({method:"POST",url:a.searchQuery,data:p}).success(function(b){a.subs=b.Submissions,a.pag.bigTotalItems=b.Total})},a.searchDate=function(d,e){a.showSearchCond=!0,d=b("date")(d,"yyyy'-'MM'-'dd'T00:00:00'"),e=b("date")(e,"yyyy'-'MM'-'dd'T23:59:59'"),a.searchQuery="/elasticSearch/"+a.approvalApp+"/subs.json";var f={};f.mustRange={createdDate:{gte:d,lte:e}},f.pageSize=a.pag.itemsPerPage,f.page=a.pag.bigCurrentPage,c({method:"POST",url:a.searchQuery,data:f}).success(function(b){a.subs=b.Submissions,a.pag.bigTotalItems=b.Total})},a.cleanupRules=function(a){if(a.length>1)for(var b=a.length-1;b>=1;b--)a.splice(b,1)},a.clearRules=function(b){a.subsTemp||(a.subsTemp=a.subs);for(var c=b.length-1;c>=0;c--)c>0?b.splice(c,1):(b[c].field="",b[c].data="");a.showSearchCond=!1},a.getSubmission=function(b){config={},a.submissionId=b,j.getSingleSub({id:a.submissionId+".json"},function(b){a.submission=b,k.getForm({id:b.appId+".json"},function(b){a.app=b.applicationInfo})})},a.getApp=function(b){config={},k.getForm({action:b},function(b){a.app=b.applicationInfo})},a.today=new Date,a.minActiveEndDate=a.today,a.updateMinActiveEndDate=function(){a.newSchema.activeStartDate&&(a.minActiveEndDate=a.newSchema.activeStartDate),a.newSchema.activeEndDate<a.newSchema.activeStartDate&&(a.newSchema.activeEndDate=null)},a.handleRequireAll=function(b){b||(a.newSchema.requireAll=!1)},a.auth={},a.thisDomain=window.location.hostname,"localhost"==a.thisDomain&&(a.thisDomain="localhost:3000"),a.editApp=null,a.bitly={isBitly:!0},a.changeBitly=function(){a.bitly.success=null,a.bitly.error=null,a.bitly.customKeyWord?c.post("/"+a.app._id+"/changeTinyUrl",{customKeyWord:a.bitly.customKeyWord}).success(function(b){console.log("data"),console.log(b),b.error?(console.log("failed to update tinyurl "),console.log(b.error),a.bitly.error=b.error):(a.app.tinyUrl=b.applicationInfo.tinyUrl,a.bitly.success="Your short url has been updated.",console.log("Changed tinyurl to "+b.applicationInfo.tinyUrl),a.bitly.editBitly=!1,a.bitly.customKeyWord=null)}).error(function(b,c){console.log("failed to change tinyurl to "+b.url),a.bitly.error="Sorry, we encountered an error while trying to change your short URL"}):(console.log("No custom link keyword defined"),a.bitly.error="Please enter a custom short URL")},a.compareFlag=function(){0==a.compare?a.compare=!0:a.compare=!1},a.compareSubmissions=function(b,c){if(1==c){var d=a.comparedSubmissions.indexOf(b);a.comparedSubmissions.splice(d,1),a.compareSubmission=!1}else a.thisSubmission=b,a.comparedSubmissions.push(a.thisSubmission)},a.comparedSubFilter=function(b){return-1!==a.comparedSubmissions.indexOf(b._id)},a.setApprovedStatus=function(b,c,d){a.filterActive=b,a.filterKey=c,a.filterVal=d,a.pag.bigCurrentPage=1},a.appEdit=function(b){"true"==a.edit&&(a.editApp=b,config={},c.get("/"+a.editApp+"/app.json",config,{}).success(function(b){a.newSchema=b.applicationInfo,"wufoo"==a.newSchema.importSource&&a.fieldType.types.push({name:"wufooUpload",readable:"Wufoo File Upload",description:"Use this to import photos from Wufoo."});for(var c=0;c<a.newSchema.appFormFields.length;c++){if(a.newSchema.appFormFields[c].isExistingField=!0,void 0==a.newSchema.appFormFields[c].sequenceNumber){var d=h.newuuid();a.newSchema.appFormFields[c].sequenceNumber=d}"email"==a.newSchema.appFormFields[c].fieldType&&a.replyToOptions.push(a.newSchema.appFormFields[c])}}))},a.validateLabel=function(b){for(index in a.newSchema.appFormFields)b===a.newSchema.appFormFields[index].fieldName},a.requireAll=function(){angular.forEach(a.newSchema.appFormFields,function(a){a.isMandatory=!0})},a.requireAllUndo=function(){angular.forEach(a.newSchema.appFormFields,function(a){a.isMandatory=!1})},a.checkSearchDate=function(a,b){},a.createUniqueId=function(c,d,e,f,g,h){if(c&&c.isExistingField);else if(e?c.uniqueId=b("nospace")(c.fieldName)+"_ms_"+f+"_"+d:g?c.uniqueId=b("nospace")(c.fieldName)+"_cond_"+h+"_"+d:c.uniqueId=b("nospace")(c.fieldName)+"_"+d,"mediaSet"==c.fieldType||"mediaSetDoc"==c.fieldType||"mediaSetVid"==c.fieldType||"mediaSetAudio"==c.fieldType){for(var i,j=0;j<a.newSchema.mediaSets.length;j++)null!=a.newSchema.mediaSets[j]&&parseInt(c.mediaSetId)==parseInt(a.newSchema.mediaSets[j]._id)&&(i=j);a.newSchema.mediaSets[i].mediaSetName=c.uniqueId}},a.isAuthenticated=function(){for(var a="auth=",b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a)){var e=d.substring(a.length,d.length);if("true"==e)return!0}}return!1},a.logout=function(){createCookie("auth","")},a.isCollapsed=!0,a.reset=function(){a.newSchema.appFormFields=[],a.newSchema.mediaSets=[],a.newSchema.tags=[],a.newSchema.appName="",a.newSchema.appDescription="",a.newSchema.appUrl="",a.newSchema.confirmation="",a.newSchema.platformTitle="",a.newSchema.callToAction="",a.schema.$setPristine()},a.init=function(b,c,d,e,f,g){a.newSchema.customerId=a.customerId=b,a.customerRole=d,a.accountId=c,a.accountType=e,a.activeTab=f,a.embedCssRef=g,a.supportsHTML5Blob=!(!window.Blob||!window.FileReader),a.msSaveBlob=!!navigator.msSaveBlob,jQuery.support.download=function(){var a=document.createElement("a");return"download"in a}(),a.supportDownload=$.support.download,a.getAppNames=function(b){config={},a.accountId=b,k.getFormNames({id:a.accountId},function(b){a.appId=b._id,a.applicationName=b.applicationName})};var h=window.sessionStorage&&window.sessionStorage.getItem("duplicateFormData");if(null!=h){var i=JSON.parse(h);a.newSchema=i.applicationInfo,a.newSchema.createdDate=new Date,window.sessionStorage&&window.sessionStorage.removeItem("duplicateFormData")}l.getUser({id:a.newSchema.customerId},function(b){a.thisCustomer=b.customerInfo[0],0==a.newSchema.categories.length&&a.newSchema.categories.push(a.thisCustomer.defaultCategory)}),a.collapseAllFields(),a.collapseBtn=!0},a.edit=function(b){a.edit=b},a.getAccount=function(b){a.account={},m.getAcct({id:b},function(b){a.account=b.accountInfo,!a.newSchema||a.newSchema._id||a.newSchema.appId||(a.newSchema.policyURL=a.account.defaultPolicyURL,a.newSchema.tosURL=a.account.defaultTosURL)})},a.confirm=!1,a.success=!1,a.minDOBCheckAge=13,a.meta=[],a.newSchema={appFormFields:[],mediaSets:[],tags:[],customerId:null,createdDate:new Date,autoApproved:!0,active:!0,submissionNotifications:!1,endUserNotification:!1,socialShareButtons:!1,shared:!0,categories:[],defaultImgFieldExt:"jpg",requireAll:!1,submissionLimit:!1,submissionLimitAmount:100},a.styles={styles:[{name:"none",readable:"None"},{name:"metallic",readable:"Metallic"},{name:"mono",readable:"Monochromatic"},{name:"spring",readable:"Spring"},{name:"winter",readable:"Winter"}]},a.fieldType={types:[{name:"text",readable:"Text",description:"Value MUST be a string.",groupName:"Standard"},{name:"textarea",readable:"Paragraph Text",description:"Text Area",groupName:"Standard"},{name:"email",readable:"Email",description:"Value MUST be email.",groupName:"Standard"},{name:"number",readable:"Number",description:"Value MUST be a number, floating point numbers are allowed.",groupName:"Standard"},{name:"sectionHeader",readable:"Section Header",description:"Section Header",groupName:"Standard"},{name:"subSectionHeader",readable:"Sub Section Header",description:"Sub Section Header",groupName:"Standard"},{name:"radio",readable:"Multiple choice (radio)",description:"Radio Button",groupName:"Standard"},{name:"dropdown",readable:"Choose from a list (dropdown)",description:"dropdown",groupName:"Standard"},{name:"checkbox",readable:"Checkboxes",description:"Checkboxes",groupName:"Standard"},{name:"mediaSet",readable:"Image Uploader (jpg, jpeg, png, gif, bmp)",description:"If you want to create a Photo set / Gallery.",groupName:"Uploaders"},{name:"mediaSetDoc",readable:"Document Uploader (doc, txt, xls, pdf)",description:"If you want to upload a document.",groupName:"Uploaders"},{name:"mediaSetVid",readable:"Video Uploader (mov, avi, mp4, wmv)",description:"If you want to upload a video.",groupName:"Uploaders"},{name:"mediaSetAudio",readable:"Audio File Uploader (wav, mp3, mp4, mid, wma)",description:"If you want to upload an audio file.",groupName:"Uploaders"},{name:"date",readable:"Date",description:"Value MUST be a date.",groupName:"Date & Time"},{name:"pastDate",readable:"Past Date (including today)",description:"Value MUST be a date.",groupName:"Date & Time"},{name:"futureDate",readable:"Future Date (including today)",description:"Value MUST be a date.",groupName:"Date & Time"},{name:"time",readable:"Time",groupName:"Date & Time"},{name:"trueFalse",readable:"True/False (radio)",description:"Value MUST be a boolean.",groupName:"Custom"},{name:"yesNo",readable:"Yes/No (radio)",description:"Value MUST be a boolean.",groupName:"Custom"},{name:"firstAndLastName",readable:"First and Last Name fields",description:"First and Last Name fields",groupName:"Custom"},{name:"phoneNumber",readable:"U.S. Phone Number field",description:"Phone Number field",groupName:"Custom"},{name:"address",readable:"Address field",description:"Address field",groupName:"Custom"},{name:"dobCheck",readable:"Date of Birth Check",description:"Use this to require a minimum age",groupName:"Custom"}]},a.tooltips={name:"This is the name of your form; it will appear at the top and let users know what your form is called.",url:"Please let us know the web address of the site where you’ll be using your form. Note: This information will not appear anywhere on your form.",uniqueId:"This is a machine-readable name without spaces or special characters. It will always remain the same.",fieldName:"This is the name of the field",replyto:"You may select any email field from this form to supply the reply to header on your notification emails.",fieldType:"Here are explanations for some of the fields:<br>Section Header - Use this to provide bolded information to your user<br>Multiple Choice - User can select one item from a radio button list<br>Choose from a list - User can select one item from a dropdown list<br>Checkbox - User can select more than one item from a list using checkboxes<br>Paragraph Text - Use this to provide information to your user ",fieldInstructions:"Enter text that explains what you want your users to do. This appears under the field name/question.",publicPrivate:"Mark a field as “Private” if you want it to be seen only by admin users. Otherwise, mark it as “Public”.",placeholder:"This placeholder text will appear in gray inside the field. It will disappear as soon as the user types in the field.",tags:"Use tags to organize your submissions by specific terms. These tags can be edited later. Separate individual tags using commas.",status:"This indicates the current status of your form. 'Active' means your form is live for everyone to see. 'Inactive' means no one will see your form.",autoApprove:"Use this to moderate and approve your user submissions. Select 'Yes' if you want to reserve the option to approve/not approve each submission. Select “No” if you don't need this feature. ",heading:"The default title for your form will be your Form Name. Otherwise, you can designate a separate title here. ",description:"Describe your form for users (this will appear below the name of your form). A description could be a tagline or additional information about your form. You can also leave this space blank. ",buttonText:"This text will appear inside the button a user will click at the bottom of your form to submit his or her response. ",confirmMsg:"Customize the confirmation message users will see after submitting their forms. Or, stick with a default confirmation message.",numOfImgs:"Enter the number of images users can upload. ",activeEndDate:"Enter the date of when the form should no longer accept submissions. The form will be marked inactive at 11:00PM of selected date.",activeStartDate:"Enter the date of when the form should start to accept submissions.",inactiveMsg:"Enter a custom message for users to see when the form is inactive.",notifications:"When turned on, a notification will be sent to a designated email address (normally the creator of this form) every time this form recieves a submission.",endUserNotification:"When turned on, a notification will be sent to the end user's email address confirming the user's form submission",endUserNotificationMessage:"This will be prepended to the message that is sent.",socialShareButtons:"On the confirmation page shown to the user after form submission the user will be prompted to share this form on Facebook, Twitter and Google+",socialTitle:"Some social media platforms require a title for the shared item. For example, this will be the title of this share on a user's Facebook wall",socialDescription:"Some social media platforms require a description for the shared item. For example, this will be the description of this share on a user's Facebook wall",socialLogo:"Display a custom logo when your form is shared on Facebook instead of the Submission Platform logo",logo:"The maximum upload file size is 10 MB. The only file types allowed are jpg, png, jpeg, bmp, and gif.",policy:"You have the option to include a link to the privacy policy that your would like displayed on the hosted version of your form. You can set a default policy to use for all forms in your account settings.",tos:"You have the option to include a link to the terms of service that your would like displayed on the hosted version of your form. You can set a default policy to use for all forms in your account settings.",
minAge:"Use this to enforce a minimum age for your end users. Sub only allows restriction of forms to ages 13 and up. You can specify a minimum age older than 13 but not younger.",shared:"If you want the form to be visible to everyone in the account or it is a private form that you do not want to share. ",categories:"Apply the category the form should be filed under. ",required:"If you want all form fields to be required. ",conditional:"A conditional field allows you to present the user with different fields based on their answers. ",customSubjLine:"If you would like user input to appear in the email's subject line, start typing '@' and all the possible fields will appear.",otherField:"Check this, if you would like to add an option called 'Other' and an empty input field."},a.placeholders={msgNextToDraftBtnPlaceholder:"Default: Click to save your submission to be edited later."},a.showEdit=function(){1==a.edit?a.edit=!1:a.edit=!0},a.newFormField=function(b){a.collapseBtn=!0;var c=h.newuuid(),d=[];fieldObj={fieldType:b.name,isMandatory:!1,isPublic:!0,readable:b.readable,sequenceNumber:c,endUserNotification:!1,isCollapsed:!1,isFocused:!0,isConditional:!1,fieldTypeOptionsArray:d},"dobCheck"==b.name&&(fieldObj.minAge=a.minDOBCheckAge),a.newSchema.appFormFields.push(fieldObj),"mediaSet"!=b.name&&"mediaSetDoc"!=b.name&&"mediaSetVid"!=b.name&&"mediaSetAudio"!=b.name||a.newMedia(fieldObj),"payment"==b.name&&(a.payments=!0),"email"==b.name&&a.replyToOptions.push(a.newSchema.appFormFields[a.newSchema.appFormFields.length-1])},a.shuffleFields=function(){var b=[],c=a.newSchema.appFormFields;$("input.sequenceNumber").each(function(){var a=$(this).val(),d=c.filter(function(b){return b.sequenceNumber===a})[0];b.push(d)}),a.newSchema.appFormFields.length=0,a.$apply(),a.newSchema.appFormFields=b,a.isCollapsed=!0,a.$apply()},a.removeFormField=function(b,c){if(a.newSchema.appFormFields.splice(b,1),"mediaSet"==c.fieldType||"mediaSetDoc"==c.fieldType||"mediaSetVid"==c.fieldType||"mediaSetAudio"==c.fieldType){for(var d,e=0;e<a.newSchema.mediaSets.length;e++)null!=a.newSchema.mediaSets[e]&&parseInt(c.mediaSetId)==parseInt(a.newSchema.mediaSets[e]._id)&&(d=e);a.newSchema.mediaSets[d]={}}"email"==c.fieldType&&a.removeReplyToOption(c)},a.duplicateFormField=function(c,d){if("mediaSet"==d.fieldType||"mediaSetDoc"==d.fieldType||"mediaSetVid"==d.fieldType||"mediaSetAudio"==d.fieldType){a.index=c+=1,a.duplicateField=angular.copy(d),a.originalField=angular.copy(d),a.duplicateField.uniqueId=b("nospace")(a.duplicateField.fieldName)+"_"+a.index,a.duplicateField.mediaSetId=a.duplicateField.mediaSetId+=1,a.mediaSetFormFieldsNew=angular.copy(a.newSchema.mediaSets[a.originalField.mediaSetId].mediaSetFormFields),angular.forEach(a.mediaSetFormFieldsNew,function(a,b){angular.forEach(a,function(b,c){"uniqueId"==c&&(a[c]=b+=1)})}),a.mediaSetName=a.newSchema.mediaSets[a.originalField.mediaSetId].mediaSetName+"_"+a.index,a.duplicateField.isCollapsed=!1,a.newSchema.appFormFields.push(a.duplicateField),a.newSchema.mediaSets.push({_id:a.duplicateField.mediaSetId,numOfMedia:1,mediaSetType:"image",mediaSetName:a.mediaSetName,mediaSetFormFields:a.mediaSetFormFieldsNew}),d.mediaSetType=d.fieldType}else if(1==d.isConditional){a.index=c+=1,a.duplicateField=angular.copy(d),a.duplicateField.isCollapsed=!1,a.duplicateField.uniqueId=b("nospace")(a.duplicateField.fieldName)+"_"+a.index,a.fieldTypeOptionsArrayNew=a.duplicateField.fieldTypeOptionsArray,angular.forEach(a.fieldTypeOptionsArrayNew,function(a,b){angular.forEach(a,function(a,b){"conditionalFields"==b&&angular.forEach(a,function(a,b){angular.forEach(a,function(b,c){"uniqueId"==c&&(a[c]=b+="_1")})})})}),a.newSchema.appFormFields.push(a.duplicateField)}else a.index=c+=1,a.duplicateField=angular.copy(d),a.duplicateField.isCollapsed=!1,a.duplicateField.uniqueId=b("nospace")(a.duplicateField.fieldName)+"_"+a.index,a.newSchema.appFormFields.push(a.duplicateField),console.log(a.duplicateField)},a.newMedia=function(b){var c;if(0==a.newSchema.mediaSets.length)c=0;else{for(var d=0,e=0;e<a.newSchema.mediaSets.length;e++)a.newSchema.mediaSets[e]._id>d&&(d=a.newSchema.mediaSets[e]._id);c=d,c++}for(var f,g,h="",e=0;e<a.fieldType.types.length;e++)f=a.fieldType.types[e].name,h=a.fieldType.types[e].readable,g=b.fieldType,g==f&&(b.readable=h);if("email"==b.fieldType?a.replyToOptions.push(b):a.removeReplyToOption(b),"mediaSet"==b.fieldType||"mediaSetDoc"==b.fieldType||"mediaSetVid"==b.fieldType||"mediaSetAudio"==b.fieldType){for(var i,e=0;e<a.newSchema.mediaSets.length;e++)null!=a.newSchema.mediaSets[e]&&parseInt(b.mediaSetId)==parseInt(a.newSchema.mediaSets[e]._id)&&(i=e);a.newSchema.mediaSets[i]={},b.mediaSetId=c}"mediaSet"==b.fieldType?(a.newSchema.mediaSets.push({_id:c,numOfMedia:1,mediaSetType:"image"}),b.mediaSetType="image"):"mediaSetDoc"==b.fieldType?(a.newSchema.mediaSets.push({_id:c,numOfMedia:1,mediaSetType:"document"}),b.mediaSetType="document"):"mediaSetVid"==b.fieldType?(a.newSchema.mediaSets.push({_id:c,numOfMedia:1,mediaSetType:"video"}),b.mediaSetType="video"):"mediaSetAudio"==b.fieldType?(a.newSchema.mediaSets.push({_id:c,numOfMedia:1,mediaSetType:"audio"}),b.mediaSetType="audio"):(a.newSchema.mediaSets[b.mediaSetId]={},delete b.mediaSetId,delete b.mediaSetType)},a.newMediaField=function(b){for(var c=0;c<a.newSchema.mediaSets.length;c++)a.newSchema.mediaSets[c].hasOwnProperty("_id")&&a.newSchema.mediaSets[c]._id==b&&(a.newSchema.mediaSets[c].mediaSetFormFields||(a.newSchema.mediaSets[c].mediaSetFormFields=[]),a.newSchema.mediaSets[c].mediaSetFormFields.push({isCollapsed:!1,isMandatory:!1,isPublic:!0,readable:"Text",fieldType:a.fieldType.types[0].name}))},a.newMediaFieldDuplicate=function(b,c,d){console.log(a.newSchema),console.log(b);for(var e=0;e<a.newSchema.mediaSets.length;e++)a.newSchema.mediaSets[e].hasOwnProperty("_id")&&a.newSchema.mediaSets[e]._id==b&&(a.newSchema.mediaSets[e].mediaSetFormFields||(a.newSchema.mediaSets[e].mediaSetFormFields=[]),a.index=c+=1,a.duplicateField=angular.copy(d),console.log(a.duplicateField),a.duplicateField.uniqueId=a.duplicateField.uniqueId+"_"+a.index,console.log(a.duplicateField),a.newSchema.mediaSets[e].mediaSetFormFields.push(a.duplicateField))},a.review=function(){a.confirm=!0,d.hash("top"),f()},a.uploadLogo=function(){a.uploader.queue.length>0&&(a.uploader.uploadAll(),a.newSchema.logoURL="//wppup2approved.s3.amazonaws.com/internal/"+a.newSchema.logoUploadId+".png",console.log(a.newSchema))},a.cleanMediaSetsArray=function(){for(var b=[],c=0;c<a.newSchema.mediaSets.length;c++){var d=a.newSchema.mediaSets[c],e="_id";null!=d&&d.hasOwnProperty(e)||b.push(c)}for(var c=b.length-1;c>=0;c--)a.newSchema.mediaSets.splice(b[c],1)},a.addNewApp=function(){a.uploadLogo(),a.cleanMediaSetsArray(),a.newSchema.accountId=a.accountId,a.newSchema.draftLastSaved=new Date,k.addForm(a.newSchema,function(b){a.response=b,a.newSchema.appId=a.response.applicationInfo._id,a.newSchema._id=a.response.applicationInfo._id,window.console&&console.log("success - saved",a.newSchema.appId),d.hash("top"),f()},function(){})},a.saveForm=function(b,c){return a.schema.$invalid?(a.createFormErrors=!0,!1):(a.createFormErrors=!1,a.newSchema.draftLastSaved=new Date,a.newSchema.draftLastSavedUser=b,a.newSchema.lastSavedUserId=c,a.newSchema.appId||a.newSchema._id?(a.updateApp(),a.updateSuccess=!0,a.appCreatedSuccessMsg=!1):(a.addNewApp(),a.updateSuccess=!1,a.appCreatedSuccessMsg=!0),void 0)},a.thisDomain=window.location.hostname,"localhost"==a.thisDomain&&(a.thisDomain="localhost:3000"),a.goToTop=function(){d.hash("top"),f()},a.updateSub=function(a){j.updateSub(a,function(a){a.durr&&console.log("Update Failed")},function(){})},a.manageTags={},a.addTag=function(){-1!=a.app.tags.indexOf(b("lowercase")(a.manageTags.newTag))?a.manageTags.error="Whoops! This tag already exists.":(a.manageTags.error=!1,a.app.tags.push(b("lowercase")(a.manageTags.newTag)),a.updateAppTags(a.app)),a.manageTags.newTag=""},a.manageTags.removeTag=!1,a.removeTag=function(b){var c=[];c.push(a.app.tags[b]),a.app.tags.splice(b,1),a.updateAppTags(a.app,c)},a.updateAppTags=function(b,c){k.updateForm(b,function(b){b.durr&&(c||a.removeTag(a.app.tags.length-1),a.manageTags.error="data.durr")},function(){c||a.removeTag(a.app.tags.length-1),a.manageTags.error="Tag Failed"}),c&&c.length>0&&j.updateSubTags({id:a.app._id,tagsToRemove:c},function(b){b.error?(a.manageTags.error="Error removing tag",console.log(b.error)):a.getSubs()},function(){a.manageTags.error="Tag Failed"})},a.filterTagVals=[],a.filterStatus="",a.setfilterTagVals=function(b,d){if(a.tagFilter=!0,a.subs=[],d&&(a.pag.bigCurrentPage=d),a.inArray(b,a.filterTagVals)){var e=a.filterTagVals.indexOf(b);e>-1&&a.filterTagVals.splice(e,1)}else a.filterTagVals.push(b);if(a.showSearchCond)a.searchAll(a.filterTagVals);else{var f="";for(tagI in a.filterTagVals)f+="&tags[]="+a.filterTagVals[tagI].toLowerCase(),a.tagsParam=f;c.get("/internal/"+a.approvalApp+"/subs.json?page="+a.pag.bigCurrentPage+"&size="+a.pag.itemsPerPage+f,config,{}).success(function(b){b.Submissions?a.subs=b.Submissions:a.hasNoSubs=!0,a.info.totalSubs=b.Total,a.message=b.Message,a.subs&&(a.pag.bigTotalItems=b.Total)})}},a.setfilterApproved=function(b,d){a.subs=[],d&&(a.pag.bigCurrentPage=d),a.filterKey="approved",a.filterVal=!!b,a.showSearchCond?a.searchAll(null,{approved:b}):c.get("/internal/"+a.approvalApp+"/subs.json?page="+a.pag.bigCurrentPage+"&size="+a.pag.itemsPerPage+"&approved="+b,config,{}).success(function(b){b.Submissions?a.subs=b.Submissions:a.hasNoSubs=!0,a.info.totalSubs=b.Total,a.message=b.Message,a.subs&&(a.pag.bigTotalItems=b.Total)})},a.inArray=function(a,b){for(var c=b.length,d=0;c>d;d++)if(b[d]===a)return!0;return!1},a.bulkActions={on:!1,tags:[],subs:[]},a.bulkActions.selectAllVis=function(){for(var b in a.subs)a.subs[b].isSelected=!0,a.bulkActions.subs.push(a.subs[b]._id)},a.bulkActions.deselectAll=function(){a.bulkActions.subs=[];for(var b in a.subs)a.subs[b].isSelected=!1},a.bulkActions.applyTags=function(){j.bulkAddTags({subs:a.bulkActions.subs,tags:a.bulkActions.tags},function(b){console.log("tags added: "),console.log(b);for(var c in a.subs)if(a.subs[c].isSelected){a.subs[c].isSelected=!1;for(var d in a.bulkActions.tags)!a.subs[c].tags.indexOf(a.bulkActions.tags[d])>-1&&a.subs[c].tags.push(a.bulkActions.tags[d])}a.bulkActions.subs=[]})},a.bulkActions.removeTags=function(){j.bulkRemoveTags({subs:a.bulkActions.subs,tags:a.bulkActions.tags},function(b){console.log("tags removed: "),console.log(b);for(var c in a.subs)if(a.subs[c].isSelected){a.subs[c].isSelected=!1;for(var d in a.bulkActions.tags){var e=a.subs[c].tags.indexOf(a.bulkActions.tags[d]);e>-1&&a.subs[c].tags.splice(e,1)}}a.bulkActions.subs=[]})},a.bulkActions.deleteSubs=function(){j.bulkDeleteSubs({subs:a.bulkActions.subs},function(b){console.log("subs deleted: "),console.log(b),a.paginate()})},a.bulkActions.updateSubs=function(b,c){if(console.log(c),c)a.bulkActions.subs.push(b);else for(var d=a.bulkActions.subs.length-1;d>=0;d--)if(a.bulkActions.subs[d]===b){a.bulkActions.subs.splice(d,1);break}},a.pag={},a.pag.bigTotalItems=0,a.pag.bigCurrentPage=1,a.pag.maxSize=10,a.pag.numPages=10,a.pag.itemsPerPage=10,a.pag.otherItemsPerPage=50,a.tagsParam="",a.appApprove=function(b){a.approvalApp=b,config={},c.get("/"+a.approvalApp+"/app.json",config,{}).success(function(b){if(a.app=b.applicationInfo,a.app.tinyUrl)if(-1==a.app.tinyUrl.indexOf("subpl.at"))a.bitly.isBitly=!1;else{var c=a.app.tinyUrl.split("subpl.at/");a.bitly.customKeyWord=c[1]}window.document.title="Admin | "+a.app.appName,a.searchFields=[],a.searchFields.push({name:"Created Date",key:"createdDate",type:"createdDate"}),a.searchFields.push({name:"Search All Fields",key:"_all",type:"searchAll"}),angular.forEach(a.app.appFormFields,function(b,c,d){a.searchFields.push({name:b.fieldName,key:b.uniqueId,type:b.fieldType})}),angular.forEach(a.app.mediaSets,function(b,c,d){angular.forEach(b.mediaSetFormFields,function(b,c,d){a.searchFields.push({name:"MetaData: "+b.fieldName,key:"mediasets."+b.uniqueId,type:b.fieldType})})}),a.app.autoApproved||a.searchFields.push({name:"Approved",key:"approved"})}),a.tabs=[{title:"Submissions",content:"/approval/",href:"/admin/"+a.approvalApp,tabName:"subs",url:a.approvalApp,icon:"fa fa-database",active:!a.activeTab||"subs"==a.activeTab},{title:"Edit Form",content:"/edit/",href:"/admin/"+a.approvalApp+"?tab=edit",tabName:"edit",url:a.approvalApp,icon:"fa fa-edit",active:"edit"==a.activeTab},{title:"Share Form",content:"/settings/",href:"/admin/"+a.approvalApp+"?tab=share",tabName:"share",url:a.approvalApp,icon:"fa fa-share-square-o",active:"share"==a.activeTab}],a.reloadPage=function(b){window.location.href=window.location.protocol+"//"+window.location.host+"/admin/"+a.approvalApp+"?tab="+b},a.getSubs()},a.page=1,a.size=5,a.paginate=function(){a.showSearchCond?a.searchAll():a.getSubs()},a.getSubs=function(){a.subs=[],a.tagFilter?c.get("/internal/"+a.approvalApp+"/subs.json?page="+a.pag.bigCurrentPage+"&size="+a.pag.itemsPerPage+a.tagsParam,config,{}).success(function(b){b.Submissions?a.subs=b.Submissions:a.hasNoSubs=!0,a.info.totalSubs=b.Total,a.message=b.Message,a.subs&&(a.pag.bigTotalItems=b.Total),a.mediaArrays={},angular.forEach(a.app.mediaSets,function(b,c,d){a.mediaArrays[c]=new Array(b.numOfMedia)})}):(c({method:"GET",url:"/elasticSearch/countApproved/"+a.approvalApp}).success(function(b){a.info.totalApproved=b.approvedCount,a.info.totalUnapproved=b.unapprovedCount}),c.get("/internal/"+a.approvalApp+"/subs.json?page="+a.pag.bigCurrentPage+"&size="+a.pag.itemsPerPage,config,{}).success(function(b){b.Submissions?a.subs=b.Submissions:a.hasNoSubs=!0,a.info.totalSubs=b.Total,a.message=b.Message,a.subs&&(a.pag.bigTotalItems=b.Total),a.mediaArrays={},angular.forEach(a.app.mediaSets,function(b,c,d){a.mediaArrays[c]=new Array(b.numOfMedia)})}))},a.getNumber=function(a){return new Array(a)},a.deleteSubmission=function(a,b){j.deleteSub({id:a._id},function(b){a.deleted=!0})},a.undoDelete=function(a){j.createEmptySubmission(a,function(b){a.deleted=!1},function(){})},a.updateApproval=function(b,c){var d={};d.id=b._id,d.approved=c,j.updateApproval(d,function(d){b.approved=c,c?(a.info.totalApproved++,a.info.totalUnapproved--):(a.info.totalApproved--,a.info.totalUnapproved++)},function(){})},a.updateApp=function(){a.uploadLogo(),a.cleanMediaSetsArray(),a.newSchema.draftLastSaved=new Date,k.updateForm(a.newSchema,function(b){a.response=b,a.newSchema.appId=a.response.applicationInfo._id,a.newSchema.importRequired&&a.importSubs(a.newSchema,a.newSchema.appId)},function(){})},a.importSubs=function(b,c){a.importMessage={};var d={appId:c,importSource:b.importSource};j.importSubs(d,function(c){b.importRequired=!1,a.importSuccess="Submissions imported successfully!"},function(){a.importError=err})},a.supportsHTML5Blob=!(!window.Blob||!window.FileReader),a.isExportingtoSpreadsheet=!1,a.subsToCSV=function(){a.isExportingtoSpreadsheet=!0;var d,e=[];c.get("/external/"+a.app._id+"/viewSubs.json").success(function(c,f){function g(b,c,d){var e="object"!=typeof b?JSON.parse(b):b,f="";if(d){var g="";for(var h in e[0])g+=h+",";g=g.slice(0,-1),f+=g+"\r\n"}for(var i=0;i<e.length;i++){var g="";for(var h in e[i])g+='"'+e[i][h]+'",';g.slice(0,g.length-1),f+=g+"\r\n"}if(""==f)return void alert("Invalid data");var j=document.createElement("a");j.id="lnkDwnldLnk",document.body.appendChild(j);var k=f;blob=new Blob([k],{type:"text/csv"});var l;l=window.webkitURL?window.webkitURL.createObjectURL(blob):window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(blob):null;var m=c;a.msSaveBlob=navigator.msSaveBlob,jQuery.support.download=function(){var a=document.createElement("a");return"download"in a}(),$.support.download?$("#lnkDwnldLnk").attr({download:m,href:l}):navigator.msSaveBlob?navigator.msSaveBlob(blob,m):alert("Sorry, this browser doesn't suppor CSV downloads yet."),$("#lnkDwnldLnk")[0].click(),document.body.removeChild(j)}a.isExportingtoSpreadsheet=!1,d=c.Submissions,d=b("togglableFilter")(d,a.filterKey,a.filterVal,a.filterActive),d=b("tagsFilter")(d,a.filterTagVals),d.forEach(function(c){function d(a){if("date"==a.fieldType||"pastDate"==a.fieldType||"futureDate"==a.fieldType)f[a.uniqueId]=b("date")(c.formData[a.uniqueId],"shortDate");else if("time"==a.fieldType)f[a.uniqueId]=b("date")(c.formData[a.uniqueId],"shortTime");else if("checkbox"==a.fieldType){var d=c.formData[a.uniqueId],e="";for(var g in d)d.hasOwnProperty(g)&&(e=e+g+", ");f[a.uniqueId]=e}else f[a.uniqueId]=c.formData[a.uniqueId]}var f={};f.id=c._id,f.createdDate=b("date")(c.createdDate,"short");for(var g=a.app.appFormFields,h=(a.app.mediaSets,c.mediasets),i=0;i<g.length;i++){var j=g[i];if("mediaSet"==j.fieldType||"mediaSetDoc"==j.fieldType||"mediaSetVid"==j.fieldType||"mediaSetAudio"==j.fieldType);else{if(c.formData)if("radio"!=j.fieldType&&"dropdown"!=j.fieldType||!j.isConditional)d(j);else{f[j.uniqueId]=c.formData[j.uniqueId].optionValue;for(var k=c.formData[j.uniqueId].conditionalFields,l=0;l<k.length;l++)d(k[l])}else f[j.uniqueId]=" ";f[j.uniqueId]||(f[j.uniqueId]=" ")}}for(var m=c.tags.sort(),n="",i=0;i<m.length;i++)i==m.length-1?n+=m[i]:n=n+m[i]+", ";f.tags=n,h.length>0&&h.forEach(function(a,b){if(a){var c=a.media;null!=c&&c.forEach(function(a,c){f["mediaset_"+b+"_item_"+c+"_fileName"]=a.originalName;var d=a.mediasetFormData;for(var e in d)d.hasOwnProperty(e)&&(f["mediaset_"+b+"_item_"+c+"_"+e]=d[e])})}}),e.push(f)});var h=JSON.parse(JSON.stringify(e));g(h,"submissions.csv",!0)}).error(function(){})},a.printMe=function(){e.print()},a.openSingleSub=function(a){e.open("/submission/"+a,"","left=20, width=600, height=600")},a.collapseAllFields=function(){for(var b=0;b<a.newSchema.appFormFields.length;b++)a.newSchema.appFormFields[b].isCollapsed=!0},a.expandAllFields=function(){for(var b=0;b<a.newSchema.appFormFields.length;b++)a.newSchema.appFormFields[b].isCollapsed=!1},a.checkAllFieldsCollapsed=function(){for(var b=!0,c=!0,d=0;d<a.newSchema.appFormFields.length;d++)a.newSchema.appFormFields[d].isCollapsed?c=!1:b=!1;b&&(a.collapseBtn=!1),c&&(a.collapseBtn=!0)},a.addOption=function(b,c){var d=a.newSchema.appFormFields[b].fieldTypeOptionsArray.length;a.newSchema.appFormFields[b].fieldTypeOptionsArray.push({optionValue:"",formFieldId:c,optionId:c+"_"+d,isFocused:!0})},a.newConditionalField=function(b,c){for(var d=0;d<a.newSchema.appFormFields.length;d++)if(a.newSchema.appFormFields[d].uniqueId==c){var e=a.newSchema.appFormFields[d].fieldTypeOptionsArray[b].conditionalFields;e||(a.newSchema.appFormFields[d].fieldTypeOptionsArray[b].conditionalFields=[]),a.newSchema.appFormFields[d].fieldTypeOptionsArray[b].conditionalFields.push({fieldType:"text",isMandatory:!1,isPublic:!0,readable:"Text",endUserNotification:!1,isCollapsed:!1,isFocused:!0,isConditional:!1,fieldTypeOptionsArray:[]})}},a.viewDocument=function(a,b){$("#docModal_"+a+"_"+b).modal()},a.openImgEditModal=function(a,b){$("#imgEditModal_"+a+"_"+b).modal()},a.saveImgEdit=function(a,b,d){var e=a.appId,f=b.uuid;j.updateSubandMed(a,function(a){a.durr&&window.console.log("Update Failed")},function(){window.console.log("Update Sub Failed")}),c.get(r+"transfer/"+e+"/"+b+"/"+f+"/"+a).then(function(b){$("#imgEditModal_"+a._id+"_"+d.sequenceNumber).modal("hide")},function(a){})},a.searchMentioFields=function(b){var c=[];angular.forEach(a.newSchema.appFormFields,function(d){return d.fieldName.toUpperCase().indexOf(b.toUpperCase())>=0&&("mediaSet"==d.fieldType||"mediaSetVid"==d.fieldType||"mediaSetDoc"==d.fieldType||"mediaSetAudio"==d.fieldType||"sectionHeader"==d.fieldType||c.push(d)),a.mentioFields=c,o.when(c)})},a.getMentioFieldName=function(a){return"$"+a.uniqueId+"$"},a.setEndUserEmailNotifications=function(b){"email"==b.fieldType&&b.endUserNotification&&void 0==a.newSchema.endUserNotification&&(a.newSchema.endUserNotification=!0,a.newSchema.endUserNotificationSubjectLine=b.endUserNotificationSubjectLine,a.newSchema.endUserNotificationMessage=b.endUserNotificationMessage,a.newSchema.endUserNotificationEmail=[],a.newSchema.endUserNotificationEmail.push(b.uniqueId))};var u=a.uploader=i.create({});u.filters.push(function(b){var c=u.isHTML5?b.type:"/"+b.value.slice(b.value.lastIndexOf(".")+1),d=10;c="|"+c.toLowerCase().slice(c.lastIndexOf("/")+1)+"|";var e=-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(c),f=b.size/1024/1024<=d;return e||(a.logoError=!0,a.logoErrorText="Looks like you accidentally tried to upload something that was not an image. Allowed file types are jpg, png, jpeg, bmp, and gif. Please try again."),f?a.hasError=!1:(a.logoError=!0,a.logoErrorText="Looks like your file was too large. The limit is 10 MB. Please try a different one."),e&&f}),u.bind("afteraddingfile",function(b,c){console.info("After adding a file",c),a.newSchema.logoUploadId=a.newSchema.logoUploadId?a.newSchema.logoUploadId:h.newuuid(),c.url=r+"internalUpload/"+a.newSchema.logoUploadId}),u.bind("whenaddingfilefailed",function(a,b){console.info("When adding a file failed",b)}),u.bind("beforeupload",function(a,b){console.info("Before upload",b)}),u.bind("progress",function(a,b,c){console.info("Progress: "+c,b)}),u.bind("error",function(a,b,c,d){console.info("Error",b,c,d)}),u.bind("complete",function(a,b,c,d){console.info("Complete",b,c,d)}),u.bind("success",function(b,c,d,e){console.log("Success",c,d,e),"success"==e.status&&(a.newSchema.logoURL=e.data.photoUrl)})}]).controller("subCollapse",["$scope",function(a){a.isCollapsed=!1}]),angular.module("admin.directives",["ui.bootstrap","localytics.directives","ngSanitize","ngResource","subPlatformServices","modalServices","pasvaz.bindonce"]).directive("loadingIndicator",function(){return{restrict:"A",template:'<div class="loading"><div id="circleG"><div id="circleG_1" class="circleG"></div><div id="circleG_2" class="circleG"></div><div id="circleG_3" class="circleG"></div></div></div>',link:function(a,b,c){a.$on("loading-started",function(c){b.css({display:""}),a.isLoading=!0}),a.$on("loading-started-hard",function(c){b.css({display:""}),a.isLoading=!0,a.isLoadingHard=!0}),a.$on("loading-complete",function(c){b.css({display:"none"}),a.isLoading=!1}),a.$on("loading-complete-hard",function(c){b.css({display:"none"}),a.isLoading=!1,a.isLoadingHard=!1})}}}).directive("fieldPreview",["$compile","$sce",function(a,b){var c={textTemplate:"<input type='text' placeholder='{{content.placeholder}}' class='form-control' disabled>",mediaSetTemplate:"<button class='btn btn-success' disabled>Attach Photo(s)</button>",numberTemplate:"<input type='number' placeholder='{{content.placeholder}}' class='form-control' disabled>",dateTemplate:"<div class='input-group'><input type='text' class='form-control' disabled><span class='input-group-addon'><i class='fa fa-calendar'></i></span></div>",pastDateTemplate:"<div class='input-group'><input type='text' class='form-control' disabled><span class='input-group-addon'><i class='fa fa-calendar'></i></span></div>",futureDateTemplate:"<div class='input-group'><input type='text' class='form-control' disabled><span class='input-group-addon'><i class='fa fa-calendar'></i></span></div>",dobCheckTemplate:"<div class='input-group'><input type='text' class='form-control' disabled><span class='input-group-addon'><i class='fa fa-calendar'></i></span></div>",sectionHeaderTemplate:"<h3 class='section-header'><label>{{content.fieldName}}</label><small><p class='help-block' ng-bind-html='content.descriptionSafe'></p></small></h3>",subSectionHeaderTemplate:"<h4 class='sub-section-header'><label>{{content.fieldName}}</label><small><p class='help-block' ng-bind-html='content.descriptionSafe'></p></small></h4>",trueFalseTemplate:"<div class='radio'><label><input type='radio'  disabled>True</label></div><div class='radio'><label><input type='radio' disabled>False</label></div>",yesNoTemplate:"<div class='radio'><label><input type='radio' disabled>Yes</label></div><div class='radio'><label><input type='radio' disabled>No</label></div>",radioTemplate:"<div class='radio' ng-repeat='option in content.fieldTypeOptions.split(\",\") track by $index' ng-hide='content.isConditional'><input type='radio' disabled>{{option}}</div><div class='radio' ng-repeat='option in content.fieldTypeOptionsArray' ng-show='content.isConditional'><label><input type='radio' name='{{content.uniqueId}}' value='{{option.optionValue}}' ng-model='content.uniqueId' ng-required='content.isMandatory' disabled>{{option.optionValue}}</label></div><div ng-repeat='option in content.fieldTypeOptionsArray'><div ng-repeat='condField in option.conditionalFields' ng-show='content.uniqueId==option.optionValue'><label ng-hide='condField.fieldType==\"sectionHeader\"'>{{condField.fieldName}} <span ng-show='condField.isMandatory' class='sub_reqText'>*</span></label><span ng-hide='condField.fieldType==\"sectionHeader\"'><p class='help-block' ng-bind-html='condField.descriptionSafe'></p></span><!--<field-preview content='condField'></field-preview>--></div></div></div></div>",dropdownTemplate:"<select class='form-control' disabled  ng-hide='content.isConditional' disabled><option>--Select an option--</option></select><select class='form-control' ng-show='content.isConditional' ng-model='content.uniqueId' ng-options='option.optionValue as option.optionValue for option in content.fieldTypeOptionsArray' disabled><option value=''>--Select an option--</option></select><div ng-repeat='option in content.fieldTypeOptionsArray'><div ng-repeat='condField in option.conditionalFields' ng-show='content.uniqueId==option.optionValue'><label ng-hide='condField.fieldType==\"sectionHeader\"'>{{condField.fieldName}} <span ng-show='condField.isMandatory' class='sub_reqText'>*</span></label><span ng-hide='condField.fieldType==\"sectionHeader\"'><p class='help-block' ng-bind-html='condField.descriptionSafe'></p></span><!--<field-preview content='condField'></field-preview>--></div></div></div></div>",emailTemplate:"<input type='email' placeholder='{{content.placeholder}}' class='form-control' disabled>",checkboxTemplate:"<div class='checkbox' ng-repeat='option in content.fieldTypeOptions.split(\",\")'><label><input type='checkbox' disabled>{{option}}</label></div>",textareaTemplate:"<textarea placeholder='{{content.placeholder}}' class='form-control' disabled></textarea>",mediaSetDocTemplate:"<button class='btn btn-success' disabled>Attach Document</button>",mediaSetVidTemplate:"<button class='btn btn-success' disabled>Attach Video</button>",mediaSetAudioTemplate:"<button class='btn btn-success' disabled>Attach Audio File</button>",firstAndLastNameTemplate:"<div class='row'><div class='col-sm-6'><input type='text' placeholder='{{content.placeholder}}' class='form-control' disabled><p class='help-block'>First</p></div><div class='col-sm-6'><input type='text' placeholder='{{content.placeholder}}' class='form-control' disabled><p class='help-block'>Last</p></div></div>",phoneNumberTemplate:"<div class='row'><div class='col-sm-1 phone-num'><input type='number' class='form-control' disabled><p class='help-block'>###</p></div><div class='col-sm-1 em-dash'>&#8212;</div><div class='col-sm-1 phone-num'><input type='number' class='form-control' disabled><p class='help-block'>###</p></div><div class='col-sm-1 em-dash'>&#8212;</div><div class='col-sm-1 phone-num'><input type='number' class='form-control' disabled><p class='help-block'>####</p></div></div>",addressTemplate:"<div class='row'><div class='col-sm-12'><input type='text' class='form-control' disabled><p class='help-block'>Street Address</p></div></div><div class='row'><div class='col-sm-12'><input type='text' class='form-control' disabled><p class='help-block'>Address Line 2</p></div></div><div class='row'><div class='col-sm-6'><input type='text' class='form-control' disabled><p class='help-block'>City</p></div><div class='col-sm-6'><input type='text' class='form-control' disabled><p class='help-block'>State/Province/Region</p></div></div><div class='row'><div class='col-sm-6'><input type='text' class='form-control' disabled><p class='help-block'>Postal Code</p></div><div class='col-sm-6'><select class='form-control' disabled><option>United States</option></select><p class='help-block'>Country</p></div></div>",timeTemplate:"<timepicker ng-disabled ng-model='timeTemp'></timepicker>"},d=function(a){var b={};return b=c[a.fieldType+"Template"],"undefined"!=typeof b&&null!=b?b:""},e=function(c,e,f){c.$watch("content",function(f){c.content.description&&(c.content.descriptionSafe=b.trustAsHtml(c.content.description)),e.html(d(f)).show(),a(e.contents())(c)},!0)};return{restrict:"E",replace:!0,link:e,scope:{content:"="}}}]).directive("mediaLink",function(){return{link:function(a,b,c){var d;d="0"!=c.mediasetId?c.bucketId+"/"+c.mediasetId+"/"+c.fileName:c.bucketId+"/"+c.fileName,c.$set("href",d)}}}).directive("mediaSrc",function(){return{link:function(a,b,c){"0"!=c.mediasetId?c.$set("src",c.bucketId+"/"+c.mediasetId+"/"+c.fileName):c.$set("src",c.bucketId+"/"+c.fileName)}}}).directive("editableFormfield",["$compile","$filter","$http","subService",function(a,b,c,d){var e={plainTextTemplate:'<div ng-hide="editOn" ng-click="editOn=true; tempValue=model"><label for="{{formId}}_{{content.fieldName}}" class="question"><span bo-text="content.fieldName"></span>&nbsp;-&nbsp;</label><span class="angular-with-newlines">{{readableModel}}</span></div>',wufooUploadTemplate:'<div><label for="{{formId}}_{{content.fieldName}}" class="question"><span bo-text="content.fieldName"></span>&nbsp;-&nbsp;</label><a href="{{readableModel}}">Download From Wufoo <span class="fa fa-download"></a></div>',textTemplate:'<div ng-show="editOn" class="form-group"><label for="{{formId}}_{{content.fieldName}}" class="question"><span bo-text="content.fieldName"></span></label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <p ng-show="content.description" class="help-block" bo-text="content.description"></p>  <input type="text" ng-model="model" value="{{model}}" name="{{content.fieldName}}" class="form-control" ng-required="content.isMandatory" placeholder="{{content.placeholder}}"/><span ng-show="">This field is required.</span> </div>',numberTemplate:'<div ng-show="editOn" class="form-group"><label for="{{formId}}_{{content.fieldName}}" class="question"><span bo-text="content.fieldName"></span></label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <p ng-show="content.description" class="help-block" bo-text="content.description"></p> <input type="number" ng-model="model" value="{{content.value}}" name="{{content.fieldName}}" id="{{formId}}_{{content.fieldName}}"  class="form-control" ng-required="content.isMandatory" placeholder="{{content.placeholder}}"/> </div>',dateTemplate:'<div ng-show="editOn" class="form-group"><label for="{{formId}}_{{content.fieldName}}" class="question"><span bo-text="content.fieldName"></span></label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <p ng-show="content.description" class="help-block" bo-text="content.description"></p> <p class="input-group"><input type="text" id="{{formId}}_{{content.fieldName}}"  class="form-control" ng-model="model" is-open="opened" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" close-text="Close"  datepicker-popup="{{format}}">{{content.value | date:"yyyy-MM-dd"}}<span class="input-group-btn"><button class="btn btn-default" ng-click="opened = true;$event.preventDefault();$event.stopPropagation();"><i class="fa fa-calendar"></i></button></span></p></div>',pastDateTemplate:'<div ng-show="editOn" class="form-group"><label for="{{formId}}_{{content.fieldName}}" class="question"><span bo-text="content.fieldName"></span></label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <p ng-show="content.description" class="help-block" bo-text="content.description"></p>  <p class="input-group"><input type="text" id="{{formId}}_{{content.fieldName}}"  class="form-control" datepicker-popup="{{format}}" ng-model="model" is-open="opened" max="now" show-weeks="false" datepicker-options="dateOptions" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" close-text="Close" />{{content.value | date:"yyyy-MM-dd"}}<span class="input-group-btn"><button class="btn btn-default" ng-click="opened = true;$event.preventDefault();$event.stopPropagation();"><i class="fa fa-calendar"></i></button></span></p></div>',
futureDateTemplate:'<div ng-show="editOn" class="form-group"><label for="{{formId}}_{{content.fieldName}}"  class="question"><span bo-text="content.fieldName"></span></label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <p ng-show="content.description" class="help-block" bo-text="content.description"></p>  <p class="input-group"><input type="text" id="{{formId}}_{{content.fieldName}}"  class="form-control" datepicker-popup="{{format}}" ng-model="model" is-open="opened" min="now" show-weeks="false" datepicker-options="dateOptions" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" close-text="Close" />{{content.value | date:"yyyy-MM-dd"}}<span class="input-group-btn"><button class="btn btn-default" ng-click="opened = true;$event.preventDefault();$event.stopPropagation();"><i class="fa fa-calendar"></i></button></span></p></div>',dobCheckTemplate:'<p ng-show="editOn">{{readableModel}}<span class="optional-text"> This field is not editable.</span></p>',trueFalseTemplate:'<div ng-show="editOn" class="form-group"><label for="{{formId}}_{{content.fieldName}}"  class="question"><span bo-text="content.fieldName"></span></label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <p ng-show="content.description" class="help-block" bo-text="content.description"></p> <div class="radio"> <label><input type="radio" name="{{content.fieldName}}" value="true" ng-model="model" ng-required="content.isMandatory" placeholder="{{content.placeholder}}"/> True </label> </div><div class="radio"><label><input type="radio" name="{{content.fieldName}}" value="false" ng-model="model" ng-required="content.isMandatory"/> False </label> </div></div>',yesNoTemplate:'<div ng-show="editOn" class="form-group"><label for="{{formId}}_{{content.fieldName}}"  class="question"><span bo-text="content.fieldName"></span></label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <p ng-show="content.description" class="help-block" bo-text="content.description"></p> <div class="radio"> <label><input type="radio" name="{{content.fieldName}}" value="yes" ng-model="model" ng-required="content.isMandatory" placeholder="{{content.placeholder}}"/> Yes </label> </div><div class="radio"><label><input type="radio" name="{{content.fieldName}}" value="no" ng-model="model" ng-required="content.isMandatory"/> No </label> </div></div>',radioTemplate:'<div ng-show="editOn" class="form-group"><label for="{{formId}}_{{content.fieldName}}"  class="question"><span bo-text="content.fieldName"></span></label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <p ng-show="content.description" class="help-block" bo-text="content.description"></p>  <div class="radio" ng-repeat="field in content.fieldTypeOptions.split(\',\') track by $index" ng-hide="content.isConditional"><label><input type="radio" name="{{content.fieldName}}" value="{{field}}" ng-model="$parent.model" ng-required="content.isMandatory"/> {{field}}</label> </div><div class="radio" ng-repeat="option in content.fieldTypeOptionsArray" ng-show="content.isConditional"><label><input type="radio" name="{{content.fieldName}}" ng-value="option" id="{{option.optionId}}" ng-model="$parent.model" ng-required="content.isMandatory"/> {{option.optionValue}}</label> </div></div>',dropdownTemplate:'<div ng-show="editOn" class="form-group"><label for="{{formId}}_{{content.fieldName}}"  class="question"><span bo-text="content.fieldName"></span></label> <span ng-show="content.isMandatory" class="sub_reqText">*</span><p ng-show="content.description" class="help-block" bo-text="content.description"></p>  <select ng-model="model" ng-options="option for option in content.fieldTypeOptions.split(\',\')" name="{{content.fieldName}}" id="{{formId}}_{{content.fieldName}}"  class="form-control" ng-required="content.isMandatory" value="{{content.value}}" ng-hide="content.isConditional"> <option value="">-- Select an option --</option> </select> <select ng-model="model" ng-options="option.optionValue as option.optionValue for option in content.fieldTypeOptionsArray" name="{{content.fieldName}}" id="{{formId}}_{{content.fieldName}}"  class="form-control" ng-required="content.isMandatory" value="{{content.value}}" ng-show="content.isConditional"> <option value="">-- Select an option --</option> </select></div>',emailTemplate:'<div ng-show="editOn" class="form-group"><label for="{{formId}}_{{content.fieldName}}"  class="question"><span bo-text="content.fieldName"></span></label> <span ng-show="content.isMandatory" class="sub_reqText">*</span><input type="email" ng-model="model" name="{{content.fieldName}}" id="{{formId}}_{{content.fieldName}}"  class="form-control" ng-required="content.isMandatory" placeholder="{{content.placeholder}}"/> </div>',checkboxTemplate:'<div ng-show="editOn" class="form-group"><label><span bo-text="content.fieldName"></span></label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <p ng-show="content.description" class="help-block" bo-text="content.description"></p>  <div class="checkbox" ng-repeat="field in content.fieldTypeOptions.split(\',\')" ng-init="$parent.model = $parent.model || {}"><label><input ng-model="$parent.model[field]" type="checkbox" name="{{content.uniqueId}}"/> {{field}} <input type="text" class="form-control" ng-show="$last && content.hasOtherField" ng-model="$parent.model[\'otherVal\']"></label> </div></div>',textareaTemplate:'<div ng-show="editOn" class="form-group"><label for="{{formId}}_{{content.fieldName}}"  class="question"><span bo-text="content.fieldName"></span></label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <p ng-show="content.description" class="help-block" bo-text="content.description"></p>  <textarea ng-model="model" name="{{content.fieldName}}" id="{{formId}}_{{content.fieldName}}"  class="form-control" ng-required="content.isMandatory" placeholder="{{content.placeholder}}"></textarea> </div>',closeCancelButtons:'<button ng-show="editOn" ng-click="saveEdit()" ><span class="fa fa-check"></span></button><button ng-show="editOn" ng-click="cancelEdit()" ><span class="fa fa-remove"></span></button>',sectionHeaderTemplate:'<div><label><span bo-text="content.fieldName"></span></label></div>',subSectionHeaderTemplate:'<div><label><span bo-text="content.fieldName"></span></div>',timeTemplate:'<div ng-show="editOn" class="form-group"><label for="{{formId}}_{{content.fieldName}}" class="question"><span bo-text="content.fieldName"></span>}}</label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <p ng-show="content.description" class="help-block" bo-text="content.description"></p> </div>',parameterTemplate:"",conditionalRadioTemplate:'<div class="row"><div class="col-sm-11 col-sm-offset-1"><div ng-repeat="option in content.fieldTypeOptionsArray"><div ng-repeat="condField in option.conditionalFields"><editable-formfield form-id="application._id" content="condField" model="submission.formData[condField.uniqueId]" submission="submission" ng-show="model.optionValue == option.optionValue"> </editable-formfield></div></div></div></div>',conditionalDropdownTemplate:'<div class="row"><div class="col-sm-11 col-sm-offset-1"><div ng-repeat="option in content.fieldTypeOptionsArray"><div ng-repeat="condField in option.conditionalFields"><editable-formfield form-id="application._id" content="condField" model="submission.formData[condField.uniqueId]" submission="submission" ng-show="model == option.optionValue"> </editable-formfield></div></div></div></div>'},f=function(a){var b={},c=e[a.content.fieldType+"Template"];if("undefined"!=c&&null!=c&&"sectionHeader"!=a.content.fieldType&&"subSectionHeader"!=a.content.fieldType&&"wufooUpload"!=a.content.fieldType)if("radio"!=a.content.fieldType&&"dropdown"!=a.content.fieldType||!a.content.isConditional)b=e[a.content.fieldType+"Template"]+e.closeCancelButtons+e.plainTextTemplate;else{var d;"radio"==a.content.fieldType?d=e.conditionalRadioTemplate:"dropdown"==a.content.fieldType&&(d=e.conditionalDropdownTemplate),b=e[a.content.fieldType+"Template"]+e.closeCancelButtons+e.plainTextTemplate+d}else"sectionHeader"==a.content.fieldType||"subSectionHeader"==a.content.fieldType?b=e[a.content.fieldType+"Template"]:"wufooUpload"==a.content.fieldType?b=e.wufooUploadTemplate:"mediaSet"==a.content.fieldType||"mediaSetDoc"==a.content.fieldType||"mediaSetVid"==a.content.fieldType||"mediaSetAudio"==a.content.fieldType||(b=e.textTemplate+e.closeCancelButtons+e.plainTextTemplate);return b},g=function(c,e,g){c.editOn=!1,c.tempValue=null,c.setReadableModel=function(){if("checkbox"===c.content.fieldType){var a="",d="",e="",f=c.content.fieldTypeOptions.slice(-6);c.content.hasOtherField&&",Other"!=f&&(c.content.fieldTypeOptions=c.content.fieldTypeOptions+",Other"),angular.forEach(c.model,function(b,f,g){b&&("Other"==f&&c.content.hasOtherField?d=", "+f+": ":"otherVal"==f&&c.content.hasOtherField?e=b:a=a+", "+f)}),c.readableModel=a+d+e}else if("radio"===c.content.fieldType)c.content.isConditional?c.readableModel=c.model?c.model.optionValue:"":c.readableModel=c.model;else if("futureDate"===c.content.fieldType||"pastDate"===c.content.fieldType||"date"===c.content.fieldType||"time"===c.content.fieldType||"dobCheck"===c.content.fieldType){var g=new Date(c.model);"[object Date]"===Object.prototype.toString.call(g)?""==g.valueOf()||null==g.valueOf()?c.readableModel=c.model:"futureDate"===c.content.fieldType||"pastDate"===c.content.fieldType||"date"===c.content.fieldType||"dobCheck"===c.content.fieldType?(c.readableModel=c.model?b("date")(c.model,"yyyy-MM-dd"):"",c.format="yyyy-MM-dd"):"time"===c.content.fieldType&&(c.readableModel=c.model?b("date")(c.model,"shortTime"):""):c.readableModel=c.model}else c.readableModel=c.model},"futureDate"!==c.content.fieldType&&"pastDate"!==c.content.fieldType||(c.now=Date.now()),c.setReadableModel(),e.html(f(c)).show(),c.cancelEdit=function(){c.editOn=!1,c.model=c.tempValue},c.saveEdit=function(){if(c.editOn=!1,"futureDate"===c.content.fieldType||"pastDate"===c.content.fieldType||"date"===c.content.fieldType){var a=c.model.getFullYear(),b=c.model.getDate(),e=c.model.getMonth()+1;c.model=a+"-"+e+"-"+b}if("checkbox"===c.content.fieldType){var f={};angular.forEach(c.model,function(a,b,c){a&&(f[b]=a)}),c.submission.formData[c.content.uniqueId]=f}d.updateSub(c.submission,function(a){c.response=a,c.setReadableModel()},function(){})},a(e.contents())(c)};return{restrict:"E",replace:!0,link:g,scope:{content:"=",formId:"=?",submission:"=",model:"=?"}}}]).directive("mediaFormfield",["$compile","$filter","$http",function(a,b,c){var d=function(c,d,e){if(angular.forEach(c.formData,function(a,b,d){b==c.field.uniqueId&&(c.value=a)}),"checkbox"===c.field.fieldType){var f="";angular.forEach(c.value,function(a,b,c){a&&(f=f+", "+b)}),c.readableModel=f.substring(2)}else if("futureDate"===c.field.fieldType||"pastDate"===c.field.fieldType||"date"===c.field.fieldType||"time"===c.field.fieldType)if(c.value){var g=new Date(c.value);"[object Date]"===Object.prototype.toString.call(g)?""==g.valueOf()||null==g.valueOf()||isNaN(g.valueOf())?c.readableModel=c.value:"futureDate"===c.field.fieldType||"pastDate"===c.field.fieldType||"date"===c.field.fieldType?(c.readableModel=c.value?b("date")(c.value,"yyyy-MM-dd"):"",c.format="yyyy-MM-dd"):"time"===c.field.fieldType&&(c.readableModel=c.value?b("date")(c.value,"shortTime"):""):c.readableModel=c.value}else c.readableModel="";else c.readableModel=c.value;d.html("<label><span bo-text='field.fieldName'></span></label> - {{readableModel}}").show(),a(d.contents())(c)};return{restrict:"E",replace:!0,link:d,scope:{field:"=",formData:"="}}}]).directive("queryBuilder",["$compile",function(a,b){return{restrict:"E",scope:{group:"=",test:"=",subsSearch:"="},templateUrl:"/queryBuilderDirective.html",compile:function(b,c){var d,e;return d=b.contents().remove(),function(b,c,f){b.operators=[{name:"&"},{name:"OR"}],b.conditions=[{name:"=",symbol:"f"},{name:"<",symbol:"lt"},{name:"<=",symbol:"lte"},{name:">",symbol:"gt"},{name:">=",symbol:"gte"}],b.addCondition=function(){b.group.rules.push({condition:"f",field:"",data:""})},b.removeCondition=function(a){b.group.rules.splice(a,1)},b.addGroup=function(){b.group.rules.push({group:{operator:"&",rules:[]}})},b.removeGroup=function(){"group"in b.$parent&&b.$parent.group.rules.splice(b.$parent.$index,1)},e||(e=a(d)),c.append(e(b))}}}}]).directive("querySingle",["$compile",function(a,b){return{restrict:"E",scope:{group:"=",fields:"=",contentType:"="},templateUrl:"/querySingleDirective.html",compile:function(b,c){var d,e;return d=b.contents().remove(),function(b,c,f){b.searchField={type:"text"},b.operators=[{name:"&"},{name:"OR"}],b.conditions=[{name:"f"}],b.group.rules.push({condition:"f",field:"",data:""}),b.addGroup=function(){b.group.rules.push({group:{operator:"&",rules:[]}})},b.removeGroup=function(){"group"in b.$parent&&b.$parent.group.rules.splice(b.$parent.$index,1)},e||(e=a(d)),c.append(e(b))}}}}]).directive("bnLazySrc",["$window","$document",function(a,b){function c(a){function b(b,c){if(!a.is(":visible"))return!1;null===h&&(h=a.height());var d=a.offset().top,e=d+h;return c>=d&&d>=b||c>=e&&e>=b||b>=d&&e>=c}function c(){g=!0,e()}function d(a){f=a,g&&e()}function e(){a[0].src=f}var f=null,g=!1,h=null;return{isVisible:b,render:c,setSource:d}}function d(a,b,d){var f=new c(b);e.addImage(f),d.$observe("bnLazySrc",function(a){f.setSource(a)}),a.$on("$destroy",function(){e.removeImage(f)})}var e=function(){function c(a){l.push(a),m||h(),t||i()}function d(a){for(var b=0;b<l.length;b++)if(l[b]===a){l.splice(b,1);break}l.length||(g(),j())}function e(){if(!m){var a=p.height();a!==q&&(q=a,h())}}function f(){for(var a=[],b=[],c=o.height(),d=o.scrollTop(),e=d,f=e+c,h=0;h<l.length;h++){var i=l[h];i.isVisible(e,f)?a.push(i):b.push(i)}for(var h=0;h<a.length;h++)a[h].render();l=b,g(),l.length||j()}function g(){clearTimeout(m),m=null}function h(){m=setTimeout(f,n)}function i(){t=!0,o.on("resize.bnLazySrc",k),o.on("scroll.bnLazySrc",k),r=setInterval(e,s)}function j(){t=!1,o.off("resize.bnLazySrc"),o.off("scroll.bnLazySrc"),clearInterval(r)}function k(){m||h()}var l=[],m=null,n=100,o=$(a),p=b,q=p.height(),r=null,s=2e3,t=!1;return{addImage:c,removeImage:d}}();return{link:d,restrict:"A"}}]).directive("csvUrl",["$compile","$filter","$http",function(a,b,c){var d=function(a,b,c){a.$watch(a.value,function(b){a.csvUploaded=!0})};return{restrict:"E",replace:!0,link:d,scope:{csvUploaded:"=",value:"="}}}]).directive("variedFieldType",["$compile","$filter","$http",function(a,b,c){var d={textTemplate:'<div class="form-group"><label for="{{formId}}_{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <p ng-show="content.description" class="help-block">{{content.description}}</p>  <input type="text" ng-model="model" value="{{content.default}}" name="{{formId}}_{{content.uniqueId}}" class="form-control" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" id="{{formId}}_{{content.uniqueId}}"/><span ng-show="">This field is required.</span> </div>',dateTemplate:'<div class="form-group"><label for="{{formId}}_{{content.uniqueId}}" >{{content.fieldName}}</label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <p ng-show="content.description" class="help-block">{{content.description}}</p> <p class="input-group"><input value="{{content.default}}" type="text" id="{{formId}}_{{content.uniqueId}}"  class="form-control" datepicker-popup="{{format}}" ng-model="model" is-open="opened" min="minDate" show-weeks="false" datepicker-options="dateOptions" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" close-text="Close" /><span class="input-group-btn"><button class="btn btn-default" ng-click="opened = true;$event.preventDefault();$event.stopPropagation();"><i class="fa fa-calendar"></i></button></span></p></div>'},e=function(a){var b={};return b=content.isPublic?d[content.fieldType+"Template"]:d.hiddenTemplate,"undefined"!=typeof b&&null!=b?b:""},f=function(b,c,d){c.html(e(b.contentType)).show(),a(c.contents())(b)};return{restrict:"E",replace:!0,link:f,scope:{contentType:"="}}}]).directive("syncFocusWith",["$timeout","$rootScope",function(a,b){return{restrict:"A",scope:{focusValue:"=syncFocusWith"},link:function(a,b,c){a.$watch("focusValue",function(a,c){a===!0&&c&&b[0].focus()})}}}]),angular.module("admin.filters",[]).filter("togglableFilter",[function(){return function(a,b,c,d){if(!angular.isDefined(d)||!d)return a;var e=[];return angular.isDefined(b)&&angular.forEach(a,function(a){var d=a[b];angular.isString(d)||angular.isArray(d)||(d=new String(d)),-1!==d.indexOf(c)&&e.push(a)}),e}}]).filter("tagsFilter",[function(){return function(a,b){function c(a,b){for(var c=0;c<a.length;c++)if(-1===b.indexOf(a[c]))return!1;return!0}if(0==b.length)return a;var d=[],e="tags";return angular.isDefined(e)&&angular.forEach(a,function(a){var f=a[e];0!=f.length&&c(b,f)&&d.push(a)}),d}}]).filter("slice",function(){return function(a,b,c,d){return d?a||[]:(end=b*c,start=end-c,(a||[]).slice(start,end))}}).filter("creationDate",[function(){return function(a){var b=1e3*parseInt(a.substring(0,8),16),c=new Date(b);return c}}]).filter("subsWithTag",[function(){return function(a,b,c){if(b){var d=[];return angular.forEach(a,function(a,b,e){-1!=a.tags.indexOf(c)&&d.push(a)}),d||[]}return a||[]}}]).filter("nospace",[function(){return function(a){return a?a.toLowerCase().replace(/[^a-z0-9\s]/gi,"").replace(/[_\s]/g,"_"):""}}]).filter("removeExt",[function(){return function(a){var b=a.indexOf("."),c=a.substring(0,b);return c}}]).filter("tel",function(){return function(a){if(!a)return"";var b=a.toString().trim().replace(/^\+/,"");if(b.match(/[^0-9]/))return a;var c,d,e;switch(b.length){case 10:c=1,d=b.slice(0,3),e=b.slice(3);break;case 11:c=b[0],d=b.slice(1,4),e=b.slice(4);break;case 12:c=b.slice(0,3),d=b.slice(3,5),e=b.slice(5);break;default:return a}return 1==c&&(c=""),e=e.slice(0,3)+"-"+e.slice(3),(c+" ("+d+") "+e).trim()}}).filter("unique",["$parse",function(a){return function(b,c){if(c===!1)return b;if((c||angular.isUndefined(c))&&angular.isArray(b)){var d=[],e=angular.isString(c)?a(c):function(a){return a},f=function(a){return angular.isObject(a)?e(a):a};angular.forEach(b,function(a){for(var b=!1,c=0;c<d.length;c++)if(angular.equals(f(d[c]),f(a))){b=!0;break}b||d.push(a)}),b=d}return b}}]).filter("exclude",function(){return function(a,b){for(var c=[],d=0;d<a.length;d++)a[d].name!=b&&c.push(a[d]);return c}}).filter("notNull",function(){return function(a){var b=[];if(a)for(var c=0;c<a.length;c++)null!=a[c]&&b.push(a[c]);return b}}).filter("condition",function(){return function(a){var b=a;return"lt"==b?b="<":"lte"==b?b="<=":"gt"==b?b=">":"gte"==b?b=">=":"f"==b&&(b="="),b}}).filter("docIframeUrl",["$sce",function(a){return function(b){return a.trustAsResourceUrl("//view.officeapps.live.com/op/view.aspx?src="+b)}}]).filter("audioUrl",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]).filter("comparedSubFilter",["value",function(a){return-1!==$scope.comparedSubmissions.indexOf(a._id)}]);var embed=angular.module("embed",[]);embed.factory("embedForm",function(){return{createFormHTML:function(a){var b;if(a.newSchema.active){b="<div class='sub_formErrors sub_reqText' style='display:none;'>Oops! There is a problem with the form, please check and correct below.</div>";var c=a.newSchema.appDescription?a.newSchema.appDescription:"";b=b+"<h1>"+a.newSchema.appName+"</h1><h2>"+c+"</h2><h5 class='sub_reqText'>*Required</h5>",b=b+"<input class='sub_appInfo' type='hidden' name='applicationName.appInfo' value='"+a.newSchema.appName+"'><input class='sub_appInfo' type='hidden' name='approved.appInfo' value='"+a.newSchema.autoApproved+"'><input class='appInfo' type='hidden' name='customerId.appInfo' value='"+a.newSchema.customerId+"'>",angular.forEach(a.newSchema.appFormFields,function(a,c){if(a.isPublic){var d,e,f,g="",h="",i="";"true"==a.isMandatory?(d="<span class='sub_reqText'>*</span>",e="sub_required"):(d="",e="");var j=a.description?a.description:"";g="<h4 class='sub_name'>"+d+a.fieldName+" <label id='error_id_"+a.uniqueId+"' class='sub_reqText sub_errorMsg' style='display:none;'></label></h4><h5 class='sub_desc'>"+j+"</h5>";var k=a.placeholder?a.placeholder:"";switch(a.fieldType){case"sectionHeader":h="<h3 class='sub_section-header'>"+a.fieldName+"</h3>";break;case"radio":case"checkbox":f=a.fieldTypeOptions.split(","),angular.forEach(f,function(b,c){i=i+"<input type='"+a.fieldType+"'class='"+e+" sub_"+a.uniqueId+" 'name='"+a.uniqueId+"' value='"+$.trim(b)+"' id='_"+b+a.uniqueId+"'><label for='"+b+a.uniqueId+"'>"+$.trim(b)+"</label><br>"}),h=g+i;break;case"dropdown":f=a.fieldTypeOptions.split(","),angular.forEach(f,function(a,b){i=i+"<option value='"+$.trim(a)+"'>"+$.trim(a)+"</option>"}),h=g+"<select name='"+a.uniqueId+"' class='"+e+"' id='id_"+a.uniqueId+"'>"+i+"</select>";break;case"trueFalse":h=g+"<input type='radio' class='"+e+" sub_"+a.uniqueId+"'name='"+a.uniqueId+"' value='true' id='true_"+a.uniqueId+"'><label  for='true_"+a.uniqueId+"' >True</label><br><input type='radio' class='"+e+" sub_"+a.uniqueId+"'name='"+a.uniqueId+"' value='false' id='false_"+a.uniqueId+"' ><label  for='false_"+a.uniqueId+"' >False</label><br>";break;case"textarea":h=g+"<textarea name='"+a.uniqueId+"' placeholder='"+k+"' class='"+e+"'  id='_"+a.uniqueId+"' value=''></textarea><br>";break;case"yesNo":h=g+"<input type='radio' class='"+e+" sub_"+a.uniqueId+"'name='"+a.uniqueId+"' value='yes' id='yes_"+a.uniqueId+"' ><label  for='yes_"+a.uniqueId+"' >Yes</label><br><input type='radio' class='"+e+" sub_"+a.uniqueId+"'name='"+a.uniqueId+"' value='no' id='no_"+a.uniqueId+"' ><label  for='no_"+a.uniqueId+"' >No</label><br>";break;case"mediaSet":h=g+'<button onclick="createMediasetModal('+a.mediaSetId+")\" type='button'>Upload Photo(s)</button><label id='error_uniqueUploadId"+a.mediaSetId+"' class='sub_reqText errorMsg' style='display:none;'></label><br><br><div id='"+a.mediaSetId+"_modal' style='display:none;position: fixed;top: 0;right: 0;bottom: 0;left: 0;z-index: 99999;background: rgba(0, 0, 0, 0.8);'><div style='width:75%;background-color: white;position: relative;margin: 10px auto;'><a style='font-size: 1.375em;line-height: 1;position: absolute;top: 0.5em;right: 0.6875em;color: #aaaaaa;font-weight: bold;cursor: pointer;text-decoration: none;cursor:pointer;' id='"+a.mediaSetId+"_modalClose'>x</a><br><br><iframe style='width: 99%;height: 500px;border: none;'></iframe></div></div><input type='hidden' class='"+e+"' name='uniqueUploadId.mediaset"+a.mediaSetId+"' ><input type='hidden' name='transfered.mediaset"+a.mediaSetId+"' value='false'><input type='hidden' name='mediasetId.mediaset"+a.mediaSetId+"' value='"+a.mediaSetId+"'><div id='uploadedPhoto"+a.mediaSetId+"' style='display:none'></div>";break;case"date":case"pastDate":case"futureDate":var l=new Date,m=l.getFullYear(),n=l.getMonth(),o=l.getDate(),p=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],q=1,r=0,s=1950,t=31,u=1,v=l.getFullYear(),w=p.length,x="<select name='months"+a.uniqueId+".dateComponent' class='"+e+" months"+a.uniqueId+"'>";"futureDate"==a.fieldType&&(r=n);for(var y=r;w>y;y++)x=x+"<option value='"+(y+1)+"'>"+p[y]+"</option>";x+="</select>","futureDate"==a.fieldType&&(u=o);for(var z="<select name='days"+a.uniqueId+".dateComponent' class='"+e+" days"+a.uniqueId+"'>",y=u;t>=y;y++)z=z+"<option value='"+y+"'>"+y+"</option>";z+="</select>";var A="<select name='years"+a.uniqueId+".dateComponent' class='"+e+" years"+a.uniqueId+"'>";"futureDate"==a.fieldType&&(s=m,v=m+10);for(var y=s;v>=y;y++)A=A+"<option value='"+y+"'>"+y+"</option>";A+="</select>",h=g+x+z+A+"<input type='hidden' name='"+a.uniqueId+"' class='date"+a.uniqueId+"' value='"+s+"-"+q+"-"+u+"'><br>";break;default:h=g+"<input type='"+a.fieldType+"'class='"+e+" sub_"+a.fieldType+" 'name='"+a.uniqueId+"' placeholder='"+k+"' id='id_"+a.uniqueId+"' value=''></input><br>"}b+=h}})}else b="<h1>"+a.newSchema.appName+"</h1><h3>This platform is currently not accepting submissions.</h3>";var d=a.newSchema.callToAction?a.newSchema.callToAction:"Submit";return b=b+"<br><button type='submit'>"+d+"</button>"}}}),angular.module("admin",["admin.controllers","admin.directives"]).config(["$locationProvider",function(a){}]),angular.module("profile",["profile.controllers","profile.directives"]),angular.module("profile.controllers",["ui.bootstrap","uuids","profile.filters","subPlatformServices","modalServices","pasvaz.bindonce"]).controller("SettingsCtrl",["$scope","$http","rfc4122","userService","acctService","formService","modals",function(a,b,c,d,e,f,g){a.loginRegister="New user? Register here!",a.goRegister=!1,a.forgotPW=!1,a.predicate="-createdDate",a.status=null,a.pass={},a.userManagement={},a.newUser={},a.addNewUser=!1,a.loginType="sub",a.quotes=[{value:"Hello"}],a.randomQuote=a.quotes[Math.floor(Math.random()*a.quotes.length)],a.addAUser=function(){a.addNewUser=!0,a.newUser={},a.userManagement.success="",a.newUser.role="user"},a.setUserStatus=function(b,c){var e=b;e.account.status=c,d.updateUserStatus(e,function(c){c.error?a.userManagement.error=c.error:b=e},function(){a.userManagement.error="Failed to update user"})},a.setUserRole=function(b){var c=b;d.updateUserStatus(c,function(d){d.error?a.userManagement.error=d.error:b=c},function(){a.userManagement.error="Failed to update user"})},a.addUserModal=function(b,c,d){var e={closeButtonText:"Cancel",actionButtonText:"Finished",headerText:"Add A User",bodyText:"",photo:b,mediaset:c,submission:d};g.showModal({templateUrl:"userManagement.html",scope:a},e).then(function(a){})},a.setDefaultCategory=function(a){d.updateUser(a,function(a){})},a.addCategory=function(b,c,d){for(i=0;i<c.categories.length;i++){if(b.toUpperCase()==c.categories[i].categoryName.toUpperCase()){a.categoryError=!0,a.categoryErrorValue=b;break}a.categoryError=!1}if(!a.categoryError){var e={categoryName:b};c.categories.push(e),a.updateAccount(c,d)}},a.openDeleteCategoryModal=function(c,d){var e={mustMatch:{"categories._id":c}};b({method:"POST",url:"/elasticSearch/"+d._id+"/apps",data:e}).success(function(b){a.catCount=b.Results.total,$("#deleteCategoryModal_"+c).modal("show")}).error(function(b){a.catCount=0,$("#deleteCategoryModal_"+c).modal("show")})},a.deleteCategory=function(b,c,d,e,g){g.defaultCategory&&g.defaultCategory._id==d&&(delete g.defaultCategory,a.setDefaultCategory(g)),c.categories.splice(b,1),a.updateAccount(c,g);var h=d;f.deleteCategoryFromForms({id:h},function(a){$("#deleteCategoryModal_"+d).modal("hide"),$(".fade").removeClass("in modal-backdrop"),$("body").removeClass("modal-open")})},a.updateAccount=function(a,b){for(var c=a.categories.length-1;c>=0;c--)k=a.categories[c],k.exclude&&a.categories.splice(c,1);e.updateAccount(a,function(c){if(null==b.defaultCategory){var d=a.categories[a.categories.length-1];"undefined"==typeof d._id&&(d._id="temp")}})},a.addUserToAccount=function(b){var c={customerName:a.newUser.name,userName:a.newUser.userName.toLowerCase(),emailAddress:a.newUser.emailAddress,account:{acctId:b,role:a.newUser.role}},e={invite:!0,user:c};d.register(e,function(b){b.error?a.userManagement.error=b.error:(a.userManagement.success="An email has been sent to "+a.newUser.emailAddress+" with further instructions.",a.addNewUser=!1,a.newUser="")},function(){a.userManagement.error="Failed to create user"})},a.onLoginRegister=function(){0==a.goRegister?(a.goRegister=!0,a.loginRegister="Sign In"):(a.loginRegister="New user? Register here!",a.goRegister=!1),a.hideErrorMsg=!0}}]).controller("AppCtrl",["$scope","$filter","$http","rfc4122","formService","userService","acctService","subService",function(a,b,c,d,e,f,g,h){a.customerId=null,a.init=function(b,c,d,e,h){a.customerId=b,a.customerRole=d,a.accountId=c,a.accountType=e,a.isLDAP=h,a.activeDate=new Date,a.pass.change=!1,a.account={},g.getAcct({id:c},function(b){a.account=b.accountInfo});var i={};i._id=a.customerId,i.activeDate=a.activeDate,f.updateUserLastActiveDate(i,function(b){b.error?a.userManagement.error=b.error:user=i},function(){a.userManagement.error="Failed to update user"}),f.getUserForms({id:a.customerId},function(b){a.applications=b.applicationInfo}),g.getAcctForms({id:a.accountId},function(b){a.accountApps=b.acctAppsInfo,a.customerInfoMap=b.customerinfoMap}),g.getAcctSubs({id:a.accountId},function(b){a.accountSubs=b.Results}),f.getAllUsers({id:a.accountId},function(b){a.users=b.customers}),f.getUser({id:a.customerId},function(b){a.thisCustomer=b.customerInfo[0],a.filterOption=!0})},a.reset=function(b){a.reset=b},a.initErrorMessages=function(b,c,d){a.errorMessage=b,a.successMessage=c,a.redirectPath=d},a.offerings={packages:[{id:"53d145d47304a04920d6c55d",price:"49.99",duration:30},{id:"53d1462c7304a04920d6c55e",price:"0.00",duration:30},{id:"53fb7eda7304a0492008792d",price:"19.99",duration:30},{id:"53fb80207304a0492008edbd",price:"29.99",duration:30}]},a.userRoles=["admin","user"],a.changePass=function(b){a.pass.reset=b,a.pass.error=a.pass.success=null,a.pass.newPass!=a.pass.repeatPass?a.pass.error="Passwords do not match":(a.pass.change=!0,c({method:"POST",url:"/"+a.customerId+"/changePass",data:a.pass}).success(function(b){b.error?a.pass.error=b.error:(a.pass.success="Password updated",a.pass.change=!1)}).error(function(){a.pass.error="Password update Failed",a.pass.change=!1}))},a.activatePlatform=function(b,c){b.active=c,""!=b.activEndDate&&(b.activeEndDate=""),e.updateForm(b,function(d){d.durr?a.error=d.durr:angular.forEach(a.applications,function(a,d){a._id==b._id&&(a.active=c)})},function(){a.error="Platform update failed"})},a.deleteWarningCount=0,a.deletePlatform=function(b){a.deleted={},e.deleteForm({id:b._id},function(c){c.durr?a.deleted.error=c.durr:(a.deleteAllSubs(b),angular.forEach(a.accountApps,function(c,d){c._id==b._id&&(a.accountApps[d].deleted={},a.accountApps[d].deleted.success="Deleted Platform")}))},function(){a.deleted.error="Platform delete failed"})},a.deleteAllSubs=function(b){h.deleteAllSubs({id:b._id},function(b){b.durr&&(a.error=b.durr)},function(){a.error="Submission delete failed"})},a.updateSub=function(a){h.updateSub(a,function(a){a.durr&&alert("Update Failed")},function(){alert("Validation Failed")})};var i=[];a.applicationsToFilter=function(){return i=[],a.applications},a.filterApplications=function(b){var c=-1==i.indexOf(b.customerId);return a.appId=b._id,c&&i.push(b.customerId),c};var j=[];a.submissionsToFilter=function(){return j=[],a.submissions},a.filterSubmissions=function(a){var b=-1==j.indexOf(a.appId);return b&&j.push(a.appId),b},a.duplicateForm=function(b){console.log("duplicate form clicked"),e.getForm({id:b+".json"},function(b){delete b.applicationInfo._id,delete b.applicationInfo.createdDate,b.applicationInfo.customerId=a.customerId,window.sessionStorage&&window.sessionStorage.setItem("duplicateFormData",JSON.stringify(b));var c="localhost"==window.location.hostname?"localhost:3000":window.location.hostname;window.location.replace(window.location.protocol+"//"+c+"/add")})}}]),angular.module("profile.filters",[]).filter("appsByCategory",[function(){return function(a,b,c){if(b){if("all"==b._id)return a;if("mine"==b._id){var d=[];return angular.forEach(a,function(a){a.customerId==c&&d.push(a)}),d}var d=[];return angular.forEach(a,function(a){0==a.categories.length||angular.forEach(a.categories,function(c){null!=c&&b&&b._id==c._id&&d.push(a)})}),d}return a}}]).filter("sharedApps",function(){return function(a,b){var c=[];return a&&angular.forEach(a,function(a){1==a.shared||null==a.shared?c.push(a):b==a.customerId&&c.push(a)}),c}}).filter("myForms",function(){return function(a,b,c){var d=[];return a&&!b?angular.forEach(a,function(a){c==a.customerId&&d.push(a)}):d=a,d}}).filter("hideOptions",function(){return function(a,b){if(a){for(var c=b.length-1;c>=0;c--)k=b[c],k.exclude&&b.splice(c,1);return a}}}).filter("notNull",function(){return function(a){var b=[];
if(a)for(var c=0;c<a.length;c++)null!=a[c]&&b.push(a[c]);return b}}),angular.module("profile.directives",[]).directive("errSrc",function(){return{link:function(a,b,c){b.bind("error",function(){b.attr("src",c.errSrc)})}}}).directive("uniqueUsername",["$http",function(a){return{require:"ngModel",link:function(b,c,d,e){b.$watch(d.ngModel,function(b){e.$setValidity("isTaken",!0),e.$setValidity("invalidChars",!0),b&&a.post("/check/username",{username:b}).success(function(a){}).error(function(a){a.isTaken?e.$setValidity("isTaken",!1):a.invalidChars&&e.$setValidity("invalidChars",!1)})})}}}]).directive("uniqueEmail",["$http","$sce",function(a,b){return{require:"ngModel",link:function(c,d,e,f){c.$watch(e.ngModel,function(d){f.$setValidity("isTaken",!0),d&&a.post("/check/email",{email:d}).success(function(a){}).error(function(a){a.isTaken?f.$setValidity("isTaken",!1):a.isSpecialDomain&&(console.log("is special domain"),f.$setValidity("isSpecialDomain",!1),c.specialDomain=a.specialDomain,c.redirectMessage=b.trustAsHtml(a.redirectMessage))})})}}}]).directive("match",[function(){return{require:"ngModel",link:function(a,b,c,d){a.$watch("["+c.ngModel+", "+c.match+"]",function(a){d.$setValidity("match",a[0]===a[1])},!0)}}}]);var uuids=angular.module("uuids",[]);uuids.factory("rfc4122",function(){return{newuuid:function(){for(var a=[],b="0123456789abcdef",c=0;36>c;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);return a[14]="4",a[19]=b.substr(3&a[19]|8,1),a[8]=a[13]=a[18]=a[23]="-",a.join("")}}}),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function b(b,d){var e,f,g,h=b.nodeName.toLowerCase();return"area"===h?(e=b.parentNode,f=e.name,b.href&&f&&"map"===e.nodeName.toLowerCase()?(g=a("img[usemap='#"+f+"']")[0],!!g&&c(g)):!1):(/input|select|textarea|button|object/.test(h)?!b.disabled:"a"===h?b.href||d:d)&&c(b)}function c(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}a.ui=a.ui||{},a.extend(a.ui,{version:"1.11.1",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({scrollParent:function(b){var c=this.css("position"),d="absolute"===c,e=b?/(auto|scroll|hidden)/:/(auto|scroll)/,f=this.parents().filter(function(){var b=a(this);return d&&"static"===b.css("position")?!1:e.test(b.css("overflow")+b.css("overflow-y")+b.css("overflow-x"))}).eq(0);return"fixed"!==c&&f.length?f:a(this[0].ownerDocument||document)},uniqueId:function(){var a=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++a)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(c){return b(c,!isNaN(a.attr(c,"tabindex")))},tabbable:function(c){var d=a.attr(c,"tabindex"),e=isNaN(d);return(e||d>=0)&&b(c,!e)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(b,c){function d(b,c,d,f){return a.each(e,function(){c-=parseFloat(a.css(b,"padding"+this))||0,d&&(c-=parseFloat(a.css(b,"border"+this+"Width"))||0),f&&(c-=parseFloat(a.css(b,"margin"+this))||0)}),c}var e="Width"===c?["Left","Right"]:["Top","Bottom"],f=c.toLowerCase(),g={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+c]=function(b){return void 0===b?g["inner"+c].call(this):this.each(function(){a(this).css(f,d(this,b)+"px")})},a.fn["outer"+c]=function(b,e){return"number"!=typeof b?g["outer"+c].call(this,b):this.each(function(){a(this).css(f,d(this,b,!0,e)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(b){return function(c){return arguments.length?b.call(this,a.camelCase(c)):b.call(this)}}(a.fn.removeData)),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.fn.extend({focus:function(b){return function(c,d){return"number"==typeof c?this.each(function(){var b=this;setTimeout(function(){a(b).focus(),d&&d.call(b)},c)}):b.apply(this,arguments)}}(a.fn.focus),disableSelection:function(){var a="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(a+".ui-disableSelection",function(a){a.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(b){if(void 0!==b)return this.css("zIndex",b);if(this.length)for(var c,d,e=a(this[0]);e.length&&e[0]!==document;){if(c=e.css("position"),("absolute"===c||"relative"===c||"fixed"===c)&&(d=parseInt(e.css("zIndex"),10),!isNaN(d)&&0!==d))return d;e=e.parent()}return 0}}),a.ui.plugin={add:function(b,c,d){var e,f=a.ui[b].prototype;for(e in d)f.plugins[e]=f.plugins[e]||[],f.plugins[e].push([c,d[e]])},call:function(a,b,c,d){var e,f=a.plugins[b];if(f&&(d||a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType))for(e=0;f.length>e;e++)a.options[f[e][0]]&&f[e][1].apply(a.element,c)}};var d=0,e=Array.prototype.slice;a.cleanData=function(b){return function(c){var d,e,f;for(f=0;null!=(e=c[f]);f++)try{d=a._data(e,"events"),d&&d.remove&&a(e).triggerHandler("remove")}catch(g){}b(c)}}(a.cleanData),a.widget=function(b,c,d){var e,f,g,h,i={},j=b.split(".")[0];return b=b.split(".")[1],e=j+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e.toLowerCase()]=function(b){return!!a.data(b,e)},a[j]=a[j]||{},f=a[j][b],g=a[j][b]=function(a,b){return this._createWidget?void(arguments.length&&this._createWidget(a,b)):new g(a,b)},a.extend(g,f,{version:d.version,_proto:a.extend({},d),_childConstructors:[]}),h=new c,h.options=a.widget.extend({},h.options),a.each(d,function(b,d){return a.isFunction(d)?void(i[b]=function(){var a=function(){return c.prototype[b].apply(this,arguments)},e=function(a){return c.prototype[b].apply(this,a)};return function(){var b,c=this._super,f=this._superApply;return this._super=a,this._superApply=e,b=d.apply(this,arguments),this._super=c,this._superApply=f,b}}()):void(i[b]=d)}),g.prototype=a.widget.extend(h,{widgetEventPrefix:f?h.widgetEventPrefix||b:b},i,{constructor:g,namespace:j,widgetName:b,widgetFullName:e}),f?(a.each(f._childConstructors,function(b,c){var d=c.prototype;a.widget(d.namespace+"."+d.widgetName,g,c._proto)}),delete f._childConstructors):c._childConstructors.push(g),a.widget.bridge(b,g),g},a.widget.extend=function(b){for(var c,d,f=e.call(arguments,1),g=0,h=f.length;h>g;g++)for(c in f[g])d=f[g][c],f[g].hasOwnProperty(c)&&void 0!==d&&(b[c]=a.isPlainObject(d)?a.isPlainObject(b[c])?a.widget.extend({},b[c],d):a.widget.extend({},d):d);return b},a.widget.bridge=function(b,c){var d=c.prototype.widgetFullName||b;a.fn[b]=function(f){var g="string"==typeof f,h=e.call(arguments,1),i=this;return f=!g&&h.length?a.widget.extend.apply(null,[f].concat(h)):f,g?this.each(function(){var c,e=a.data(this,d);return"instance"===f?(i=e,!1):e?a.isFunction(e[f])&&"_"!==f.charAt(0)?(c=e[f].apply(e,h),c!==e&&void 0!==c?(i=c&&c.jquery?i.pushStack(c.get()):c,!1):void 0):a.error("no such method '"+f+"' for "+b+" widget instance"):a.error("cannot call methods on "+b+" prior to initialization; attempted to call method '"+f+"'")}):this.each(function(){var b=a.data(this,d);b?(b.option(f||{}),b._init&&b._init()):a.data(this,d,new c(f,this))}),i}},a.Widget=function(){},a.Widget._childConstructors=[],a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,c){c=a(c||this.defaultElement||this)[0],this.element=a(c),this.uuid=d++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=a.widget.extend({},this.options,this._getCreateOptions(),b),this.bindings=a(),this.hoverable=a(),this.focusable=a(),c!==this&&(a.data(c,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===c&&this.destroy()}}),this.document=a(c.style?c.ownerDocument:c.document||c),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},option:function(b,c){var d,e,f,g=b;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof b)if(g={},d=b.split("."),b=d.shift(),d.length){for(e=g[b]=a.widget.extend({},this.options[b]),f=0;d.length-1>f;f++)e[d[f]]=e[d[f]]||{},e=e[d[f]];if(b=d.pop(),1===arguments.length)return void 0===e[b]?null:e[b];e[b]=c}else{if(1===arguments.length)return void 0===this.options[b]?null:this.options[b];g[b]=c}return this._setOptions(g),this},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!b),b&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(b,c,d){var e,f=this;"boolean"!=typeof b&&(d=c,c=b,b=!1),d?(c=e=a(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,e=this.widget()),a.each(d,function(d,g){function h(){return b||f.options.disabled!==!0&&!a(this).hasClass("ui-state-disabled")?("string"==typeof g?f[g]:g).apply(f,arguments):void 0}"string"!=typeof g&&(h.guid=g.guid=g.guid||h.guid||a.guid++);var i=d.match(/^([\w:-]*)\s*(.*)$/),j=i[1]+f.eventNamespace,k=i[2];k?e.delegate(k,j,h):c.bind(j,h)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,a.unbind(b).undelegate(b)},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b),this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b),this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.apply(this.element[0],[c].concat(d))===!1||c.isDefaultPrevented())}},a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,e,f){"string"==typeof e&&(e={effect:e});var g,h=e?e===!0||"number"==typeof e?c:e.effect||c:b;e=e||{},"number"==typeof e&&(e={duration:e}),g=!a.isEmptyObject(e),e.complete=f,e.delay&&d.delay(e.delay),g&&a.effects&&a.effects.effect[h]?d[b](e):h!==b&&d[h]?d[h](e.duration,e.easing,f):d.queue(function(c){a(this)[b](),f&&f.call(d[0]),c()})}}),a.widget;var f=!1;a(document).mouseup(function(){f=!1}),a.widget("ui.mouse",{version:"1.11.1",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){return!0===a.data(c.target,b.widgetName+".preventClickEvent")?(a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(b){if(!f){this._mouseStarted&&this._mouseUp(b),this._mouseDownEvent=b;var c=this,d=1===b.which,e="string"==typeof this.options.cancel&&b.target.nodeName?a(b.target).closest(this.options.cancel).length:!1;return d&&!e&&this._mouseCapture(b)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){c.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(b)!==!1,!this._mouseStarted)?(b.preventDefault(),!0):(!0===a.data(b.target,this.widgetName+".preventClickEvent")&&a.removeData(b.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return c._mouseMove(a)},this._mouseUpDelegate=function(a){return c._mouseUp(a)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),b.preventDefault(),f=!0,!0)):!0}},_mouseMove:function(b){return a.ui.ie&&(!document.documentMode||9>document.documentMode)&&!b.button?this._mouseUp(b):b.which?this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted):this._mouseUp(b)},_mouseUp:function(b){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target===this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),f=!1,!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),a.widget("ui.sortable",a.ui.mouse,{version:"1.11.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(a,b,c){return a>=b&&b+c>a},_isFloating:function(a){return/left|right/.test(a.css("float"))||/inline|table-cell/.test(a.css("display"))},_create:function(){var a=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===a.axis||this._isFloating(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(a,b){this._super(a,b),"handle"===a&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),a.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var a=this.items.length-1;a>=0;a--)this.items[a].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(b,c){var d=null,e=!1,f=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(b),a(b.target).parents().each(function(){return a.data(this,f.widgetName+"-item")===f?(d=a(this),!1):void 0}),a.data(b.target,f.widgetName+"-item")===f&&(d=a(b.target)),d&&(!this.options.handle||c||(a(this.options.handle,d).find("*").addBack().each(function(){this===b.target&&(e=!0)}),e))?(this.currentItem=d,this._removeCurrentsFromItems(),!0):!1)},_mouseStart:function(b,c,d){var e,f,g=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(b),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,g.cursorAt&&this._adjustOffsetFromHelper(g.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),g.containment&&this._setContainment(),g.cursor&&"auto"!==g.cursor&&(f=this.document.find("body"),this.storedCursor=f.css("cursor"),f.css("cursor",g.cursor),this.storedStylesheet=a("<style>*{ cursor: "+g.cursor+" !important; }</style>").appendTo(f)),g.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",g.opacity)),g.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",g.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",b,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!d)for(e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("activate",b,this._uiHash(this));return a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!g.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b),!0},_mouseDrag:function(b){var c,d,e,f,g=this.options,h=!1;for(this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<g.scrollSensitivity?this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop+g.scrollSpeed:b.pageY-this.overflowOffset.top<g.scrollSensitivity&&(this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop-g.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<g.scrollSensitivity?this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft+g.scrollSpeed:b.pageX-this.overflowOffset.left<g.scrollSensitivity&&(this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft-g.scrollSpeed)):(b.pageY-a(document).scrollTop()<g.scrollSensitivity?h=a(document).scrollTop(a(document).scrollTop()-g.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<g.scrollSensitivity&&(h=a(document).scrollTop(a(document).scrollTop()+g.scrollSpeed)),b.pageX-a(document).scrollLeft()<g.scrollSensitivity?h=a(document).scrollLeft(a(document).scrollLeft()-g.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<g.scrollSensitivity&&(h=a(document).scrollLeft(a(document).scrollLeft()+g.scrollSpeed))),h!==!1&&a.ui.ddmanager&&!g.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),c=this.items.length-1;c>=0;c--)if(d=this.items[c],e=d.item[0],f=this._intersectsWithPointer(d),f&&d.instance===this.currentContainer&&e!==this.currentItem[0]&&this.placeholder[1===f?"next":"prev"]()[0]!==e&&!a.contains(this.placeholder[0],e)&&("semi-dynamic"===this.options.type?!a.contains(this.element[0],e):!0)){if(this.direction=1===f?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(d))break;this._rearrange(b,d),this._trigger("change",b,this._uiHash());break}return this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,c){if(b){if(a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,b),this.options.revert){var d=this,e=this.placeholder.offset(),f=this.options.axis,g={};f&&"x"!==f||(g.left=e.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),f&&"y"!==f||(g.top=e.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,a(this.helper).animate(g,parseInt(this.options.revert,10)||500,function(){d._clear(b)})}else this._clear(b,c);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var b=this.containers.length-1;b>=0;b--)this.containers[b]._trigger("deactivate",null,this._uiHash(this)),this.containers[b].containerCache.over&&(this.containers[b]._trigger("out",null,this._uiHash(this)),this.containers[b].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},a(c).each(function(){var c=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[\-=_](.+)/);c&&d.push((b.key||c[1]+"[]")+"="+(b.key&&b.expression?c[1]:c[2]))}),!d.length&&b.key&&d.push(b.key+"="),d.join("&")},toArray:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},c.each(function(){d.push(a(b.item||this).attr(b.attribute||"id")||"")}),d},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,e=d+this.helperProportions.height,f=a.left,g=f+a.width,h=a.top,i=h+a.height,j=this.offset.click.top,k=this.offset.click.left,l="x"===this.options.axis||d+j>h&&i>d+j,m="y"===this.options.axis||b+k>f&&g>b+k,n=l&&m;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?n:b+this.helperProportions.width/2>f&&g>c-this.helperProportions.width/2&&d+this.helperProportions.height/2>h&&i>e-this.helperProportions.height/2},_intersectsWithPointer:function(a){var b="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,a.top,a.height),c="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,a.left,a.width),d=b&&c,e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return d?this.floating?f&&"right"===f||"down"===e?2:1:e&&("down"===e?2:1):!1},_intersectsWithSides:function(a){var b=this._isOverAxis(this.positionAbs.top+this.offset.click.top,a.top+a.height/2,a.height),c=this._isOverAxis(this.positionAbs.left+this.offset.click.left,a.left+a.width/2,a.width),d=this._getDragVerticalDirection(),e=this._getDragHorizontalDirection();return this.floating&&e?"right"===e&&c||"left"===e&&!c:d&&("down"===d&&b||"up"===d&&!b)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return 0!==a&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return 0!==a&&(a>0?"right":"left")},refresh:function(a){return this._refreshItems(a),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var a=this.options;return a.connectWith.constructor===String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){function c(){h.push(this)}var d,e,f,g,h=[],i=[],j=this._connectWith();if(j&&b)for(d=j.length-1;d>=0;d--)for(f=a(j[d]),e=f.length-1;e>=0;e--)g=a.data(f[e],this.widgetFullName),g&&g!==this&&!g.options.disabled&&i.push([a.isFunction(g.options.items)?g.options.items.call(g.element):a(g.options.items,g.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),g]);for(i.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),d=i.length-1;d>=0;d--)i[d][0].each(c);return a(h)},_removeCurrentsFromItems:function(){var b=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=a.grep(this.items,function(a){for(var c=0;b.length>c;c++)if(b[c]===a.item[0])return!1;return!0})},_refreshItems:function(b){this.items=[],this.containers=[this];var c,d,e,f,g,h,i,j,k=this.items,l=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]],m=this._connectWith();if(m&&this.ready)for(c=m.length-1;c>=0;c--)for(e=a(m[c]),d=e.length-1;d>=0;d--)f=a.data(e[d],this.widgetFullName),f&&f!==this&&!f.options.disabled&&(l.push([a.isFunction(f.options.items)?f.options.items.call(f.element[0],b,{item:this.currentItem}):a(f.options.items,f.element),f]),this.containers.push(f));for(c=l.length-1;c>=0;c--)for(g=l[c][1],h=l[c][0],d=0,j=h.length;j>d;d++)i=a(h[d]),i.data(this.widgetName+"-item",g),k.push({item:i,instance:g,width:0,height:0,left:0,top:0})},refreshPositions:function(b){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var c,d,e,f;for(c=this.items.length-1;c>=0;c--)d=this.items[c],d.instance!==this.currentContainer&&this.currentContainer&&d.item[0]!==this.currentItem[0]||(e=this.options.toleranceElement?a(this.options.toleranceElement,d.item):d.item,b||(d.width=e.outerWidth(),d.height=e.outerHeight()),f=e.offset(),d.left=f.left,d.top=f.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(c=this.containers.length-1;c>=0;c--)f=this.containers[c].element.offset(),this.containers[c].containerCache.left=f.left,this.containers[c].containerCache.top=f.top,this.containers[c].containerCache.width=this.containers[c].element.outerWidth(),this.containers[c].containerCache.height=this.containers[c].element.outerHeight();return this},_createPlaceholder:function(b){b=b||this;var c,d=b.options;d.placeholder&&d.placeholder.constructor!==String||(c=d.placeholder,d.placeholder={element:function(){var d=b.currentItem[0].nodeName.toLowerCase(),e=a("<"+d+">",b.document[0]).addClass(c||b.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===d?b.currentItem.children().each(function(){a("<td>&#160;</td>",b.document[0]).attr("colspan",a(this).attr("colspan")||1).appendTo(e)}):"img"===d&&e.attr("src",b.currentItem.attr("src")),c||e.css("visibility","hidden"),e},update:function(a,e){(!c||d.forcePlaceholderSize)&&(e.height()||e.height(b.currentItem.innerHeight()-parseInt(b.currentItem.css("paddingTop")||0,10)-parseInt(b.currentItem.css("paddingBottom")||0,10)),e.width()||e.width(b.currentItem.innerWidth()-parseInt(b.currentItem.css("paddingLeft")||0,10)-parseInt(b.currentItem.css("paddingRight")||0,10)))}}),b.placeholder=a(d.placeholder.element.call(b.element,b.currentItem)),b.currentItem.after(b.placeholder),d.placeholder.update(b,b.placeholder)},_contactContainers:function(b){var c,d,e,f,g,h,i,j,k,l,m=null,n=null;for(c=this.containers.length-1;c>=0;c--)if(!a.contains(this.currentItem[0],this.containers[c].element[0]))if(this._intersectsWith(this.containers[c].containerCache)){if(m&&a.contains(this.containers[c].element[0],m.element[0]))continue;m=this.containers[c],n=c}else this.containers[c].containerCache.over&&(this.containers[c]._trigger("out",b,this._uiHash(this)),this.containers[c].containerCache.over=0);if(m)if(1===this.containers.length)this.containers[n].containerCache.over||(this.containers[n]._trigger("over",b,this._uiHash(this)),this.containers[n].containerCache.over=1);else{for(e=1e4,f=null,k=m.floating||this._isFloating(this.currentItem),g=k?"left":"top",h=k?"width":"height",l=k?"clientX":"clientY",d=this.items.length-1;d>=0;d--)a.contains(this.containers[n].element[0],this.items[d].item[0])&&this.items[d].item[0]!==this.currentItem[0]&&(i=this.items[d].item.offset()[g],j=!1,b[l]-i>this.items[d][h]/2&&(j=!0),e>Math.abs(b[l]-i)&&(e=Math.abs(b[l]-i),f=this.items[d],this.direction=j?"up":"down"));if(!f&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[n])return;f?this._rearrange(b,f,null,!0):this._rearrange(b,null,this.containers[n].element,!0),this._trigger("change",b,this._uiHash()),this.containers[n]._trigger("change",b,this._uiHash(this)),this.currentContainer=this.containers[n],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[n]._trigger("over",b,this._uiHash(this)),this.containers[n].containerCache.over=1}},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b,this.currentItem])):"clone"===c.helper?this.currentItem.clone():this.currentItem;return d.parents("body").length||a("parent"!==c.appendTo?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(d[0]),d[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!d[0].style.width||c.forceHelperSize)&&d.width(this.currentItem.width()),(!d[0].style.height||c.forceHelperSize)&&d.height(this.currentItem.height()),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){
this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options;"parent"===e.containment&&(e.containment=this.helper[0].parentNode),("document"===e.containment||"window"===e.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a("document"===e.containment?document:window).width()-this.helperProportions.width-this.margins.left,(a("document"===e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(e.containment)||(b=a(e.containment)[0],c=a(e.containment).offset(),d="hidden"!==a(b).css("overflow"),this.containment=[c.left+(parseInt(a(b).css("borderLeftWidth"),10)||0)+(parseInt(a(b).css("paddingLeft"),10)||0)-this.margins.left,c.top+(parseInt(a(b).css("borderTopWidth"),10)||0)+(parseInt(a(b).css("paddingTop"),10)||0)-this.margins.top,c.left+(d?Math.max(b.scrollWidth,b.offsetWidth):b.offsetWidth)-(parseInt(a(b).css("borderLeftWidth"),10)||0)-(parseInt(a(b).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,c.top+(d?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(a(b).css("borderTopWidth"),10)||0)-(parseInt(a(b).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(b,c){c||(c=this.position);var d="absolute"===b?1:-1,e="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,f=/(html|body)/i.test(e[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():f?0:e.scrollTop())*d,left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():f?0:e.scrollLeft())*d}},_generatePosition:function(b){var c,d,e=this.options,f=b.pageX,g=b.pageY,h="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(h[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(g=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(g=this.containment[3]+this.offset.click.top)),e.grid&&(c=this.originalPageY+Math.round((g-this.originalPageY)/e.grid[1])*e.grid[1],g=this.containment?c-this.offset.click.top>=this.containment[1]&&c-this.offset.click.top<=this.containment[3]?c:c-this.offset.click.top>=this.containment[1]?c-e.grid[1]:c+e.grid[1]:c,d=this.originalPageX+Math.round((f-this.originalPageX)/e.grid[0])*e.grid[0],f=this.containment?d-this.offset.click.left>=this.containment[0]&&d-this.offset.click.left<=this.containment[2]?d:d-this.offset.click.left>=this.containment[0]?d-e.grid[0]:d+e.grid[0]:d)),{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():i?0:h.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():i?0:h.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?b.item[0]:b.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var e=this.counter;this._delay(function(){e===this.counter&&this.refreshPositions(!d)})},_clear:function(a,b){function c(a,b,c){return function(d){c._trigger(a,d,b._uiHash(b))}}this.reverting=!1;var d,e=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(d in this._storedCSS)("auto"===this._storedCSS[d]||"static"===this._storedCSS[d])&&(this._storedCSS[d]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!b&&e.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||b||e.push(function(a){this._trigger("update",a,this._uiHash())}),this!==this.currentContainer&&(b||(e.push(function(a){this._trigger("remove",a,this._uiHash())}),e.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.currentContainer)),e.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.currentContainer)))),d=this.containers.length-1;d>=0;d--)b||e.push(c("deactivate",this,this.containers[d])),this.containers[d].containerCache.over&&(e.push(c("out",this,this.containers[d])),this.containers[d].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!b){for(this._trigger("beforeStop",a,this._uiHash()),d=0;e.length>d;d++)e[d].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=!1,!1}if(b||this._trigger("beforeStop",a,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!b){for(d=0;e.length>d;d++)e[d].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:b?b.element:null}}})}),angular.module("ui.sortable",[]).value("uiSortableConfig",{}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(a,b,c){return{require:"?ngModel",link:function(d,e,f,g){function h(a,b){return b&&"function"==typeof b?function(c,d){a(c,d),b(c,d)}:a}var i,j={},k={receive:null,remove:null,start:null,stop:null,update:null};return angular.extend(j,a),angular.element.fn&&angular.element.fn.jquery?(g?(d.$watch(f.ngModel+".length",function(){b(function(){e.data("ui-sortable")&&e.sortable("refresh")})}),k.start=function(a,b){b.item.sortable={index:b.item.index(),cancel:function(){b.item.sortable._isCanceled=!0},isCanceled:function(){return b.item.sortable._isCanceled},_isCanceled:!1}},k.activate=function(){i=e.contents();var a=e.sortable("option","placeholder");if(a&&a.element&&"function"==typeof a.element){var b=a.element();b=angular.element(b);var c=e.find('[class="'+b.attr("class")+'"]');i=i.not(c)}},k.update=function(a,b){b.item.sortable.received||(b.item.sortable.dropindex=b.item.index(),b.item.sortable.droptarget=b.item.parent(),e.sortable("cancel")),"clone"===e.sortable("option","helper")&&(i=i.not(i.last())),i.appendTo(e),b.item.sortable.received&&!b.item.sortable.isCanceled()&&d.$apply(function(){g.$modelValue.splice(b.item.sortable.dropindex,0,b.item.sortable.moved)})},k.stop=function(a,b){!b.item.sortable.received&&"dropindex"in b.item.sortable&&!b.item.sortable.isCanceled()?d.$apply(function(){g.$modelValue.splice(b.item.sortable.dropindex,0,g.$modelValue.splice(b.item.sortable.index,1)[0])}):"dropindex"in b.item.sortable&&!b.item.sortable.isCanceled()||"clone"===e.sortable("option","helper")||i.appendTo(e)},k.receive=function(a,b){b.item.sortable.received=!0},k.remove=function(a,b){b.item.sortable.isCanceled()||d.$apply(function(){b.item.sortable.moved=g.$modelValue.splice(b.item.sortable.index,1)[0]})},d.$watch(f.uiSortable,function(a){e.data("ui-sortable")&&angular.forEach(a,function(a,b){k[b]&&("stop"===b&&(a=h(a,function(){d.$apply()})),a=h(k[b],a)),e.sortable("option",b,a)})},!0),angular.forEach(k,function(a,b){j[b]=h(a,j[b])})):c.info("ui.sortable: ngModel not provided!",e),void e.sortable(j)):void c.error("ui.sortable: jQuery should be included before AngularJS!")}}}]),angular.module("loggingModuleServices",[]).factory("subLogService",["$log","$window",function(a,b){return{error:function(c,d){a.error.apply(a,arguments),$.ajax({type:"POST",url:"/clientErrorlogger",contentType:"application/json",data:angular.toJson({url:b.location.href,message:c,type:"error"})})},debug:function(c,d){a.log.apply(a,arguments),$.ajax({type:"POST",url:"/clientDebuglogger",contentType:"application/json",data:angular.toJson({url:b.location.href,message:c,response:d,type:"debug"})})}}}]),function(){"use strict";function a(a,b,c,d,e){var f=Math.abs(Math.cos(e)),g=Math.abs(Math.sin(e)),h=a+c/2*Math.cos(e)-d/2*Math.sin(e),i=b+c/2*Math.sin(e)+d/2*Math.cos(e),j=c*f+d*g,k=c*g+d*f;return{cx:h,cy:i,width:j,height:k}}angular.module("imgEditor.directives",[]).directive("imgData",[function(){return{restrict:"A",link:function(a,b,c){var d=a.$eval(c.imgData),e=new FileReader;e.onload=function(){a.$apply(function(){var c=new Image;c.onload=function(){b.attr("src",c.src)},c.src=e.result,a.$broadcast("loadedImg",c,c.src)})},e.readAsDataURL(d)}}}]).directive("imgDataFromUri",function(){return{restrict:"A",link:function(b,c,d){var e=document.createElement("canvas"),f=e.getContext("2d"),g=new Image;g.onload=function(){var d=e.width=g.width,h=e.height=g.height;f.drawImage(g,0,0);var i=e.toDataURL("image/png"),j=new Image;j.src=i;var k=b.model.crop(b);if(k&&k.x>0){var l=new Image;l.src=i;var m=k;m.w=m.x2-m.x,m.h=m.y2-m.y,d=e.width,h=e.height;var n=document.createElement("canvas"),o=n.getContext("2d"),p=document.createElement("canvas"),q=p.getContext("2d"),r=a(m.x,m.y,m.w,m.h,0);n.width=p.width=r.width,n.height=p.height=r.height,o.drawImage(l,r.cx-r.width/2,r.cy-r.height/2,r.width,r.height,0,0,r.width,r.height),q.translate(parseInt(n.width/2),parseInt(n.height/2)),q.drawImage(n,parseInt(-n.width/2),parseInt(-n.height/2));var s=r.width/2-m.w/2,t=r.height/2-m.h/2;e.width=m.w,e.height=m.h,d=e.width,h=e.height,f.drawImage(p,-s,-t),l=n=p=o=q=t=s=null,i=e.toDataURL()}if(b.model.rotation(b)){for(var u=b.model.rotation(b);0>u;)u+=360;var v=u/90%4,w=new Image;w.src=i;for(var x=0;v>x;x++)e.width=h,e.height=d,d=e.width,h=e.height,f.save(),f.translate(d,h/d),f.rotate(Math.PI/2),f.drawImage(w,0,0),f.restore(),w.src=e.toDataURL();w=null,i=e.toDataURL()}b.$broadcast("loadedImg",j,i),c.attr("src",i)},g.crossOrigin="",d.$observe("imgDataFromUri",function(a){g.src=a})}}}).directive("imgThumb",[function(){return{restrict:"A",link:function(a,b,c){a.$on("loadedImg",function(a,c,d){b.attr("src",d)}),a.$on("update",function(a,c){b.attr("src",c)})}}}]).directive("imgEditable",["$parse",function(b){return{restrict:"A",link:function(c,d,e){function f(){l=null,d.attr("src",n.src),m.src=n.src}function g(){var a=new Image;a.onload=function(){var b,e,f,g=!1,h=document.createElement("canvas"),i=h.getContext("2d");h.width=a.width,h.height=a.height,e=h.width,f=h.height,i.drawImage(a,0,0,a.width,a.height),g||(g=!0,b=new Image,b.src=h.toDataURL(),b.onload=function(){h.width=f,h.height=e,e=h.width,f=h.height,i.save(),i.translate(parseInt(e),parseInt(f/e)),i.rotate(Math.PI/2),i.drawImage(b,0,0),i.restore(),b=null,g=!1,d.attr("src",h.toDataURL()),c.$broadcast("update",h.toDataURL()),h=null})},a.src=d.attr("src"),h()}function h(){var a=new Image;a.onload=function(){var b,c,d,e=!1,f=document.createElement("canvas"),g=f.getContext("2d");f.width=a.width,f.height=a.height,c=f.width,d=f.height,g.drawImage(a,0,0,a.width,a.height),e||(e=!0,b=new Image,b.src=f.toDataURL(),b.onload=function(){f.width=d,f.height=c,c=f.width,d=f.height,g.save(),g.translate(parseInt(c),parseInt(d/c)),g.rotate(Math.PI/2),g.drawImage(b,0,0),g.restore(),b=null,e=!1;var a=f.toDataURL();f=null,m.src=a})},a.src=m.src}function i(b){var e=new Image;e.src=d.attr("src");var f=document.createElement("canvas"),g=f.getContext("2d"),h=b,i=f.width,j=f.height,k=document.createElement("canvas"),l=k.getContext("2d"),m=document.createElement("canvas"),n=m.getContext("2d"),o=a(h.x,h.y,h.w,h.h,0);k.width=m.width=o.width,k.height=m.height=o.height,l.drawImage(e,o.cx-o.width/2,o.cy-o.height/2,o.width,o.height,0,0,o.width,o.height),n.translate(parseInt(k.width/2),parseInt(k.height/2)),n.drawImage(k,parseInt(-k.width/2),parseInt(-k.height/2));var p=o.width/2-h.w/2,q=o.height/2-h.h/2;f.width=h.w,f.height=h.h,i=f.width,j=f.height,g.drawImage(m,-p,-q),d.attr("src",f.toDataURL()),c.$broadcast("update",f.toDataURL()),e=f=g=i=j=h=l=n=k=m=o=p=q=null}function j(a,b,c,d,e){if(0===e)return{x:a,y:b};if(180===Math.abs(e))return{x:c-a,y:d-b};var f=e*Math.PI/180,g=a-c/2,h=b-d/2,i=d/2,j=c/2;return{x:parseInt(Math.cos(f)*g-Math.sin(f)*h+i),y:parseInt(Math.sin(f)*g+Math.cos(f)*h+j)}}var k,l,m=new Image,n=new Image;c.model={},c.model.crop=b(e.crop),c.model.rotation=b(e.rotation),c.model.trueSize=b(e.trueSize),c.crop||(c.crop=!1),c.rotation||(c.rotation=0),d.attr("src")&&d.attr("src").length>1&&(m.src=d.attr("src")),c.$on("loadedImg",function(a,b,c){m.src=c,n.src=b.src}),c.$on("crop",function(){if(c.cropping=!0,l=new Image,l.src=d.attr("src"),d.attr("src",m.src),console.log([m.width,m.height]),c.crop){var a=j(c.crop.x,c.crop.y,n.width,n.height,c.rotation),b=j(c.crop.x2,c.crop.y2,n.width,n.height,c.rotation),e=[a.x,a.y,b.x,b.y];$(d).Jcrop({trueSize:[m.width,m.height],setSelect:e},function(){k=this})}else $(d).Jcrop({trueSize:[m.width,m.height]},function(){k=this})}),c.$on("reset",function(){c.crop=!1,c.rotation=0,f(),c.$broadcast("update",n.src)}),c.$on("save",function(){if(c.cropping){l=null,c.cropping=!1;var a=k.tellSelect(),b=j(a.x,a.y,m.width,m.height,-c.rotation),e=j(a.x2,a.y2,m.width,m.height,-c.rotation);c.crop={x:b.x,y:b.y,x2:e.x,y2:e.y},c.model.crop.assign(c,c.crop),$(d).css("width",""),$(d).css("height",""),k.destroy(),i(a)}}),c.$on("cancel",function(){c.cropping&&(c.cropping=!1,d.attr("src",l.src),$(d).css("width",""),$(d).css("height",""),l=null,k.destroy())}),c.$on("rotate",function(){c.rotation=(c.rotation+90)%360,c.model.rotation.assign(c,c.rotation),g()})}}}])}();
//# sourceMappingURL=sub.min.js.map