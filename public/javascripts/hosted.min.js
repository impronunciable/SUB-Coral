angular.module("subPlatformServices",["ngResource"]).factory("subService",["$resource",function(a){return a("/:action/:id",{action:"@action"},{getSingleSub:{method:"GET",params:{action:"sub"}},getSubs:{method:"GET",params:{action:"subs"}},deleteSub:{method:"DELETE",params:{action:"sub"}},deleteAllSubs:{method:"DELETE",params:{action:"subs"}},submitForm:{method:"POST",params:{action:"submission"}},createEmptySubmission:{method:"Post",params:{action:"createEmptySubmission"}},updateSub:{method:"POST",params:{action:"updateSub"}},updateSubTags:{method:"POST",params:{action:"updateSubTags"}},bulkAddTags:{method:"POST",params:{action:"bulkAddSubTags"}},bulkRemoveTags:{method:"POST",params:{action:"bulkRemoveSubTags"}},bulkDeleteSubs:{method:"POST",params:{action:"bulkDeleteSubs"}},updateSubandMed:{method:"POST",params:{action:"updateSubAndMed"}},updatePupSub:{method:"POST",params:{action:"updatePupSub"}},updateEndUser:{method:"POST",params:{action:"updateEndUser"}},updateApproval:{method:"POST",params:{action:"updateApproval"}},saveSearch:{method:"POST",params:{action:"saveSearch"}},importSubs:{method:"POST",params:{action:"import"}}})}]).factory("formService",["$resource",function(a){return a("/:action/:id",{action:"@action"},{getForm:{method:"GET",params:{action:"form"}},getFormNames:{method:"GET",params:{action:"appNames.json"}},addForm:{method:"POST",params:{action:"form"}},updateForm:{method:"POST",params:{action:"updateApp"}},deleteForm:{method:"DELETE",params:{action:"form"}},deleteCategoryFromForms:{method:"DELETE",params:{action:"categories"}}})}]).factory("userService",["$resource",function(a){return a("/:action/:id",{action:"@action"},{getUser:{method:"GET",params:{action:"user"}},getUserForms:{method:"GET",params:{action:"userForms"}},getUserSubs:{method:"GET",params:{action:"customerSubs.json"}},getAllUsers:{method:"GET",params:{action:"users"}},updateUserStatus:{method:"POST",params:{action:"updateUserStatus"}},updateUser:{method:"POST",params:{action:"updateUser"}},updateUserLastActiveDate:{method:"POST",params:{action:"updateUserLastActiveDate"}},register:{method:"POST",params:{action:"register"}},checkUsername:{method:"POST",params:{action:"check",id:"username"}},checkEmail:{method:"POST",params:{action:"check",id:"email"}}})}]).factory("acctService",["$resource",function(a){return a("/:action/:id",{action:"@action"},{getAcct:{method:"GET",params:{action:"account"}},getAcctForms:{method:"GET",params:{action:"accountForms"}},getAcctSubs:{method:"GET",params:{action:"accountSubs"}},updateAccount:{method:"POST",params:{action:"updateAccount"}}})}]),angular.module("loggingModuleServices",[]).factory("subLogService",["$log","$window",function(a,b){return{error:function(c,d){a.error.apply(a,arguments),$.ajax({type:"POST",url:"/clientErrorlogger",contentType:"application/json",data:angular.toJson({url:b.location.href,message:c,type:"error"})})},debug:function(c,d){a.log.apply(a,arguments),$.ajax({type:"POST",url:"/clientDebuglogger",contentType:"application/json",data:angular.toJson({url:b.location.href,message:c,response:d,type:"debug"})})}}}]),angular.module("hostedApp",["hostedApp.directives","hostedApp.controllers","socialApp.directives"]),angular.module("hostedApp.controllers",["subPlatformServices","noCAPTCHA","ngSanitize","loggingModuleServices"]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]).controller("HostedController",["$scope","$http","$sce","$window","$location","formService","subService","subLogService",function(a,b,c,d,e,f,g,h){function i(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return null}function j(){var a="https://subscribe.washingtonpost.com/person/verify-login",c={wapoLoginID:i("wapo_login_id"),wapoSecureID:i("wapo_secure_login_id"),userAgent:navigator.userAgent};return null!=c.wapoLoginID&&b({method:"POST",url:a,data:c}).success(function(a){"SUCCESS"==a.status||(c={})}).error(function(a,b){}),c}a.appId=null,a.submission={formData:[],mediasets:[],documentSets:[],videoSets:[],customerId:"",appId:"",accountId:"",paramObject:"",isDraft:!1,approvalNotification:!1,createdDate:new Date},a.hasError=!1;var k=e.search();a.submission.paramObject=k,a.hostedOutput={},a.submission.formData=a.hostedOutput;var l,m=window.location.hostname;l="localhost"==m?"//localhost:3000":"wp-sub.wpprivate.com"==m?"//wp-sub.wpprivate.com":"wp-sub-qa.digitalink.com"==m?"//wp-sub-qa.digitalink.com":"wp-sub-stage.digitalink.com"==m?"//wp-sub-stage.digitalink.com":"//sub.washingtonpost.com",a.init=function(d,e,i){$.reject({reject:{msie:8},display:["firefox","chrome","safari"],imagePath:"../javascripts/resources/jReject/images/",close:!1}),a.appId=d,a.tokenTrue=!0,a.submission.appId=d,a.subId=e,f.getForm({id:a.appId+".json"},function(d){if(a.application=d.applicationInfo,a.submission.approvalNotification=d.applicationInfo.approvalNotification,h.debug({message:"retrieved data successfully"+a.application}),a.submission.paramObject)for(var f in a.submission.paramObject)if(a.submission.paramObject.hasOwnProperty(f)){var j=a.submission.paramObject[f];$.isNumeric(j)?a.submission.formData[f]=Number(j):a.submission.formData[f]=a.submission.paramObject[f]}1==a.application.submissionEdit&&""!==a.subId&&g.getSingleSub({id:e+".json"},function(b){b.editToken==i?(angular.forEach(a.submission.formData,function(a,c){b.formData[c]||(b.formData[c]=a)}),a.submission=b,a.hostedOutput=b.formData,a.$broadcast("checkDraftForUploads",a.submission),console.log(a.submission.isDraft),angular.forEach(b.formData,function(b,c){for(var d=0;d<a.application.appFormFields.length;d++)if(c==a.application.appFormFields[d].uniqueId)if("firstAndLastName"==a.application.appFormFields[d].fieldType){var e=b.split("|");a.application.appFormFields[d].fandLName_first=e[0],a.application.appFormFields[d].fandLName_last=e[1]}else if("address"==a.application.appFormFields[d].fieldType){var f=b.split(",");a.application.appFormFields[d].address_address1=f[0],a.application.appFormFields[d].address_address2=f[1],a.application.appFormFields[d].address_city=f[2],a.application.appFormFields[d].address_usState.abbreviation=f[3],a.application.appFormFields[d].address_state=f[3],a.application.appFormFields[d].address_postalcode=f[4],a.application.appFormFields[d].address_country.name=f[5]}else if("phoneNumber"==a.application.appFormFields[d].fieldType){var g=b.split("-");a.application.appFormFields[d].phNum_areacode=g[0],a.application.appFormFields[d].phNum_prefix=g[1],a.application.appFormFields[d].phNum_linenum=g[2]}else if("radio"==a.application.appFormFields[d].fieldType&&a.application.appFormFields[d].isConditional)for(var h=0;h<a.application.appFormFields[d].fieldTypeOptionsArray.length;h++)a.application.appFormFields[d].fieldTypeOptionsArray[h].optionValue==b.optionValue&&(a.hostedOutput[c]=a.application.appFormFields[d].fieldTypeOptionsArray[h])}),a.tokenTrue=!0):a.tokenTrue=!1}),a.application.appDescriptionSafe=c.trustAsHtml(a.application.appDescription),a.application.messageNextToDraftBtnSafe=c.trustAsHtml(a.application.messageNextToDraftBtn),a.submission.customerId=d.applicationInfo.customerId,a.submission.accountId=d.applicationInfo.accountId,a.submission.approved=d.applicationInfo.autoApproved,window.document.title="SUB | "+a.application.appName;var k=new Date;(a.application.activeStartDate>k.toISOString()||a.application.activeEndDate<k.toISOString())&&(a.application.active=!1),a.application.submissionLimit===!0&&b({method:"GET",url:"/accountSubs/"+a.submission.accountId}).success(function(b){a.accountSubs=b.Results,a.appSubs=a.accountSubs[a.appId],a.appSubs>=a.application.submissionLimitAmount&&(a.application.active=!1)}),a.application.tinyUrl?a.shareUrl="https://sub.washingtonpost.com/hosted/"+a.application._id:a.shareUrl="https://sub.washingtonpost.com/hosted/"+a.application._id})},a.checkForPrivateFields=function(a){var b=!1;if(a)for(var c=0;c<a.length;c++)b=!a[c].isPublic;return b},a.submitForm=function(){if(a.application.hasCaptcha&&(a.captchaFulfilled=grecaptcha.getResponse()),console.log("app is draft ",a.application.submissionEdit),console.log("sub is draft ",a.submission.isDraft),a.submission.isDraft&&!a.application.submissionEdit&&(a.submission.isDraft=!1,a.submission.submitted=!0),a.hosted.$invalid&&0==a.submission.isDraft)return a.hasError=!0,a.submitted=!0,a.application.hasCaptcha&&!a.captchaFulfilled&&(a.captchaNotChecked=!0),!1;if(a.hasError=!1,a.application.hasCaptcha&&!a.captchaFulfilled)return a.hasError=!0,a.captchaNotChecked=!0,!1;a.hasError=!1;var f="/submission";null!=a.submission._id&&(f="/updateSub"),0!=a.submission.submitted&&g.updateEndUser(a.submission,function(b){a.userResponse=b},function(){}),a.submission.cookies=j(),a.submission.userAgent=navigator.userAgent,b({method:"POST",url:f,data:a.submission}).success(function(b){a.htmlConfirmationMessage=c.trustAsHtml(a.application.confirmation),a.response=b.submissionInfo,a.shareUrl="https://sub.washingtonpost.com/hosted/"+a.application._id,a.editSubmissionLink=window.location.protocol+l+"/edit/"+a.application._id+"/"+b.submissionInfo._id+"/"+b.submissionInfo.editToken,a.formSubmitted=!0,a.errorMsg=!1,d._gaq.push(["_trackEvent","hostedSubmission","Sucess","Successful Submission",e.path(),a.appId])}).error(function(b,c){d._gaq.push(["_trackEvent","hostedSubmission","Error","Could Not Submit",e.path(),a.appId])})}}]),angular.module("hostedApp.directives",["ui.bootstrap","ngResource","subPlatformServices"]).directive("subFormfield",["$compile","$filter","$http","$sce","subService","formService",function(a,b,c,d,e,f){var g={radioTemplate:'<div class="form-group"><label>{{content.fieldName}}</label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="content.isMandatory && model==null && submitted" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p>  <div class="radio" ng-repeat="field in content.fieldTypeOptions.split(\',\') track by $index" ng-hide="content.isConditional"><label for="{{content.uniqueId}}_{{$index}}"><input type="radio" name="{{content.uniqueId}}" ng-value="field" ng-model="$parent.model" id="{{content.uniqueId}}_{{$index}}" ng-required="content.isMandatory"/> {{field}}</label> </div><div class="" ng-show="content.isConditional"><div class="radio" ng-repeat="option in content.fieldTypeOptionsArray"><label><input type="radio" name="{{content.uniqueId}}" ng-value="option" id="{{option.optionId}}" ng-model="$parent.model" ng-required="content.isMandatory">{{option.optionValue}}</label></div><div ng-repeat="option in content.fieldTypeOptionsArray"><sub-formfield form-id="formId" content="condField" model="submission.formData[condField.uniqueId]" submission="submission" application="application" ng-repeat="condField in option.conditionalFields" submitted="submitted" ng-if="$parent.model==option"> </sub-formfield></div></div></div>',hiddenTemplate:'<input type="hidden" class="sub_{{content.fieldType}}" name="{{content.uniqueId}}" placeholder="{{content.placeholder}}">',textTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.text.$error.required && !form.text.$pristine) || (form.text.$error.required && submitted)" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p>  <input type="text" ng-model="model" name="text" class="form-control" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" id="{{content.uniqueId}}"/> </div></ng-form>',numberTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}} </label><span ng-if="content.min || content.max">  (Between {{content.min}} - {{content.max}})</span> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.number.$error.required && !form.number.$pristine)||(form.number.$error.required && submitted)" class="text-danger">This field is required.</span> <span ng-show="(form.number.$error.number && !form.number.$pristine)||(form.number.$error.number && submitted)" class="text-danger">This field must be a number.</span> <span ng-show="(form.number.$error.min && !form.number.$pristine)||(form.number.$error.min && submitted)" class="text-danger">This number must be greater than or equal to {{content.min}}.</span><span ng-show="(form.number.$error.max && !form.number.$pristine)||(form.number.$error.max && submitted)" class="text-danger">This number must be less than or equal to {{content.max}}.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p> <input type="number" ng-model="model" min="{{content.min}}" max="{{content.max}}" name="number" id="{{content.uniqueId}}"  class="form-control" ng-required="content.isMandatory" placeholder="{{content.placeholder}}"/> </div></ng-form>',dateTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.date.$error.required && !form.date.$pristine)||(form.date.$error.required && submitted)" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p> <p class="input-group"><input type="text" id="{{content.uniqueId}}"  class="form-control" datepicker-popup="{{format}}" ng-model="model" is-open="opened" show-weeks="false" datepicker-options="dateOptions" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" close-text="Close" name="date" /><span class="input-group-btn"><button class="btn btn-default" ng-click="opened = true;$event.preventDefault();$event.stopPropagation();"><i class="fa fa-calendar"></i></button></span></p></div></ng-form>',pastDateTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.pastdate.$error.required && !form.pastdate.$pristine)||(form.pastdate.$error.required && submitted)" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p>  <p class="input-group"><input type="text" id="{{content.uniqueId}}"  class="form-control" datepicker-popup="{{format}}" ng-model="model" is-open="opened" max-date="now" show-weeks="false" datepicker-options="dateOptions" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" close-text="Close" name="pastdate"/><span class="input-group-btn"><button class="btn btn-default" ng-click="opened = true;$event.preventDefault();$event.stopPropagation();"><i class="fa fa-calendar"></i></button></span></p></div></ng-form>',futureDateTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.futuredate.$error.required && !form.futuredate.$pristine)||(form.futuredate.$error.required && submitted)" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p>  <p class="input-group"><input type="text" id="{{content.uniqueId}}"  class="form-control" datepicker-popup="{{format}}" ng-model="model" is-open="opened" min-date="now" show-weeks="false" datepicker-options="dateOptions" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" close-text="Close" name="futuredate"/><span class="input-group-btn"><button class="btn btn-default" ng-click="opened = true;$event.preventDefault();$event.stopPropagation();"><i class="fa fa-calendar"></i></button></span></p></div></ng-form>',dobCheckTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.dobCheck.$error.required && !form.dobCheck.$pristine)||(form.dobCheck.$error.required && submitted)" class="text-danger">This field is required.</span><span class="text-danger" ng-show="form.dobCheck.$error.dobcheck"> You must be {{content.minAge}} years or older.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p>  <p class="input-group"><input type="text" id="{{content.uniqueId}}"  class="form-control" datepicker-popup="{{format}}" ng-model="model" is-open="opened" dobcheck="{{maxDate}}" max-date="now" show-weeks="false" datepicker-options="dateOptions" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" close-text="Close" name="dobCheck"/><span class="input-group-btn"><button class="btn btn-default" ng-click="opened = true;$event.preventDefault();$event.stopPropagation();"><i class="fa fa-calendar"></i></button></span></p></div></ng-form>',sectionHeaderTemplate:'<h3 class="section-header">{{content.fieldName}}<small><p class="help-block" ng-bind-html="content.descriptionSafe"></p></small></h3> ',subSectionHeaderTemplate:'<h4 class="sub-section-header">{{content.fieldName}}<small><p class="help-block" ng-bind-html="content.descriptionSafe"></p></small></h4> ',subNameTemplate:"<h4>{{content.fieldName}}</h4> ",subDescTemplate:"<h5>{{content.fieldName}}</h5> ",trueFalseTemplate:'<div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="content.isMandatory && model==null && submitted" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p> <div class="radio"> <label><input type="radio" name="{{content.uniqueId}}" value="true" ng-model="model" ng-required="content.isMandatory" placeholder="{{content.placeholder}}"/> True </label> </div><div class="radio"><label><input type="radio" name="{{content.uniqueId}}" value="false" ng-required="content.isMandatory"/> False </label> </div></div>',yesNoTemplate:'<div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="content.isMandatory && model==null && submitted" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p> <div class="radio"> <label><input type="radio" name="{{content.uniqueId}}" value="yes" ng-model="model" ng-required="content.isMandatory" placeholder="{{content.placeholder}}"/> Yes </label> </div><div class="radio"><label><input type="radio" name="{{content.uniqueId}}" value="no" ng-model="model" ng-required="content.isMandatory"/> No </label> </div></div>',dropdownTemplate:'<div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span><span ng-show="content.isMandatory && model==null && submitted" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p>  <select ng-hide="content.isConditional" ng-model="model" ng-options="option for option in content.fieldTypeOptions.split(\',\')" name="dropdown" id="{{content.uniqueId}}"  class="form-control" ng-required="content.isMandatory" > <option value="">-- Select an option --</option> </select><select ng-show="content.isConditional" ng-model="model" ng-options="option.optionValue as option.optionValue for option in content.fieldTypeOptionsArray" name="{{content.uniqueId}}" id="{{content.uniqueId}}"  class="form-control" ng-required="content.isMandatory" > <option value="">-- Select an option --</option> </select><div ng-repeat="option in content.fieldTypeOptionsArray"><sub-formfield form-id="formId" content="condField" model="submission.formData[condField.uniqueId]" submission="submission" application="application" ng-repeat="condField in option.conditionalFields" submitted="submitted" ng-if="model==option.optionValue"> </sub-formfield></div></div>',emailTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.email.$error.required && !form.email.$pristine)||(form.email.$error.required && submitted)" class="text-danger">This field is required.</span> <span ng-show="(form.email.$error.pattern && !form.email.$pristine)||(form.email.$error.pattern && submitted)" class="text-danger">This is not a valid email.</span> <p class="help-block" ng-bind-html="content.descriptionSafe"></p><input type="email" ng-pattern="/^[a-z0-9!#$%&\'*+/=?^_`{|}~.-]+@[a-z0-9-]+\\.[a-z0-9-]/i" ng-model="model" name="email" id="{{content.uniqueId}}"  class="form-control" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" /> </div></ng-form>',checkboxTemplate:'<ng-form name="form"><div class="form-group"><label>{{content.fieldName}}</label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="cblength > 0 && content.isMandatory && submitted" class="text-danger">Please check at least one.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p>  <div class="checkbox" ng-repeat="field in content.fieldTypeOptions.split(\',\')" ng-init="$parent.model = $parent.model || {}"><label><input ng-model="$parent.model[field]" type="checkbox" name="{{content.uniqueId}}"/> {{field}} <input type="text" class="form-control" ng-show="$last && content.hasOtherField" ng-model="$parent.model[\'otherVal\']" ng-disabled="!$parent.model[\'Other\']"></label> </div></div></ng-form>',textareaTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.textarea.$error.required && !form.textarea.$pristine)||(form.textarea.$error.required && submitted)" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p> <textarea ng-model="model" name="textarea" id="{{content.uniqueId}}"  class="form-control" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" maxlength="{{content.textareaCharLimit}}"></textarea> <span ng-show="content.textareaCharLimit" class="textarea-char-limit">Max Number of Characters: {{content.textareaCharLimit}}</span></div></ng-form>',mediaSetDocTemplate:'<ng-form name="form"><div class="form-group mediaset-box"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="form.mediasetDoc.$error.required && submitted" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p> <br><button class="btn btn-success" type="button" ng-click="createMediaSetModal()">Attach Document</button> <span ng-show="docNotUploaded"><em>Please upload a document</em></span><span ng-show="isDocUploaded"><i class="fa fa-check"></i></span><br><br><div media-preview="timestamp" submission-id="{{submission._id}}" mediaset-id="{{content.mediaSetId}}" num-of-media="{{numOfMedia}}"></div></div><input type="hidden" ng-model="model" name="uniqueUploadId.{{content.fieldType}}" value="{{uuId}}"/><input type="hidden" name="transfered.{{content.fieldType}}" value="false"><input type="hidden" name="mediasetId.{{content.fieldType}}" value="false"><input type="hidden" ng-model="isDocUploaded" name="mediasetDoc" ng-required="content.isMandatory" /><div class="modal fade hosted-modal" id="{{uuId}}_hostedModal"><div class="modal-dialog"><div class="modal-content"><button type="button" ng-click="modalClosed()" class="close" data-dismiss="modal" aria-hidden="true">Close</button><iframe></iframe></div></div></div><hr></ng-form>',mediaSetVidTemplate:'<ng-form name="form"><div class="form-group mediaset-box"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="form.mediasetVid.$error.required && submitted" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p> <br><button class="btn btn-success" type="button" ng-click="createMediaSetModal()">Attach Video</button> <span ng-show="vidNotUploaded"><em>Please upload a video</em></span><span ng-show="isVidUploaded"><i class="fa fa-check"></i></span><br><br><div media-preview="timestamp" submission-id="{{submission._id}}" mediaset-id="{{content.mediaSetId}}" num-of-media="{{numOfMedia}}"></div></div><input type="hidden" ng-model="model" name="uniqueUploadId.{{content.fieldType}}" value="{{uuId}}"/><input type="hidden" name="transfered.{{content.fieldType}}" value="false"><input type="hidden" name="mediasetId.{{content.fieldType}}" value="false"><input type="hidden" ng-model="isVidUploaded" name="mediasetVid" ng-required="content.isMandatory" /><div class="modal fade hosted-modal" id="{{uuId}}_hostedModal"><div class="modal-dialog"><div class="modal-content"><button type="button" ng-click="modalClosed()" class="close" data-dismiss="modal" aria-hidden="true">Close</button><iframe></iframe></div></div></div><hr></ng-form>',mediaSetAudioTemplate:'<ng-form name="form"><div class="form-group mediaset-box"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="form.mediasetAudio.$error.required && submitted" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p> <br><button class="btn btn-success" type="button" ng-click="createMediaSetModal()">Attach Audio File</button> <span ng-show="audioNotUploaded"><em>Please upload a video</em></span><span ng-show="isAudioUploaded"><i class="fa fa-check"></i></span><br><br><div media-preview="timestamp" submission-id="{{submission._id}}" mediaset-id="{{content.mediaSetId}}" num-of-media="{{numOfMedia}}"></div></div><input type="hidden" ng-model="model" name="uniqueUploadId.{{content.fieldType}}" value="{{uuId}}"/><input type="hidden" name="transfered.{{content.fieldType}}" value="false"><input type="hidden" name="mediasetId.{{content.fieldType}}" value="false"><input type="hidden" ng-model="isAudioUploaded" name="mediasetAudio" ng-required="content.isMandatory" /><div class="modal fade hosted-modal" id="{{uuId}}_hostedModal"><div class="modal-dialog"><div class="modal-content"><button type="button" ng-click="modalClosed()" class="close" data-dismiss="modal" aria-hidden="true">Close</button><iframe></iframe></div></div></div><hr></ng-form>',mediaSetTemplate:'<ng-form name="form"><div class="form-group mediaset-box"><label for="{{formId}}_{{content.fieldName}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="numOfMedia==1"><em>You can upload {{numOfMedia}} image</em></span><span ng-show="numOfMedia>1"><em>You can attach up to {{numOfMedia}} images</em></span> <span ng-show="form.mediaset.$error.required && submitted" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p> <br><button class="btn btn-success" type="button" ng-click="createMediaSetModal()">Attach Photo(s)</button><br><br><div media-preview="timestamp" submission-id="{{submission._id}}" mediaset-id="{{content.mediaSetId}}" num-of-media="{{numOfMedia}}"></div></div><input type="hidden" ng-model="model" name="uniqueUploadId.{{content.fieldType}}" value="{{uuId}}"/><input type="hidden" name="mediaset" ng-model="isPhotoUploaded" ng-required="content.isMandatory" /><input type="hidden" name="transfered.{{content.fieldType}}" value="false"><input type="hidden" name="mediasetId.{{content.fieldType}}" value="false"><div class="modal fade hosted-modal" id="{{uuId}}_hostedModal"><div class="modal-dialog"><div class="modal-content"><button type="button" ng-click="modalClosed()" class="close" data-dismiss="modal" aria-hidden="true">Close</button><iframe></iframe></div></div></div><hr></ng-form>',firstAndLastNameTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.name_first.$error.required && !form.name_first.$pristine)|| (form.name_last.$error.required && !form.name_last.$pristine)||(form.name_first.$error.required && submitted)|| (form.name_last.$error.required && submitted)" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p>  <br><div class="row"><div class="col-sm-6"><input type="text" name="name_first" class="form-control" ng-required="content.isMandatory" ng-model="content.fandLName_first" ng-change="concatName()"/><p class="help-block">First</p></div><div class="col-sm-6"><input type="text" name="name_last" class="form-control" ng-required="content.isMandatory" ng-model="content.fandLName_last" ng-change="concatName()"/><p class="help-block">Last</p></div></div></div></ng-form>',phoneNumberTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.phnum_areacode.$error.required && !form.phnum_areacode.$pristine)|| (form.phnum_prefix.$error.required && !form.phnum_prefix.$pristine) || (form.phnum_linenum.$error.required && !form.phnum_linenum.$pristine)||(form.phnum_areacode.$error.required && submitted)|| (form.phnum_prefix.$error.required && submitted) || (form.phnum_linenum.$error.required && submitted)" class="text-danger">This field is required.</span> <span ng-show="(form.phnum_areacode.$error.pattern )|| (form.phnum_prefix.$error.pattern) || (form.phnum_linenum.$error.pattern)" class="text-danger">This field must be a number and the correct length.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p><br><div class="row"><div class="col-sm-2 phone-num"><input type="text" ng-model="content.phNum_areacode" name="phnum_areacode" id="{{content.uniqueId}}" class="form-control" ng-required="content.isMandatory" ng-change="concatPhNum()" min="0" max="999" ng-pattern="/^[0-9]{3,3}$/"/  ng-maxlength="3" tabindex="{{index*1000}}" auto-next><p class="help-block">###</p></div><div class="col-sm-1 em-dash">&#8212;</div><div class="col-sm-2 phone-num"><input type="text" ng-model="content.phNum_prefix" name="phnum_prefix" id="{{content.uniqueId}}" class="form-control" ng-required="content.isMandatory" ng-change="concatPhNum()" min="0" max="999" ng-pattern="/^[0-9]{3,3}$/"/  ng-maxlength="3"  tabindex="{{(index*1000)+1}}" auto-next><p class="help-block">###</p></div><div class="col-sm-1 em-dash">&#8212;</div><div class="col-sm-2 phone-num"><input type="text" ng-model="content.phNum_linenum" name="phnum_linenum" id="{{content.uniqueId}}" class="form-control" ng-required="content.isMandatory" ng-change="concatPhNum()" min="0" max="9999" ng-pattern="/^[0-9]{4,4}$/"/ ng-maxlength="4"  tabindex="{{(index*1000)+2}}" auto-next><p class="help-block">####</p></div></div></div></ng-form>',addressTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.address1.$error.required && !form.address1.$pristine)|| (form.city.$error.required && !form.city.$pristine) || (form.postalcode.$error.required && !form.postalcode.$pristine)||(form.address1.$error.required && submitted)|| (form.city.$error.required && submitted) || (form.postalcode.$error.required && submitted)" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p><br><div class="row"><div class="col-sm-12"><input type="text" class="form-control" ng-model="content.address_address1" ng-change="concatAddress()" ng-required="content.isMandatory" name="address1"><p class="help-block">Street Address</p></div></div><div class="row"><div class="col-sm-12"><input type="text" class="form-control" ng-model="content.address_address2" ng-change="concatAddress()"><p class="help-block">Address Line 2</p></div></div><div class="row"><div class="col-sm-6"><input type="text" name="city" class="form-control" ng-model="content.address_city" ng-change="concatAddress()" ng-required="content.isMandatory"><p class="help-block">City</p></div><div class="col-sm-6"><input type="text" class="form-control"  ng-model="content.address_state" ng-change="concatAddress()" ng-hide="isUS"><select class="form-control" ng-model="content.address_usState" ng-options="state.name for state in states track by state.abbreviation" ng-show="isUS" ng-change="concatAddress()" ng-init="content.address_usState.abbreviation=defaultState"><option value="">--choose--</option></select><p class="help-block">State/Province/Region</p></div></div><div class="row"><div class="col-sm-6"><input type="text" name="postalcode" class="form-control" ng-model="content.address_postalcode" ng-change="concatAddress()" ng-required="content.isMandatory"><p class="help-block">Postal Code</p></div><div class="col-sm-6"><select class="form-control" ng-options="country.name for country in countries track by country.name" ng-model="content.address_country" ng-change="concatAddress()" ng-init="content.address_country.name=defaultCountry" ng-required="content.isMandatory"><option value="">--choose--</option></select><p class="help-block">Country</p></div></div></div></ng-form>',
timeTemplate:'<div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.time.$error.required && !form.time.$pristine)||(form.time.$error.required && submitted)" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p><p class="input-group"><timepicker ng-model="model" id="{{content.uniqueId}}" name="time"></timepicker></p></div>',parameterTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.text.$error.required && !form.text.$pristine) || (form.text.$error.required && submitted)" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p>  <input type="text" ng-model="model" name="text" class="form-control" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" id="{{content.uniqueId}}"/> </div></ng-form>'},h=function(a){var b={};return b=a.isPublic?g[a.fieldType+"Template"]:g.hiddenTemplate,"undefined"!=typeof b&&null!=b?b:""},i=function(b,f,g,i){function j(){return $(document).height()-80}if(b.formInfo=i,b.content.descriptionSafe=d.trustAsHtml(b.content.description),b.content.isPublic){if("futureDate"===b.content.fieldType||"pastDate"===b.content.fieldType)b.now=new Date;else if("time"===b.content.fieldType)b.model=new Date;else if("checkbox"==b.content.fieldType)b.content.hasOtherField&&(b.content.fieldTypeOptions=b.content.fieldTypeOptions+",Other"),b.cblength=b.content.fieldTypeOptions.split(",").length;else if("phoneNumber"==b.content.fieldType)b.concatPhNum=function(){var a=b.content.phNum_areacode?b.content.phNum_areacode:"",c=b.content.phNum_prefix?b.content.phNum_prefix:"",d=b.content.phNum_linenum?b.content.phNum_linenum:"";b.submission.formData[b.content.uniqueId]=a+"-"+c+"-"+d};else if("firstAndLastName"==b.content.fieldType)b.concatName=function(){var a=b.content.fandLName_first?b.content.fandLName_first:"",c=b.content.fandLName_last?b.content.fandLName_last:"";b.submission.formData[b.content.uniqueId]=a+"|"+c};else if("address"===b.content.fieldType)c.get("/javascripts/vendors/countries.json").success(function(a,c){b.countries=a}).error(function(){}),c.get("/javascripts/vendors/us-states.json").success(function(a,c){b.states=a}).error(function(){}),b.defaultCountry="United States",b.defaultState="DC",b.isUS=!0,b.concatAddress=function(){var a,c=b.content.address_address1?b.content.address_address1:"",d=b.content.address_address2?b.content.address_address2:"",e=b.content.address_city?b.content.address_city:"",f=b.content.address_postalcode?b.content.address_postalcode:"",g=b.content.address_country.name;"United States"==g?(b.isUS=!0,a=b.content.address_usState?b.content.address_usState.abbreviation:""):(b.isUS=!1,a=b.content.address_state?b.content.address_state:""),b.submission.formData[b.content.uniqueId]=c+", "+d+", "+e+","+a+", "+f+","+g};else if("radio"===b.content.fieldType||"dropdown"===b.content.fieldType)b.content.isConditional?b.condFields=b.$parent.model={}:b.content.hasOtherField&&(b.content.fieldTypeOptions=b.content.fieldTypeOptions+",Other");else if("dobCheck"===b.content.fieldType){var k=new Date;k=new Date(k.getFullYear()-b.content.minAge,k.getMonth(),k.getDate()),b.maxDate=k.toISOString(),b.now=new Date}else if("mediaSet"===b.content.fieldType||"mediaSetDoc"===b.content.fieldType||"mediaSetVid"===b.content.fieldType||"mediaSetAudio"===b.content.fieldType){if(b.$on("checkDraftForUploads",function(a,c){b.checkDraftForUploads(c)}),"mediaSet"===b.content.fieldType)for(var l=b.content.mediaSetId,m=0;m<b.application.mediaSets.length;m++)l==b.application.mediaSets[m]._id&&(b.numOfMedia=b.application.mediaSets[m].numOfMedia);else b.numOfMedia=1;null==b.uuId&&(b.submission.mediasets[b.content.mediaSetId]&&b.submission.mediasets[b.content.mediaSetId].uniqueUploadId&&(b.uuId=b.submission.mediasets[b.content.mediaSetId].uniqueUploadId),b.uuId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)}));var n="/"+b.formId+"/"+b.content.mediaSetId+"/"+b.uuId+"/pup";b.checkDraftForUploads=function(a){b.timestamp=(new Date).getTime(),c.get("/"+a._id+"/"+b.content.mediaSetId+"/mediaset.json",{}).success(function(a,c){null!=a[0].mediasets[0].media&&a[0].mediasets[0].media.length>0?"mediaSetVid"==b.content.fieldType?(b.isVidUploaded=!0,b.vidNotUploaded=!1):"mediaSetDoc"==b.content.fieldType?(b.isDocUploaded=!0,b.docNotUploaded=!1):"mediaSetAudio"==b.content.fieldType&&(b.isAudioUploaded=!0,b.docAudioUploaded=!1):"mediaSetVid"==b.content.fieldType?(b.content.isMandatory&&(b.vidNotUploaded=!0),b.isVidUploaded=""):"mediaSetDoc"==b.content.fieldType?(b.content.isMandatory&&(b.docNotUploaded=!0),b.isDocUploaded=""):"mediaSetAudio"==b.content.fieldType&&(b.content.isMandatory&&(b.audioNotUploaded=!0),b.isAudioUploaded="")})},b.modalClosed=function(){b.timestamp=(new Date).getTime(),c.get("/"+b.submission._id+"/"+b.content.mediaSetId+"/mediaset.json",{}).success(function(a,c){null!=a[0].mediasets[0].media&&a[0].mediasets[0].media.length>0?"mediaSetVid"==b.content.fieldType?(b.isVidUploaded=!0,b.vidNotUploaded=!1):"mediaSetDoc"==b.content.fieldType?(b.isDocUploaded=!0,b.docNotUploaded=!1):"mediaSetAudio"==b.content.fieldType&&(b.isAudioUploaded=!0,b.docAudioUploaded=!1):"mediaSetVid"==b.content.fieldType?(b.content.isMandatory&&(b.vidNotUploaded=!0),b.isVidUploaded=""):"mediaSetDoc"==b.content.fieldType?(b.content.isMandatory&&(b.docNotUploaded=!0),b.isDocUploaded=""):"mediaSetAudio"==b.content.fieldType&&(b.content.isMandatory&&(b.audioNotUploaded=!0),b.isAudioUploaded="")}).error(function(){})},b.createMediaSetModal=function(){b.timestamp=(new Date).getTime();for(var a,c=0;c<b.application.mediaSets.length;c++)b.application.mediaSets[c].hasOwnProperty("_id")&&b.application.mediaSets[c]._id==b.content.mediaSetId&&(b.numOfMedia=b.application.mediaSets[c].numOfMedia,a=c);b.submission.mediasets[b.content.mediaSetId]={},b.submission.mediasets[b.content.mediaSetId].uniqueUploadId=b.uuId,b.submission.mediasets[b.content.mediaSetId].transfered=!1,b.submission.mediasets[b.content.mediaSetId].mediasetId=b.content.mediaSetId,null==b.submission._id?e.createEmptySubmission(b.submission,function(a){function c(a){a.originalEvent.origin===a.originalEvent.data&&(b.modalClosed(),$("#"+b.uuId+"_hostedModal").modal("hide"))}b.submission._id=a.submissionInfo._id,n="/"+b.formId+"/"+b.content.mediaSetId+"/"+b.uuId+"/"+b.submission._id+"/pup";var d=j();d>800&&(d=800),$("#"+b.uuId+"_hostedModal iframe").css("height",d).attr("src",n),$("#"+b.uuId+"_hostedModal").modal(),$(window).on("message",c)},function(){}):e.updateSub(b.submission,function(a){var c="/"+b.formId+"/"+b.content.mediaSetId+"/"+b.uuId+"/"+b.submission._id+"/pup",d=j();$("#"+b.uuId+"_hostedModal iframe").css("height",d).attr("src",c),$("#"+b.uuId+"_hostedModal").modal()},function(){})}}f.html(h(b.content)).show()}else f.html(h("hidden")).show();a(f.contents())(b)};return{restrict:"E",require:"^form",replace:!0,link:i,scope:{content:"=",formId:"=?",submission:"=",application:"=",model:"=?",submitted:"=?",index:"=?"}}}]).directive("errSrc",function(){return{link:function(a,b,c){b.bind("error",function(){c.src!=c.errSrc&&c.$set("src",c.errSrc)})}}}).directive("photoPreview",["$timeout","$http","$compile",function(a,b,c){return function(a,d,e){var f="";parseInt(e.mediasetId)>0&&(f="/"+e.mediasetId);"//sub-cdn.washingtonpost.com/"+e.submissionId+f+"/0_thumb";a.$watch(e.photoPreview,function(g){for(var h=0,i="<br><div class='row' ><ul class='list-unstyled'>";h<e.numOfMedia;)i+="<li class='col-md-3'><br><img src='//sub-cdn.washingtonpost.com/"+e.submissionId+f+"/"+h+"_thumb?"+g+"' err-src='/images/no-image-available.png' alt='image'/></li>",h++;i+="</ul></div>",b.get("//sub-cdn.washingtonpost.com/"+e.submissionId+f+"/0_thumb",{}).success(function(b,e){a.isPhotoUploaded=!0;c(i)(a,function(a,b){d.html(a)})}).error(function(){})})}}]).directive("mediaPreview",["$timeout","$http","$compile",function(a,b,c){return function(a,d,e){a.$watch(e.mediaPreview,function(f){e.submissionId&&b.get("/"+e.submissionId+"/"+e.mediasetId+"/mediaset.json").success(function(b){for(var e=b[0].mediasets[0].media,f="",g=0;g<e.length;g++)f+=e[g].hasOwnProperty("mediaUrlThumb")?"<li><img class='photo-preview' src='"+e[g].mediaUrlThumb+"'></li>":"<li>"+e[g].originalName+": <a href='"+e[g].mediaUrl+"' target='_blank'>http:"+e[g].mediaUrl+"</a></li>",console.log("mediasetType is "+e[g].mediaSetType),"image"==e[g].mediaSetType&&(a.isPhotoUploaded=!0);c("<ul class='list-unstyled'>"+f+"</ul>")(a,function(a,b){d.html(a)})})})}}]).directive("dobcheck",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.unshift(function(a){var b=new Date(a).toISOString();return d.$setValidity("dobcheck",c.dobcheck>=b),a})}}}).directive("autoNext",function(){return{restrict:"A",link:function(a,b,c,d){var e=parseInt(c.tabindex),f=parseInt(c.ngMaxlength);b.on("keyup",function(a){if(b.val().length>f-1){var c=angular.element(document.body).find("[tabindex="+(e+1)+"]");return c.length>0?(c.focus(),c.triggerHandler("keyup",{which:a.which})):!1}return!0})}}}),angular.module("socialApp.directives",[]).directive("fbLike",["$window","$rootScope","$compile",function(a,b,c){return{restrict:"A",link:function(b,d,e){function f(){d.html('<a ng-click="openFBShareWindow()" href="#"><i style="color: #3b5998" class="fa fa-facebook-square fa-3x"></i></a>'),c(d.contents())(b)}a.FB?f():$.getScript("//connect.facebook.net/en_US/sdk.js",function(){a.FB.init({appId:"274964949368857",xfbml:!0,version:"v2.1"}),f()}),b.openFBShareWindow=function(){a.open("https://www.facebook.com/sharer/sharer.php?u="+e.shareUrl,"","left=20, width=500, height=400")},b.customShare=function(){a.FB.ui({method:"share",href:e.shareUrl},function(a){})}}}}]).directive("tweet",["$window","$compile",function(a,b){return{restrict:"A",scope:{tweet:"="},link:function(c,d,e){function f(){d.html('<a ng-click="openTwitterShareWindow()" data-text="I just did something cool." href="#"><i style="color: #4099FF" class="fa fa-twitter-square fa-3x"></i></a>'),b(d.contents())(c),a.twttr.widgets.load(d.parent()[0])}a.twttr?f():$.getScript("//platform.twitter.com/widgets.js",function(){f()}),c.openTwitterShareWindow=function(){a.open("https://twitter.com/share?url="+e.shareUrl,"","left=20, width=500, height=400")}}}}]).directive("googlePlus",["$window","$compile",function(a,b){return{restrict:"A",link:function(c,d,e){function f(){d.html('<a ng-click="openGoogleShareWindow()" href="#"><i style="color: #d34836" class="fa fa-google-plus-square fa-3x"></i></a>'),b(d.contents())(c),a.gapi.plusone.go(d.parent()[0])}a.gapi?f():$.getScript("//apis.google.com/js/platform.js",function(){f()}),c.openGoogleShareWindow=function(){a.open("https://plus.google.com/share?url="+e.shareUrl,"","left=20, width=500, height=400")}}}}]),function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-6350795-19","auto"),ga("send","pageview");
//# sourceMappingURL=hosted.min.js.map