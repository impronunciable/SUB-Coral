!function(a,b){return"function"==typeof define&&define.amd?void define("angular-file-upload",["angular"],function(a){return b(a)}):b(a)}(angular||null,function(a){var b=a.module("angularFileUpload",[]);return b.directive("ngFileDrop",["$fileUploader",function(b){"use strict";return{link:b.isHTML5?function(a,b,c){b.bind("drop",function(b){var d=b.dataTransfer?b.dataTransfer:b.originalEvent.dataTransfer;d&&(b.preventDefault(),b.stopPropagation(),a.$broadcast("file:removeoverclass"),a.$emit("file:add",d.files,a.$eval(c.ngFileDrop)))}).bind("dragover",function(b){var c=b.dataTransfer?b.dataTransfer:b.originalEvent.dataTransfer;b.preventDefault(),b.stopPropagation(),c.dropEffect="copy",a.$broadcast("file:addoverclass")}).bind("dragleave",function(){a.$broadcast("file:removeoverclass")})}:a.noop}}]),b.directive("ngFileOver",function(){"use strict";return{link:function(a,b,c){a.$on("file:addoverclass",function(){b.addClass(c.ngFileOver||"ng-file-over")}),a.$on("file:removeoverclass",function(){b.removeClass(c.ngFileOver||"ng-file-over")})}}}),b.directive("ngFileSelect",["$fileUploader",function(a){"use strict";return{link:function(b,c,d){a.isHTML5||c.removeAttr("multiple"),c.bind("change",function(){b.$emit("file:add",a.isHTML5?this.files:this,b.$eval(d.ngFileSelect)),a.isHTML5&&c.attr("multiple")&&c.prop("value",null)}),c.prop("value",null)}}}]),b.factory("$fileUploader",["$compile","$rootScope","$http","$window",function(b,c,d,e){"use strict";function f(b){a.extend(this,{scope:c,url:"/",alias:"file",queue:[],headers:{},progress:null,autoUpload:!1,removeAfterUpload:!1,method:"POST",filters:[],formData:[],isUploading:!1,_nextIndex:0,_timestamp:Date.now()},b),this.filters.unshift(this._filter),this.scope.$on("file:add",function(a,b,c){a.stopPropagation(),this.addToQueue(b,c)}.bind(this)),this.bind("beforeupload",g.prototype._beforeupload),this.bind("in:progress",g.prototype._progress),this.bind("in:success",g.prototype._success),this.bind("in:cancel",g.prototype._cancel),this.bind("in:error",g.prototype._error),this.bind("in:complete",g.prototype._complete),this.bind("in:progress",this._progress),this.bind("in:complete",this._complete)}function g(c){if(!f.prototype.isHTML5){var d=a.element(c.file),e=b(d.clone())(c.uploader.scope),g=d.val();c.file={lastModifiedDate:null,size:null,type:"like/"+g.slice(g.lastIndexOf(".")+1).toLowerCase(),name:g.slice(g.lastIndexOf("/")+g.lastIndexOf("\\")+2)},c._input=d,e.prop("value",null),d.css("display","none").after(e)}a.extend(this,{isReady:!1,isUploading:!1,isUploaded:!1,isSuccess:!1,isCancel:!1,isError:!1,progress:null,index:null},c)}return f.prototype={constructor:f,_filter:function(b){return a.isElement(b)?!0:!!b.size},bind:function(a,b){return this.scope.$on(this._timestamp+":"+a,b.bind(this))},trigger:function(a,b){arguments[0]=this._timestamp+":"+a,this.scope.$broadcast.apply(this.scope,arguments)},isHTML5:!(!e.File||!e.FormData),isCanvasSupported:!(!e.FileReader||!e.CanvasRenderingContext2D),addToQueue:function(b,c){var d=this.queue.length,e="length"in b?b:[b];a.forEach(e,function(b){var d=this.filters.length?this.filters.every(function(a){return a.call(this,b)},this):!0;if(d){var e=new g(a.extend({url:this.url,alias:this.alias,headers:a.copy(this.headers),formData:a.copy(this.formData),removeAfterUpload:this.removeAfterUpload,method:this.method,uploader:this,file:b},c));this.queue.push(e),this.trigger("afteraddingfile",e)}},this),this.queue.length!==d&&(this.trigger("afteraddingall",this.queue),this.progress=this._getTotalProgress()),this._render(),this.autoUpload&&this.uploadAll()},removeFromQueue:function(a){var b=this.getIndexOfItem(a),c=this.queue[b];c.isUploading&&c.cancel(),this.queue.splice(b,1),c._destroy(),this.progress=this._getTotalProgress()},clearQueue:function(){this.queue.forEach(function(a){a.isUploading&&a.cancel(),a._destroy()},this),this.queue.length=0,this.progress=0},getIndexOfItem:function(b){return a.isObject(b)?this.queue.indexOf(b):b},getNotUploadedItems:function(){return this.queue.filter(function(a){return!a.isUploaded})},getReadyItems:function(){return this.queue.filter(function(a){return a.isReady&&!a.isUploading}).sort(function(a,b){return a.index-b.index})},uploadItem:function(a){var b=this.getIndexOfItem(a),c=this.queue[b],d=this.isHTML5?"_xhrTransport":"_iframeTransport";c.index=c.index||this._nextIndex++,c.isReady=!0,this.isUploading||(this.isUploading=!0,this[d](c))},cancelItem:function(a){var b=this.getIndexOfItem(a),c=this.queue[b],d=this.isHTML5?"_xhr":"_form";c[d]&&c[d].abort()},editItem:function(a){console.log(a)},uploadAll:function(){var a=this.getNotUploadedItems().filter(function(a){return!a.isUploading});a.forEach(function(a){a.index=a.index||this._nextIndex++,a.isReady=!0},this),a.length&&this.uploadItem(a[0])},cancelAll:function(){this.getNotUploadedItems().forEach(function(a){this.cancelItem(a)},this)},_render:function(){this.scope.$$phase||this.scope.$digest()},_getTotalProgress:function(a){if(this.removeAfterUpload)return a||0;var b=this.getNotUploadedItems().length,c=b?this.queue.length-b:this.queue.length,d=100/this.queue.length,e=(a||0)*d/100;return Math.round(c*d+e)},_progress:function(a,b,c){var d=this._getTotalProgress(c);this.trigger("progressall",d),this.progress=d,this._render()},_complete:function(){var b=this.getReadyItems()[0];return this.isUploading=!1,a.isDefined(b)?void this.uploadItem(b):(this.trigger("completeall",this.queue),this.progress=this._getTotalProgress(),void this._render())},_xhrTransport:function(b){var c=b._xhr=new XMLHttpRequest,d=new FormData,e=this;this.trigger("beforeupload",b),b.formData.forEach(function(b){a.forEach(b,function(a,b){d.append(b,a)})}),d.append(b.alias,b.file),c.upload.onprogress=function(a){var c=a.lengthComputable?100*a.loaded/a.total:0;e.trigger("in:progress",b,Math.round(c))},c.onload=function(){var a=e._transformResponse(c.response),d=e._isSuccessCode(c.status)?"success":"error";e.trigger("in:"+d,c,b,a),e.trigger("in:complete",c,b,a)},c.onerror=function(){e.trigger("in:error",c,b),e.trigger("in:complete",c,b)},c.onabort=function(){e.trigger("in:cancel",c,b),e.trigger("in:complete",c,b)},c.open(b.method,b.url,!0),a.forEach(b.headers,function(a,b){c.setRequestHeader(b,a)}),c.send(d)},_iframeTransport:function(b){var c=a.element('<form style="display: none;" />'),d=a.element('<iframe name="iframeTransport'+Date.now()+'">'),e=b._input,f=this;b._form&&b._form.replaceWith(e),b._form=c,this.trigger("beforeupload",b),e.prop("name",b.alias),b.formData.forEach(function(b){a.forEach(b,function(b,d){c.append(a.element('<input type="hidden" name="'+d+'" value="'+b+'" />'))})}),c.prop({action:b.url,method:b.method,target:d.prop("name"),enctype:"multipart/form-data",encoding:"multipart/form-data"}),d.bind("load",function(){var a=d[0].contentDocument.body.innerHTML,c={response:a,status:200,dummy:!0},e=f._transformResponse(c.response);f.trigger("in:success",c,b,e),f.trigger("in:complete",c,b,e)}),c.abort=function(){var a={status:0,dummy:!0};d.unbind("load").prop("src","javascript:false;"),c.replaceWith(e),f.trigger("in:cancel",a,b),f.trigger("in:complete",a,b)},e.after(c),c.append(e).append(d),c[0].submit()},_isSuccessCode:function(a){return a>=200&&300>a||304===a},_transformResponse:function(a){return d.defaults.transformResponse.forEach(function(b){a=b(a)}),a}},g.prototype={constructor:g,remove:function(){this.uploader.removeFromQueue(this)},upload:function(){this.uploader.uploadItem(this)},cancel:function(){this.uploader.cancelItem(this)},edit:function(){this.uploader.editItem(this)},_destroy:function(){this._form&&this._form.remove(),this._input&&this._input.remove(),delete this._form,delete this._input},_beforeupload:function(a,b){b.isReady=!0,b.isUploading=!0,b.isUploaded=!1,b.isSuccess=!1,b.isCancel=!1,b.isError=!1,b.progress=0},_progress:function(a,b,c){b.progress=c,b.uploader.trigger("progress",b,c)},_success:function(a,b,c,d){c.isReady=!1,c.isUploading=!1,c.isUploaded=!0,c.isSuccess=!0,c.isCancel=!1,c.isError=!1,c.progress=100,c.index=null,c.uploader.trigger("success",b,c,d)},_cancel:function(a,b,c){c.isReady=!1,c.isUploading=!1,c.isUploaded=!1,c.isSuccess=!1,c.isCancel=!0,c.isError=!1,c.progress=0,c.index=null,c.uploader.trigger("cancel",b,c)},_error:function(a,b,c,d){c.isReady=!1,c.isUploading=!1,c.isUploaded=!0,c.isSuccess=!1,c.isCancel=!1,c.isError=!0,c.progress=100,c.index=null,c.uploader.trigger("error",b,c,d)},_complete:function(a,b,c,d){c.uploader.trigger("complete",b,c,d),c.removeAfterUpload&&c.remove()}},{create:function(a){return new f(a)},isHTML5:f.prototype.isHTML5}}]),b}),function(){"use strict";function a(a,b,c,d,e){var f=Math.abs(Math.cos(e)),g=Math.abs(Math.sin(e)),h=a+c/2*Math.cos(e)-d/2*Math.sin(e),i=b+c/2*Math.sin(e)+d/2*Math.cos(e),j=c*f+d*g,k=c*g+d*f;return{cx:h,cy:i,width:j,height:k}}angular.module("imgEditor.directives",[]).directive("imgData",[function(){return{restrict:"A",link:function(a,b,c){var d=a.$eval(c.imgData),e=new FileReader;e.onload=function(){a.$apply(function(){var c=new Image;c.onload=function(){b.attr("src",c.src)},c.src=e.result,a.$broadcast("loadedImg",c,c.src)})},e.readAsDataURL(d)}}}]).directive("imgDataFromUri",function(){return{restrict:"A",link:function(b,c,d){var e=document.createElement("canvas"),f=e.getContext("2d"),g=new Image;g.onload=function(){var d=e.width=g.width,h=e.height=g.height;f.drawImage(g,0,0);var i=e.toDataURL("image/png"),j=new Image;j.src=i;var k=b.model.crop(b);if(k&&k.x>0){var l=new Image;l.src=i;var m=k;m.w=m.x2-m.x,m.h=m.y2-m.y,d=e.width,h=e.height;var n=document.createElement("canvas"),o=n.getContext("2d"),p=document.createElement("canvas"),q=p.getContext("2d"),r=a(m.x,m.y,m.w,m.h,0);n.width=p.width=r.width,n.height=p.height=r.height,o.drawImage(l,r.cx-r.width/2,r.cy-r.height/2,r.width,r.height,0,0,r.width,r.height),q.translate(parseInt(n.width/2),parseInt(n.height/2)),q.drawImage(n,parseInt(-n.width/2),parseInt(-n.height/2));var s=r.width/2-m.w/2,t=r.height/2-m.h/2;e.width=m.w,e.height=m.h,d=e.width,h=e.height,f.drawImage(p,-s,-t),l=n=p=o=q=t=s=null,i=e.toDataURL()}if(b.model.rotation(b)){for(var u=b.model.rotation(b);0>u;)u+=360;var v=u/90%4,w=new Image;w.src=i;for(var x=0;v>x;x++)e.width=h,e.height=d,d=e.width,h=e.height,f.save(),f.translate(d,h/d),f.rotate(Math.PI/2),f.drawImage(w,0,0),f.restore(),w.src=e.toDataURL();w=null,i=e.toDataURL()}b.$broadcast("loadedImg",j,i),c.attr("src",i)},g.crossOrigin="",d.$observe("imgDataFromUri",function(a){g.src=a})}}}).directive("imgThumb",[function(){return{restrict:"A",link:function(a,b,c){a.$on("loadedImg",function(a,c,d){b.attr("src",d)}),a.$on("update",function(a,c){b.attr("src",c)})}}}]).directive("imgEditable",["$parse",function(b){return{restrict:"A",link:function(c,d,e){function f(){l=null,d.attr("src",n.src),m.src=n.src}function g(){var a=new Image;a.onload=function(){var b,e,f,g=!1,h=document.createElement("canvas"),i=h.getContext("2d");h.width=a.width,h.height=a.height,e=h.width,f=h.height,i.drawImage(a,0,0,a.width,a.height),g||(g=!0,b=new Image,b.src=h.toDataURL(),b.onload=function(){h.width=f,h.height=e,e=h.width,f=h.height,i.save(),i.translate(parseInt(e),parseInt(f/e)),i.rotate(Math.PI/2),i.drawImage(b,0,0),i.restore(),b=null,g=!1,d.attr("src",h.toDataURL()),c.$broadcast("update",h.toDataURL()),h=null})},a.src=d.attr("src"),h()}function h(){var a=new Image;a.onload=function(){var b,c,d,e=!1,f=document.createElement("canvas"),g=f.getContext("2d");f.width=a.width,f.height=a.height,c=f.width,d=f.height,g.drawImage(a,0,0,a.width,a.height),e||(e=!0,b=new Image,b.src=f.toDataURL(),b.onload=function(){f.width=d,f.height=c,c=f.width,d=f.height,g.save(),g.translate(parseInt(c),parseInt(d/c)),g.rotate(Math.PI/2),g.drawImage(b,0,0),g.restore(),b=null,e=!1;var a=f.toDataURL();f=null,m.src=a})},a.src=m.src}function i(b){var e=new Image;e.src=d.attr("src");var f=document.createElement("canvas"),g=f.getContext("2d"),h=b,i=f.width,j=f.height,k=document.createElement("canvas"),l=k.getContext("2d"),m=document.createElement("canvas"),n=m.getContext("2d"),o=a(h.x,h.y,h.w,h.h,0);k.width=m.width=o.width,k.height=m.height=o.height,l.drawImage(e,o.cx-o.width/2,o.cy-o.height/2,o.width,o.height,0,0,o.width,o.height),n.translate(parseInt(k.width/2),parseInt(k.height/2)),n.drawImage(k,parseInt(-k.width/2),parseInt(-k.height/2));var p=o.width/2-h.w/2,q=o.height/2-h.h/2;f.width=h.w,f.height=h.h,i=f.width,j=f.height,g.drawImage(m,-p,-q),d.attr("src",f.toDataURL()),c.$broadcast("update",f.toDataURL()),e=f=g=i=j=h=l=n=k=m=o=p=q=null}function j(a,b,c,d,e){if(0===e)return{x:a,y:b};if(180===Math.abs(e))return{x:c-a,y:d-b};var f=e*Math.PI/180,g=a-c/2,h=b-d/2,i=d/2,j=c/2;return{x:parseInt(Math.cos(f)*g-Math.sin(f)*h+i),y:parseInt(Math.sin(f)*g+Math.cos(f)*h+j)}}var k,l,m=new Image,n=new Image;c.model={},c.model.crop=b(e.crop),c.model.rotation=b(e.rotation),c.model.trueSize=b(e.trueSize),c.crop||(c.crop=!1),c.rotation||(c.rotation=0),d.attr("src")&&d.attr("src").length>1&&(m.src=d.attr("src")),c.$on("loadedImg",function(a,b,c){m.src=c,n.src=b.src}),c.$on("crop",function(){if(c.cropping=!0,l=new Image,l.src=d.attr("src"),d.attr("src",m.src),console.log([m.width,m.height]),c.crop){var a=j(c.crop.x,c.crop.y,n.width,n.height,c.rotation),b=j(c.crop.x2,c.crop.y2,n.width,n.height,c.rotation),e=[a.x,a.y,b.x,b.y];$(d).Jcrop({trueSize:[m.width,m.height],setSelect:e},function(){k=this})}else $(d).Jcrop({trueSize:[m.width,m.height]},function(){k=this})}),c.$on("reset",function(){c.crop=!1,c.rotation=0,f(),c.$broadcast("update",n.src)}),c.$on("save",function(){if(c.cropping){l=null,c.cropping=!1;var a=k.tellSelect(),b=j(a.x,a.y,m.width,m.height,-c.rotation),e=j(a.x2,a.y2,m.width,m.height,-c.rotation);c.crop={x:b.x,y:b.y,x2:e.x,y2:e.y},c.model.crop.assign(c,c.crop),$(d).css("width",""),$(d).css("height",""),k.destroy(),i(a)}}),c.$on("cancel",function(){c.cropping&&(c.cropping=!1,d.attr("src",l.src),$(d).css("width",""),$(d).css("height",""),l=null,k.destroy())}),c.$on("rotate",function(){c.rotation=(c.rotation+90)%360,c.model.rotation.assign(c,c.rotation),g()})}}}])}(),angular.module("subPlatformServices",["ngResource"]).factory("subService",["$resource",function(a){return a("/:action/:id",{action:"@action"},{getSingleSub:{method:"GET",params:{action:"sub"}},getSubs:{method:"GET",params:{action:"subs"}},deleteSub:{method:"DELETE",params:{action:"sub"}},deleteAllSubs:{method:"DELETE",params:{action:"subs"}},submitForm:{method:"POST",params:{action:"submission"}},createEmptySubmission:{method:"Post",params:{action:"createEmptySubmission"}},updateSub:{method:"POST",params:{action:"updateSub"}},updateSubTags:{method:"POST",params:{action:"updateSubTags"}},bulkAddTags:{method:"POST",params:{action:"bulkAddSubTags"}},bulkRemoveTags:{method:"POST",params:{action:"bulkRemoveSubTags"}},bulkDeleteSubs:{method:"POST",params:{action:"bulkDeleteSubs"}},updateSubandMed:{method:"POST",params:{action:"updateSubAndMed"}},updatePupSub:{method:"POST",params:{action:"updatePupSub"}},updateEndUser:{method:"POST",params:{action:"updateEndUser"}},updateApproval:{method:"POST",params:{action:"updateApproval"}},saveSearch:{method:"POST",params:{action:"saveSearch"}},importSubs:{method:"POST",params:{action:"import"}}})}]).factory("formService",["$resource",function(a){return a("/:action/:id",{action:"@action"},{getForm:{method:"GET",params:{action:"form"}},getFormNames:{method:"GET",params:{action:"appNames.json"}},addForm:{method:"POST",params:{action:"form"}},updateForm:{method:"POST",params:{action:"updateApp"}},deleteForm:{method:"DELETE",params:{action:"form"}},deleteCategoryFromForms:{method:"DELETE",params:{action:"categories"}}})}]).factory("userService",["$resource",function(a){return a("/:action/:id",{action:"@action"},{getUser:{method:"GET",params:{action:"user"}},getUserForms:{method:"GET",params:{action:"userForms"}},getUserSubs:{method:"GET",params:{action:"customerSubs.json"}},getAllUsers:{method:"GET",params:{action:"users"}},updateUserStatus:{method:"POST",params:{action:"updateUserStatus"}},updateUser:{method:"POST",params:{action:"updateUser"}},updateUserLastActiveDate:{method:"POST",params:{action:"updateUserLastActiveDate"}},register:{method:"POST",params:{action:"register"}},checkUsername:{method:"POST",params:{action:"check",id:"username"}},checkEmail:{method:"POST",params:{action:"check",id:"email"}}})}]).factory("acctService",["$resource",function(a){return a("/:action/:id",{action:"@action"},{getAcct:{method:"GET",params:{action:"account"}},getAcctForms:{method:"GET",params:{action:"accountForms"}},getAcctSubs:{method:"GET",params:{action:"accountSubs"}},updateAccount:{method:"POST",params:{action:"updateAccount"}}})}]),angular.module("pupApp",["pupApp.directives","pupApp.controllers","hostedApp.directives","imgEditor.directives"]).config(["$httpProvider",function(a){a.interceptors.push(["$q","$rootScope",function(a,b){return{request:function(c){return b.$broadcast("loading-started"),c||a.when(c)},response:function(c){return b.$broadcast("loading-complete"),c||a.when(c)}}}])}]),angular.module("pupApp.controllers",["angularFileUpload","uuids","ngResource","subPlatformServices","loggingModuleServices"]).controller("pupController",["$scope","$rootScope","$fileUploader","$http","$location","$sce","$modal","$anchorScroll","$timeout","rfc4122","$window","subService","subLogService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n,o,p={},q=window.location.hostname;a.hasFileReader=!!k.FileReader,"localhost"==q?(n="//pupscantest.digitalink.com/photo-uploader/newuploader/",o="//localhost:3000"):"wp-sub.wpprivate.com"==q||q.indexOf("subsaastest")>-1?(n="//pupscantest.digitalink.com/photo-uploader/newuploader/",o="//wp-sub.wpprivate.com"):"wp-sub-qa.digitalink.com"==q?(n="//pupscantest.digitalink.com/photo-uploader/newuploader/",o="//wp-sub-qa.digitalink.com"):"wp-sub-stage.digitalink.com"==q?(n="//subphoto-stage.digitalink.com/photo-uploader/newuploader/",o="//wp-sub-stage.digitalink.com"):"sub.washingtonpost.com"==q?(n="//pupscan.washingtonpost.com/photo-uploader/newuploader/",o="//sub.washingtonpost.com"):(n="//pupscan.washingtonpost.com/photo-uploader/newuploader/",o="//sub.washingtonpost.com"),a.closeWindow=function(a){k.close()},a.goToTop=function(){e.hash("top"),h()};var r=window.location.pathname.split("/"),s=r[1],t=r[2],u=r[3],v=r[4];a.upId=u;var w=0;a.mediaset={},a.application={};var x,y,z,A={invalidMediaSet:"Whoops! You stumbled across an invalid media set. Please try a different one.",imageSizeError:"Whoops! Looks like your file was too large. Please try a different one.",fileTypeError:"Whoops! Looks like you accidentally tried to upload something that wasn't allowed. Please try again.",virusScanError:"",deleteFailed:"Whoops! Something went wrong with our servers and we weren't able to delete the file. Please try again.",tooManyImages:"Whoops! Looks like too many photos got uploaded. Not all of them made it. Please verify.",uploadFailed:"Whoops! Something went wrong with our servers and we weren't able to upload some of your files. Please try again.",transferFailed:"Whoops! Something went wrong with our servers and we weren't able to apply changes to your photos."};d.jsonp(o+"/"+s+"/app.jsonp?callback=JSON_CALLBACK",p,{}).success(function(b){if(a.application=b.applicationInfo,null!=a.application)for(var c=0;c<b.applicationInfo.mediaSets.length;c++)b.applicationInfo.mediaSets[c]._id==t&&(a.mediaset=b.applicationInfo.mediaSets[c]);else a.hasError=!0,a.mediasetError=!0,a.errorText=A.invalidMediaSet}).error(function(a,b){}),d.jsonp(o+"/sub/"+v+".jsonp?callback=JSON_CALLBACK",p,{}).success(function(b){x=b;for(var c=0;c<b.mediasets.length;c++)if(b.mediasets[c]&&b.mediasets[c].mediasetId==t){y=b.mediasets[c],y.uniqueUploadId&&(u=b.mediasets[c].uniqueUploadId);break}y.media||(y.media=[]),z=a.thisMedia=y.media}).error(function(a,b){}),a.deletePhoto=function(b,c){if(c){var e=a.uploader.queue[b];e.uploader.removeFromQueue(e),a.uploader.progress=a.uploader._getTotalProgress()}a.deleteChecked=!0,d.get(n+"delete/"+u+"/"+v+"/"+a.mediaset.numOfMedia+"/"+b+"/timestamp",p,{}).then(function(d){if(w>0&&w--,c)for(var e=b;e<C.queue.length;e++)C.queue[e].sequenceNumber&&C.queue[e].sequenceNumber--;if(!c)for(var e=b;e<a.thisMedia.length;e++)a.thisMedia[e].sequenceNumber>0&&a.thisMedia[e].sequenceNumber--},function(b){a.hasError=!0,a.errorText=A.deleteFailed})},a.editMode=!1,a.$on("editMode",function(){a.editMode=!a.editMode}),a.submitPupForm=function(){a.newImgsSuccess=!1,a.oldImgsSuccess=!1,a.transfered=!1;for(var c=0;c<a.uploader.queue.length;c++){var e={mediaId:j.newuuid(),originalName:a.uploader.queue[c].file.name,sequenceNumber:a.uploader.queue[c].sequenceNumber,fileExtentions:a.fileExtentions,duration:a.duration,mediaSetType:a.mediaset.mediaSetType,mediasetFormData:a.uploader.queue[c].file.mediasetFormData,crop:a.uploader.queue[c].file.crop,rotation:a.uploader.queue[c].file.rotation,mediaSetId:t};0==t?("image"==a.mediaset.mediaSetType&&(e.mediaUrlThumb="//sub-cdn.washingtonpost.com/"+v+"/"+a.uploader.queue[c].sequenceNumber+"_thumb"),e.mediaUrl="//sub-cdn.washingtonpost.com/"+v+"/"+a.uploader.queue[c].sequenceNumber+e.fileExtentions):t>0&&("image"==a.mediaset.mediaSetType&&(e.mediaUrlThumb="//sub-cdn.washingtonpost.com/"+v+"/"+t+"/"+a.uploader.queue[c].sequenceNumber+"_thumb"),e.mediaUrl="//sub-cdn.washingtonpost.com/"+v+"/"+t+"/"+a.uploader.queue[c].sequenceNumber+e.fileExtentions),z.push(e)}l.updatePupSub(x,function(c){a.oldImgsSuccess=!0,d.get(n+"transfer/"+s+"/"+t+"/"+u+"/"+v).then(function(c){window.console&&console.log("transfered"),a.transfered=!0,b.$broadcast("loading-complete-hard");var d;d="localhost"==q?"localhost:3000":q,window.parent.postMessage(window.location.protocol+"//"+d,"*")},function(c){b.$broadcast("loading-complete-hard"),a.hasError=!0,a.errorText=A.transferFailed})},function(){}),a.hasError=!1,a.hasError=!1};var B=function(){function b(){var b=document.createElement("canvas"),d=b.getContext("2d");d.drawImage(c,0,0,1,1);try{b.toDataURL("image/png"),B=!0,a.amazonUrl="//wppup2scanned.s3.amazonaws.com/"}catch(e){a.amazonUrl="/wppup2scanned/"}}var c=new Image;return c.onload=b,c.crossOrigin="anonymous",c.src="//upload.wikimedia.org/wikipedia/commons/c/ca/1x1.png",!1}();a.touch_capable=window.DocumentTouch&&document instanceof DocumentTouch;var C=a.uploader=c.create({autoUpload:!0});C.filters.push(function(b){var c=C.isHTML5?b.type:"/"+b.value.slice(b.value.lastIndexOf(".")+1),d=b.name.slice(-4),e=10;c="|"+c.toLowerCase().slice(c.lastIndexOf("/")+1)+"|";var f=-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(c),g=-1!=="|pdf|doc|docx|txt|csv|xml|ppt|plain|msword|vnd.openxmlformats-officedocument.wordprocessingml.document|vnd.ms-excel|vnd.ms-powerpoint|rtf|vnd.openxmlformats-officedocument.presentationml.presentation|".indexOf(c)||"xlsx"==d||".csv"==d,h=-1!=="|avi|mov|mp4|wmv|x-sgi-movie|x-ms-wmv|quicktime|".indexOf(c),i=-1!=="|wav|mp3|mp4|mid|x-ms-wma|mpeg|".indexOf(c),j=b.size/1024/1024<=e;return"image"==a.mediaset.mediaSetType?(f||(a.hasError=!0,a.errorText=A.fileTypeError),j||(a.hasError=!0,a.errorText=A.imageSizeError),f&&j):"document"==a.mediaset.mediaSetType?(g||(a.hasError=!0,a.errorText=A.fileTypeError),j||(a.hasError=!0,a.errorText=A.imageSizeError),g&&j):"video"==a.mediaset.mediaSetType?(h||(a.hasError=!0,a.errorText=A.fileTypeError),j||(a.hasError=!0,a.errorText=A.imageSizeError),h&&j):"audio"==a.mediaset.mediaSetType?(i||(a.hasError=!0,a.errorText=A.fileTypeError),j||(a.hasError=!0,a.errorText=A.imageSizeError),i&&j):void 0}),C.bind("afteraddingfile",function(b,c){console.info("After adding a file",c),a.uploader.queue.length+a.thisMedia.length>a.mediaset.numOfMedia&&(a.hasError=!0,a.errorText=A.tooManyImages,c.uploader.removeFromQueue(c)),c.file.mediasetFormData||(c.file.mediasetFormData={}),c.file.crop||(c.file.crop={}),c.file.rotation||(c.file.rotation=0)}),C.bind("whenaddingfilefailed",function(a,b){console.info("When adding a file failed",b)}),C.bind("afteraddingall",function(a,b){console.info("After adding all files",b)}),C.bind("beforeupload",function(c,d){console.info("Before upload",d),a.hasError=!1,a.mediasetError=!1,a.errorText=null,a.isLoading||b.$broadcast("loading-started-hard"),d.sequenceNumber=w,d.url=n+"upload/"+u+"/"+a.mediaset.numOfMedia+"/"+d.sequenceNumber+"/"+a.application.defaultImgFieldExt}),C.bind("progress",function(a,b,c){console.info("Progress: "+c,b)}),C.bind("success",function(b,c,d,e){var f=new Date;f.setMonth(f.getMonth()+a.mediaset.mediaSetExpiration),y.media||(y.media=[]),w++}),C.bind("cancel",function(a,b,c){console.info("Cancel",b,c)}),C.bind("error",function(b,c,d,e){console.info("Error",c,d,e),a.hasError=!0,a.errorText=A.uploadFailed,d.uploader.removeFromQueue(d)}),C.bind("complete",function(b,c,d,e){console.log("starting"),console.info("Complete",c,d,e),console.log("extensionsList",e.data.extensionsList),a.fileExtentions="."+a.application.defaultImgFieldExt,m.debug({message:"File Info",response:e.data}),e.data.extensionsList&&null!=e.data.extensionsList[0]?(a.fileExtentions=e.data.extensionsList[0],console.log("file ext"+a.fileExtentions)):console.log("use default file ext"+a.fileExtentions),null!=e.data.duration&&(a.duration=e.data.duration)}),C.bind("progressall",function(a,b){console.info("Total progress: "+b)}),C.bind("completeall",function(a,c){console.info("Complete all",c),b.$broadcast("loading-complete-hard")})}]),angular.module("pupApp.directives",[]).directive("ngThumb",["$window",function(a){var b={support:!(!a.FileReader||!a.CanvasRenderingContext2D),isFile:function(b){return angular.isObject(b)&&b instanceof a.File},isImage:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|pdf|".indexOf(b)},isDoc:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|pdf|doc|docx|txt|csv|ppt|xlsx|plain|vnd.openxmlformats-officedocument.wordprocessingml.document|rtf|".indexOf(b)},isVid:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|avi|mov|mp4|wmv|".indexOf(b)}};return{restrict:"A",template:"<canvas/>",link:function(a,c,d){function e(b){var c=a.img=new Image;c.onload=f,c.src=b.target.result}function f(){var a=g.width||this.width/this.height*g.height,b=g.height||this.height/this.width*g.width;h.attr({width:a,height:b}),h[0].getContext("2d").drawImage(this,0,0,a,b)}if(b.support){var g=a.$eval(d.ngThumb);if(b.isFile(g.file)&&b.isImage(g.file)&&b.isDoc(g.file)&&b.isVid(g.file)){var h=c.find("canvas"),i=new FileReader;i.onload=e,i.readAsDataURL(g.file)}}}}}]).directive("loadingIndicator",function(){return{restrict:"A",template:'<div class="loading"><div id="circleG"><div id="circleG_1" class="circleG"></div><div id="circleG_2" class="circleG"></div><div id="circleG_3" class="circleG"></div></div></div>',link:function(a,b,c){a.$on("loading-started",function(c){b.css({display:""}),a.isLoading=!0}),a.$on("loading-started-hard",function(c){b.css({display:""}),a.isLoading=!0,a.isLoadingHard=!0}),a.$on("loading-complete",function(c){a.isLoadingHard||(b.css({display:"none"}),a.isLoading=!1)}),a.$on("loading-complete-hard",function(c){b.css({display:"none"}),a.isLoading=!1,a.isLoadingHard=!1})}}}).directive("dropZoneIcon",["$compile",function(a){var b={imageIcon:'<i class="fa fa-file-image-o glyphicon-pic-size"></i><br>',documentIcon:'<i class="fa fa-file-text glyphicon-pic-size"></i><br>',videoIcon:'<i class="fa fa-file-video-o glyphicon-pic-size"></i><br>',audioIcon:'<i class="fa fa-file-audio-o glyphicon-pic-size"></i><br>'},c=function(a){var c={};return"undefined"!=typeof c&&null!=c?c=b[a+"Icon"]:""};return{restrict:"E",replace:!0,scope:{mediaType:"="},link:function(b,d,e){b.$watchCollection("mediaType",function(e){void 0!=e&&(d.html(c(e)).show(),a(d.contents())(b))})}}}]).directive("dropZoneFileType",["$compile",function(a){var b={imageFileType:"jpg, png, jpeg, bmp, gif",documentFileType:"pdf, doc, docx, txt, csv, ppt, pptx, xlsx, plain, rtf",videoFileType:"avi, mov, mp4, wmv",audioFileType:"wav, mp3, mp4, mid, wma"},c=function(a){var c={};return"undefined"!=typeof c&&null!=c?c=b[a+"FileType"]:""};return{restrict:"E",replace:!0,scope:{mediaType:"="},link:function(b,d,e){b.$watchCollection("mediaType",function(e){void 0!=e&&(d.html(c(e)).show(),a(d.contents())(b))})}}}]).directive("dropZoneButton",["$compile",function(a){var b={imageSingleButton:'<input ng-file-select type="file" id="uploadBtn" accept="image/*">',imageButton:'<input ng-file-select type="file" id="uploadBtn" multiple accept="image/*">',documentButton:'<input ng-file-select type="file" id="uploadBtn">',videoButton:'<input ng-file-select type="file" id="uploadBtn" accept="video/*">',audioButton:'<input ng-file-select type="file" id="uploadBtn" accept="audio/*">'},c=function(a,c){var d={};return"undefined"!=typeof d&&null!=d?d="image"==a&&1==c?b[a+"SingleButton"]:b[a+"Button"]:""};return{restrict:"E",replace:!0,scope:{mediaType:"=",num:"="},link:function(b,d,e){b.$watchCollection("mediaType",function(e){void 0!=e&&(d.html(c(e,b.num)).show(),a(d.contents())(b))})}}}]).directive("fileExt",["$compile",function(a){var b={pdf:'<i class="fa fa-file-pdf-o glyphicon-pic-size"></i>',doc:'<i class="fa fa-file-word-o glyphicon-pic-size"></i>',docx:'<i class="fa fa-file-word-o glyphicon-pic-size"></i>',xlsx:'<i class="fa fa-file-excel-o glyphicon-pic-size"></i>',csv:'<i class="fa fa-file-excel-o glyphicon-pic-size"></i>',pptx:'<i class="fa fa-file-powerpoint-o glyphicon-pic-size"></i>',txt:'<i class="fa fa-file-text-o glyphicon-pic-size"></i>',other:'<i class="fa fa-file-text-o glyphicon-pic-size"></i>'},c=function(a){var c={};return a=a.slice(1),c="undefined"!=typeof c&&null!=c?b[a]:b.other};return{restrict:"E",replace:!0,scope:{type:"="},link:function(b,d,e){b.$watchCollection("type",function(e){void 0!=e&&(d.html(c(e)).show(),a(d.contents())(b))})}}}]),angular.module("hostedApp.directives",["ui.bootstrap","ngResource","subPlatformServices"]).directive("subFormfield",["$compile","$filter","$http","$sce","subService","formService",function(a,b,c,d,e,f){var g={radioTemplate:'<div class="form-group"><label>{{content.fieldName}}</label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="content.isMandatory && model==null && submitted" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p>  <div class="radio" ng-repeat="field in content.fieldTypeOptions.split(\',\') track by $index" ng-hide="content.isConditional"><label for="{{content.uniqueId}}_{{$index}}"><input type="radio" name="{{content.uniqueId}}" ng-value="field" ng-model="$parent.model" id="{{content.uniqueId}}_{{$index}}" ng-required="content.isMandatory"/> {{field}}</label> </div><div class="" ng-show="content.isConditional"><div class="radio" ng-repeat="option in content.fieldTypeOptionsArray"><label><input type="radio" name="{{content.uniqueId}}" ng-value="option" id="{{option.optionId}}" ng-model="$parent.model" ng-required="content.isMandatory">{{option.optionValue}}</label></div><div ng-repeat="option in content.fieldTypeOptionsArray"><sub-formfield form-id="formId" content="condField" model="submission.formData[condField.uniqueId]" submission="submission" application="application" ng-repeat="condField in option.conditionalFields" submitted="submitted" ng-if="$parent.model==option"> </sub-formfield></div></div></div>',hiddenTemplate:'<input type="hidden" class="sub_{{content.fieldType}}" name="{{content.uniqueId}}" placeholder="{{content.placeholder}}">',textTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.text.$error.required && !form.text.$pristine) || (form.text.$error.required && submitted)" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p>  <input type="text" ng-model="model" name="text" class="form-control" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" id="{{content.uniqueId}}"/> </div></ng-form>',
numberTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}} </label><span ng-if="content.min || content.max">  (Between {{content.min}} - {{content.max}})</span> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.number.$error.required && !form.number.$pristine)||(form.number.$error.required && submitted)" class="text-danger">This field is required.</span> <span ng-show="(form.number.$error.number && !form.number.$pristine)||(form.number.$error.number && submitted)" class="text-danger">This field must be a number.</span> <span ng-show="(form.number.$error.min && !form.number.$pristine)||(form.number.$error.min && submitted)" class="text-danger">This number must be greater than or equal to {{content.min}}.</span><span ng-show="(form.number.$error.max && !form.number.$pristine)||(form.number.$error.max && submitted)" class="text-danger">This number must be less than or equal to {{content.max}}.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p> <input type="number" ng-model="model" min="{{content.min}}" max="{{content.max}}" name="number" id="{{content.uniqueId}}"  class="form-control" ng-required="content.isMandatory" placeholder="{{content.placeholder}}"/> </div></ng-form>',dateTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.date.$error.required && !form.date.$pristine)||(form.date.$error.required && submitted)" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p> <p class="input-group"><input type="text" id="{{content.uniqueId}}"  class="form-control" datepicker-popup="{{format}}" ng-model="model" is-open="opened" show-weeks="false" datepicker-options="dateOptions" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" close-text="Close" name="date" /><span class="input-group-btn"><button class="btn btn-default" ng-click="opened = true;$event.preventDefault();$event.stopPropagation();"><i class="fa fa-calendar"></i></button></span></p></div></ng-form>',pastDateTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.pastdate.$error.required && !form.pastdate.$pristine)||(form.pastdate.$error.required && submitted)" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p>  <p class="input-group"><input type="text" id="{{content.uniqueId}}"  class="form-control" datepicker-popup="{{format}}" ng-model="model" is-open="opened" max-date="now" show-weeks="false" datepicker-options="dateOptions" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" close-text="Close" name="pastdate"/><span class="input-group-btn"><button class="btn btn-default" ng-click="opened = true;$event.preventDefault();$event.stopPropagation();"><i class="fa fa-calendar"></i></button></span></p></div></ng-form>',futureDateTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.futuredate.$error.required && !form.futuredate.$pristine)||(form.futuredate.$error.required && submitted)" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p>  <p class="input-group"><input type="text" id="{{content.uniqueId}}"  class="form-control" datepicker-popup="{{format}}" ng-model="model" is-open="opened" min-date="now" show-weeks="false" datepicker-options="dateOptions" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" close-text="Close" name="futuredate"/><span class="input-group-btn"><button class="btn btn-default" ng-click="opened = true;$event.preventDefault();$event.stopPropagation();"><i class="fa fa-calendar"></i></button></span></p></div></ng-form>',dobCheckTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.dobCheck.$error.required && !form.dobCheck.$pristine)||(form.dobCheck.$error.required && submitted)" class="text-danger">This field is required.</span><span class="text-danger" ng-show="form.dobCheck.$error.dobcheck"> You must be {{content.minAge}} years or older.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p>  <p class="input-group"><input type="text" id="{{content.uniqueId}}"  class="form-control" datepicker-popup="{{format}}" ng-model="model" is-open="opened" dobcheck="{{maxDate}}" max-date="now" show-weeks="false" datepicker-options="dateOptions" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" close-text="Close" name="dobCheck"/><span class="input-group-btn"><button class="btn btn-default" ng-click="opened = true;$event.preventDefault();$event.stopPropagation();"><i class="fa fa-calendar"></i></button></span></p></div></ng-form>',sectionHeaderTemplate:'<h3 class="section-header">{{content.fieldName}}<small><p class="help-block" ng-bind-html="content.descriptionSafe"></p></small></h3> ',subSectionHeaderTemplate:'<h4 class="sub-section-header">{{content.fieldName}}<small><p class="help-block" ng-bind-html="content.descriptionSafe"></p></small></h4> ',subNameTemplate:"<h4>{{content.fieldName}}</h4> ",subDescTemplate:"<h5>{{content.fieldName}}</h5> ",trueFalseTemplate:'<div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="content.isMandatory && model==null && submitted" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p> <div class="radio"> <label><input type="radio" name="{{content.uniqueId}}" value="true" ng-model="model" ng-required="content.isMandatory" placeholder="{{content.placeholder}}"/> True </label> </div><div class="radio"><label><input type="radio" name="{{content.uniqueId}}" value="false" ng-required="content.isMandatory"/> False </label> </div></div>',yesNoTemplate:'<div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="content.isMandatory && model==null && submitted" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p> <div class="radio"> <label><input type="radio" name="{{content.uniqueId}}" value="yes" ng-model="model" ng-required="content.isMandatory" placeholder="{{content.placeholder}}"/> Yes </label> </div><div class="radio"><label><input type="radio" name="{{content.uniqueId}}" value="no" ng-model="model" ng-required="content.isMandatory"/> No </label> </div></div>',dropdownTemplate:'<div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span><span ng-show="content.isMandatory && model==null && submitted" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p>  <select ng-hide="content.isConditional" ng-model="model" ng-options="option for option in content.fieldTypeOptions.split(\',\')" name="dropdown" id="{{content.uniqueId}}"  class="form-control" ng-required="content.isMandatory" > <option value="">-- Select an option --</option> </select><select ng-show="content.isConditional" ng-model="model" ng-options="option.optionValue as option.optionValue for option in content.fieldTypeOptionsArray" name="{{content.uniqueId}}" id="{{content.uniqueId}}"  class="form-control" ng-required="content.isMandatory" > <option value="">-- Select an option --</option> </select><div ng-repeat="option in content.fieldTypeOptionsArray"><sub-formfield form-id="formId" content="condField" model="submission.formData[condField.uniqueId]" submission="submission" application="application" ng-repeat="condField in option.conditionalFields" submitted="submitted" ng-if="model==option.optionValue"> </sub-formfield></div></div>',emailTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.email.$error.required && !form.email.$pristine)||(form.email.$error.required && submitted)" class="text-danger">This field is required.</span> <span ng-show="(form.email.$error.pattern && !form.email.$pristine)||(form.email.$error.pattern && submitted)" class="text-danger">This is not a valid email.</span> <p class="help-block" ng-bind-html="content.descriptionSafe"></p><input type="email" ng-pattern="/^[a-z0-9!#$%&\'*+/=?^_`{|}~.-]+@[a-z0-9-]+\\.[a-z0-9-]/i" ng-model="model" name="email" id="{{content.uniqueId}}"  class="form-control" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" /> </div></ng-form>',checkboxTemplate:'<ng-form name="form"><div class="form-group"><label>{{content.fieldName}}</label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="cblength > 0 && content.isMandatory && submitted" class="text-danger">Please check at least one.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p>  <div class="checkbox" ng-repeat="field in content.fieldTypeOptions.split(\',\')" ng-init="$parent.model = $parent.model || {}"><label><input ng-model="$parent.model[field]" type="checkbox" name="{{content.uniqueId}}"/> {{field}} <input type="text" class="form-control" ng-show="$last && content.hasOtherField" ng-model="$parent.model[\'otherVal\']" ng-disabled="!$parent.model[\'Other\']"></label> </div></div></ng-form>',textareaTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.textarea.$error.required && !form.textarea.$pristine)||(form.textarea.$error.required && submitted)" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p> <textarea ng-model="model" name="textarea" id="{{content.uniqueId}}"  class="form-control" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" maxlength="{{content.textareaCharLimit}}"></textarea> <span ng-show="content.textareaCharLimit" class="textarea-char-limit">Max Number of Characters: {{content.textareaCharLimit}}</span></div></ng-form>',mediaSetDocTemplate:'<ng-form name="form"><div class="form-group mediaset-box"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="form.mediasetDoc.$error.required && submitted" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p> <br><button class="btn btn-success" type="button" ng-click="createMediaSetModal()">Attach Document</button> <span ng-show="docNotUploaded"><em>Please upload a document</em></span><span ng-show="isDocUploaded"><i class="fa fa-check"></i></span><br><br><div media-preview="timestamp" submission-id="{{submission._id}}" mediaset-id="{{content.mediaSetId}}" num-of-media="{{numOfMedia}}"></div></div><input type="hidden" ng-model="model" name="uniqueUploadId.{{content.fieldType}}" value="{{uuId}}"/><input type="hidden" name="transfered.{{content.fieldType}}" value="false"><input type="hidden" name="mediasetId.{{content.fieldType}}" value="false"><input type="hidden" ng-model="isDocUploaded" name="mediasetDoc" ng-required="content.isMandatory" /><div class="modal fade hosted-modal" id="{{uuId}}_hostedModal"><div class="modal-dialog"><div class="modal-content"><button type="button" ng-click="modalClosed()" class="close" data-dismiss="modal" aria-hidden="true">Close</button><iframe></iframe></div></div></div><hr></ng-form>',mediaSetVidTemplate:'<ng-form name="form"><div class="form-group mediaset-box"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="form.mediasetVid.$error.required && submitted" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p> <br><button class="btn btn-success" type="button" ng-click="createMediaSetModal()">Attach Video</button> <span ng-show="vidNotUploaded"><em>Please upload a video</em></span><span ng-show="isVidUploaded"><i class="fa fa-check"></i></span><br><br><div media-preview="timestamp" submission-id="{{submission._id}}" mediaset-id="{{content.mediaSetId}}" num-of-media="{{numOfMedia}}"></div></div><input type="hidden" ng-model="model" name="uniqueUploadId.{{content.fieldType}}" value="{{uuId}}"/><input type="hidden" name="transfered.{{content.fieldType}}" value="false"><input type="hidden" name="mediasetId.{{content.fieldType}}" value="false"><input type="hidden" ng-model="isVidUploaded" name="mediasetVid" ng-required="content.isMandatory" /><div class="modal fade hosted-modal" id="{{uuId}}_hostedModal"><div class="modal-dialog"><div class="modal-content"><button type="button" ng-click="modalClosed()" class="close" data-dismiss="modal" aria-hidden="true">Close</button><iframe></iframe></div></div></div><hr></ng-form>',mediaSetAudioTemplate:'<ng-form name="form"><div class="form-group mediaset-box"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="form.mediasetAudio.$error.required && submitted" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p> <br><button class="btn btn-success" type="button" ng-click="createMediaSetModal()">Attach Audio File</button> <span ng-show="audioNotUploaded"><em>Please upload a video</em></span><span ng-show="isAudioUploaded"><i class="fa fa-check"></i></span><br><br><div media-preview="timestamp" submission-id="{{submission._id}}" mediaset-id="{{content.mediaSetId}}" num-of-media="{{numOfMedia}}"></div></div><input type="hidden" ng-model="model" name="uniqueUploadId.{{content.fieldType}}" value="{{uuId}}"/><input type="hidden" name="transfered.{{content.fieldType}}" value="false"><input type="hidden" name="mediasetId.{{content.fieldType}}" value="false"><input type="hidden" ng-model="isAudioUploaded" name="mediasetAudio" ng-required="content.isMandatory" /><div class="modal fade hosted-modal" id="{{uuId}}_hostedModal"><div class="modal-dialog"><div class="modal-content"><button type="button" ng-click="modalClosed()" class="close" data-dismiss="modal" aria-hidden="true">Close</button><iframe></iframe></div></div></div><hr></ng-form>',mediaSetTemplate:'<ng-form name="form"><div class="form-group mediaset-box"><label for="{{formId}}_{{content.fieldName}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="numOfMedia==1"><em>You can upload {{numOfMedia}} image</em></span><span ng-show="numOfMedia>1"><em>You can attach up to {{numOfMedia}} images</em></span> <span ng-show="form.mediaset.$error.required && submitted" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p> <br><button class="btn btn-success" type="button" ng-click="createMediaSetModal()">Attach Photo(s)</button><br><br><div media-preview="timestamp" submission-id="{{submission._id}}" mediaset-id="{{content.mediaSetId}}" num-of-media="{{numOfMedia}}"></div></div><input type="hidden" ng-model="model" name="uniqueUploadId.{{content.fieldType}}" value="{{uuId}}"/><input type="hidden" name="mediaset" ng-model="isPhotoUploaded" ng-required="content.isMandatory" /><input type="hidden" name="transfered.{{content.fieldType}}" value="false"><input type="hidden" name="mediasetId.{{content.fieldType}}" value="false"><div class="modal fade hosted-modal" id="{{uuId}}_hostedModal"><div class="modal-dialog"><div class="modal-content"><button type="button" ng-click="modalClosed()" class="close" data-dismiss="modal" aria-hidden="true">Close</button><iframe></iframe></div></div></div><hr></ng-form>',firstAndLastNameTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.name_first.$error.required && !form.name_first.$pristine)|| (form.name_last.$error.required && !form.name_last.$pristine)||(form.name_first.$error.required && submitted)|| (form.name_last.$error.required && submitted)" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p>  <br><div class="row"><div class="col-sm-6"><input type="text" name="name_first" class="form-control" ng-required="content.isMandatory" ng-model="content.fandLName_first" ng-change="concatName()"/><p class="help-block">First</p></div><div class="col-sm-6"><input type="text" name="name_last" class="form-control" ng-required="content.isMandatory" ng-model="content.fandLName_last" ng-change="concatName()"/><p class="help-block">Last</p></div></div></div></ng-form>',phoneNumberTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.phnum_areacode.$error.required && !form.phnum_areacode.$pristine)|| (form.phnum_prefix.$error.required && !form.phnum_prefix.$pristine) || (form.phnum_linenum.$error.required && !form.phnum_linenum.$pristine)||(form.phnum_areacode.$error.required && submitted)|| (form.phnum_prefix.$error.required && submitted) || (form.phnum_linenum.$error.required && submitted)" class="text-danger">This field is required.</span> <span ng-show="(form.phnum_areacode.$error.pattern )|| (form.phnum_prefix.$error.pattern) || (form.phnum_linenum.$error.pattern)" class="text-danger">This field must be a number and the correct length.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p><br><div class="row"><div class="col-sm-2 phone-num"><input type="text" ng-model="content.phNum_areacode" name="phnum_areacode" id="{{content.uniqueId}}" class="form-control" ng-required="content.isMandatory" ng-change="concatPhNum()" min="0" max="999" ng-pattern="/^[0-9]{3,3}$/"/  ng-maxlength="3" tabindex="{{index*1000}}" auto-next><p class="help-block">###</p></div><div class="col-sm-1 em-dash">&#8212;</div><div class="col-sm-2 phone-num"><input type="text" ng-model="content.phNum_prefix" name="phnum_prefix" id="{{content.uniqueId}}" class="form-control" ng-required="content.isMandatory" ng-change="concatPhNum()" min="0" max="999" ng-pattern="/^[0-9]{3,3}$/"/  ng-maxlength="3"  tabindex="{{(index*1000)+1}}" auto-next><p class="help-block">###</p></div><div class="col-sm-1 em-dash">&#8212;</div><div class="col-sm-2 phone-num"><input type="text" ng-model="content.phNum_linenum" name="phnum_linenum" id="{{content.uniqueId}}" class="form-control" ng-required="content.isMandatory" ng-change="concatPhNum()" min="0" max="9999" ng-pattern="/^[0-9]{4,4}$/"/ ng-maxlength="4"  tabindex="{{(index*1000)+2}}" auto-next><p class="help-block">####</p></div></div></div></ng-form>',addressTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.address1.$error.required && !form.address1.$pristine)|| (form.city.$error.required && !form.city.$pristine) || (form.postalcode.$error.required && !form.postalcode.$pristine)||(form.address1.$error.required && submitted)|| (form.city.$error.required && submitted) || (form.postalcode.$error.required && submitted)" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p><br><div class="row"><div class="col-sm-12"><input type="text" class="form-control" ng-model="content.address_address1" ng-change="concatAddress()" ng-required="content.isMandatory" name="address1"><p class="help-block">Street Address</p></div></div><div class="row"><div class="col-sm-12"><input type="text" class="form-control" ng-model="content.address_address2" ng-change="concatAddress()"><p class="help-block">Address Line 2</p></div></div><div class="row"><div class="col-sm-6"><input type="text" name="city" class="form-control" ng-model="content.address_city" ng-change="concatAddress()" ng-required="content.isMandatory"><p class="help-block">City</p></div><div class="col-sm-6"><input type="text" class="form-control"  ng-model="content.address_state" ng-change="concatAddress()" ng-hide="isUS"><select class="form-control" ng-model="content.address_usState" ng-options="state.name for state in states track by state.abbreviation" ng-show="isUS" ng-change="concatAddress()" ng-init="content.address_usState.abbreviation=defaultState"><option value="">--choose--</option></select><p class="help-block">State/Province/Region</p></div></div><div class="row"><div class="col-sm-6"><input type="text" name="postalcode" class="form-control" ng-model="content.address_postalcode" ng-change="concatAddress()" ng-required="content.isMandatory"><p class="help-block">Postal Code</p></div><div class="col-sm-6"><select class="form-control" ng-options="country.name for country in countries track by country.name" ng-model="content.address_country" ng-change="concatAddress()" ng-init="content.address_country.name=defaultCountry" ng-required="content.isMandatory"><option value="">--choose--</option></select><p class="help-block">Country</p></div></div></div></ng-form>',timeTemplate:'<div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label><span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.time.$error.required && !form.time.$pristine)||(form.time.$error.required && submitted)" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p><p class="input-group"><timepicker ng-model="model" id="{{content.uniqueId}}" name="time"></timepicker></p></div>',parameterTemplate:'<ng-form name="form"><div class="form-group"><label for="{{content.uniqueId}}" >{{content.fieldName}}</label> <span ng-show="content.isMandatory" class="sub_reqText">*</span> <span ng-show="(form.text.$error.required && !form.text.$pristine) || (form.text.$error.required && submitted)" class="text-danger">This field is required.</span><p class="help-block" ng-bind-html="content.descriptionSafe"></p>  <input type="text" ng-model="model" name="text" class="form-control" ng-required="content.isMandatory" placeholder="{{content.placeholder}}" id="{{content.uniqueId}}"/> </div></ng-form>'},h=function(a){var b={};return b=a.isPublic?g[a.fieldType+"Template"]:g.hiddenTemplate,"undefined"!=typeof b&&null!=b?b:""},i=function(b,f,g,i){function j(){return $(document).height()-80}if(b.formInfo=i,b.content.descriptionSafe=d.trustAsHtml(b.content.description),b.content.isPublic){if("futureDate"===b.content.fieldType||"pastDate"===b.content.fieldType)b.now=new Date;else if("time"===b.content.fieldType)b.model=new Date;else if("checkbox"==b.content.fieldType)b.content.hasOtherField&&(b.content.fieldTypeOptions=b.content.fieldTypeOptions+",Other"),b.cblength=b.content.fieldTypeOptions.split(",").length;else if("phoneNumber"==b.content.fieldType)b.concatPhNum=function(){var a=b.content.phNum_areacode?b.content.phNum_areacode:"",c=b.content.phNum_prefix?b.content.phNum_prefix:"",d=b.content.phNum_linenum?b.content.phNum_linenum:"";b.submission.formData[b.content.uniqueId]=a+"-"+c+"-"+d};else if("firstAndLastName"==b.content.fieldType)b.concatName=function(){var a=b.content.fandLName_first?b.content.fandLName_first:"",c=b.content.fandLName_last?b.content.fandLName_last:"";b.submission.formData[b.content.uniqueId]=a+"|"+c};else if("address"===b.content.fieldType)c.get("/javascripts/vendors/countries.json").success(function(a,c){b.countries=a}).error(function(){}),c.get("/javascripts/vendors/us-states.json").success(function(a,c){b.states=a}).error(function(){}),b.defaultCountry="United States",b.defaultState="DC",b.isUS=!0,b.concatAddress=function(){var a,c=b.content.address_address1?b.content.address_address1:"",d=b.content.address_address2?b.content.address_address2:"",e=b.content.address_city?b.content.address_city:"",f=b.content.address_postalcode?b.content.address_postalcode:"",g=b.content.address_country.name;"United States"==g?(b.isUS=!0,a=b.content.address_usState?b.content.address_usState.abbreviation:""):(b.isUS=!1,a=b.content.address_state?b.content.address_state:""),b.submission.formData[b.content.uniqueId]=c+", "+d+", "+e+","+a+", "+f+","+g};else if("radio"===b.content.fieldType||"dropdown"===b.content.fieldType)b.content.isConditional?b.condFields=b.$parent.model={}:b.content.hasOtherField&&(b.content.fieldTypeOptions=b.content.fieldTypeOptions+",Other");else if("dobCheck"===b.content.fieldType){var k=new Date;k=new Date(k.getFullYear()-b.content.minAge,k.getMonth(),k.getDate()),b.maxDate=k.toISOString(),b.now=new Date}else if("mediaSet"===b.content.fieldType||"mediaSetDoc"===b.content.fieldType||"mediaSetVid"===b.content.fieldType||"mediaSetAudio"===b.content.fieldType){if(b.$on("checkDraftForUploads",function(a,c){b.checkDraftForUploads(c)}),"mediaSet"===b.content.fieldType)for(var l=b.content.mediaSetId,m=0;m<b.application.mediaSets.length;m++)l==b.application.mediaSets[m]._id&&(b.numOfMedia=b.application.mediaSets[m].numOfMedia);else b.numOfMedia=1;null==b.uuId&&(b.submission.mediasets[b.content.mediaSetId]&&b.submission.mediasets[b.content.mediaSetId].uniqueUploadId&&(b.uuId=b.submission.mediasets[b.content.mediaSetId].uniqueUploadId),b.uuId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)}));var n="/"+b.formId+"/"+b.content.mediaSetId+"/"+b.uuId+"/pup";b.checkDraftForUploads=function(a){b.timestamp=(new Date).getTime(),c.get("/"+a._id+"/"+b.content.mediaSetId+"/mediaset.json",{}).success(function(a,c){null!=a[0].mediasets[0].media&&a[0].mediasets[0].media.length>0?"mediaSetVid"==b.content.fieldType?(b.isVidUploaded=!0,b.vidNotUploaded=!1):"mediaSetDoc"==b.content.fieldType?(b.isDocUploaded=!0,b.docNotUploaded=!1):"mediaSetAudio"==b.content.fieldType&&(b.isAudioUploaded=!0,b.docAudioUploaded=!1):"mediaSetVid"==b.content.fieldType?(b.content.isMandatory&&(b.vidNotUploaded=!0),b.isVidUploaded=""):"mediaSetDoc"==b.content.fieldType?(b.content.isMandatory&&(b.docNotUploaded=!0),b.isDocUploaded=""):"mediaSetAudio"==b.content.fieldType&&(b.content.isMandatory&&(b.audioNotUploaded=!0),b.isAudioUploaded="")})},b.modalClosed=function(){b.timestamp=(new Date).getTime(),c.get("/"+b.submission._id+"/"+b.content.mediaSetId+"/mediaset.json",{}).success(function(a,c){null!=a[0].mediasets[0].media&&a[0].mediasets[0].media.length>0?"mediaSetVid"==b.content.fieldType?(b.isVidUploaded=!0,b.vidNotUploaded=!1):"mediaSetDoc"==b.content.fieldType?(b.isDocUploaded=!0,b.docNotUploaded=!1):"mediaSetAudio"==b.content.fieldType&&(b.isAudioUploaded=!0,b.docAudioUploaded=!1):"mediaSetVid"==b.content.fieldType?(b.content.isMandatory&&(b.vidNotUploaded=!0),b.isVidUploaded=""):"mediaSetDoc"==b.content.fieldType?(b.content.isMandatory&&(b.docNotUploaded=!0),b.isDocUploaded=""):"mediaSetAudio"==b.content.fieldType&&(b.content.isMandatory&&(b.audioNotUploaded=!0),b.isAudioUploaded="")}).error(function(){})},b.createMediaSetModal=function(){b.timestamp=(new Date).getTime();for(var a,c=0;c<b.application.mediaSets.length;c++)b.application.mediaSets[c].hasOwnProperty("_id")&&b.application.mediaSets[c]._id==b.content.mediaSetId&&(b.numOfMedia=b.application.mediaSets[c].numOfMedia,a=c);b.submission.mediasets[b.content.mediaSetId]={},b.submission.mediasets[b.content.mediaSetId].uniqueUploadId=b.uuId,b.submission.mediasets[b.content.mediaSetId].transfered=!1,b.submission.mediasets[b.content.mediaSetId].mediasetId=b.content.mediaSetId,null==b.submission._id?e.createEmptySubmission(b.submission,function(a){function c(a){a.originalEvent.origin===a.originalEvent.data&&(b.modalClosed(),$("#"+b.uuId+"_hostedModal").modal("hide"))}b.submission._id=a.submissionInfo._id,n="/"+b.formId+"/"+b.content.mediaSetId+"/"+b.uuId+"/"+b.submission._id+"/pup";var d=j();d>800&&(d=800),$("#"+b.uuId+"_hostedModal iframe").css("height",d).attr("src",n),$("#"+b.uuId+"_hostedModal").modal(),$(window).on("message",c)},function(){}):e.updateSub(b.submission,function(a){var c="/"+b.formId+"/"+b.content.mediaSetId+"/"+b.uuId+"/"+b.submission._id+"/pup",d=j();$("#"+b.uuId+"_hostedModal iframe").css("height",d).attr("src",c),$("#"+b.uuId+"_hostedModal").modal()},function(){})}}f.html(h(b.content)).show()}else f.html(h("hidden")).show();a(f.contents())(b)};return{restrict:"E",require:"^form",replace:!0,link:i,scope:{content:"=",formId:"=?",submission:"=",application:"=",model:"=?",submitted:"=?",index:"=?"}}}]).directive("errSrc",function(){return{link:function(a,b,c){b.bind("error",function(){c.src!=c.errSrc&&c.$set("src",c.errSrc)})}}}).directive("photoPreview",["$timeout","$http","$compile",function(a,b,c){return function(a,d,e){var f="";parseInt(e.mediasetId)>0&&(f="/"+e.mediasetId);"//sub-cdn.washingtonpost.com/"+e.submissionId+f+"/0_thumb";a.$watch(e.photoPreview,function(g){for(var h=0,i="<br><div class='row' ><ul class='list-unstyled'>";h<e.numOfMedia;)i+="<li class='col-md-3'><br><img src='//sub-cdn.washingtonpost.com/"+e.submissionId+f+"/"+h+"_thumb?"+g+"' err-src='/images/no-image-available.png' alt='image'/></li>",h++;i+="</ul></div>",b.get("//sub-cdn.washingtonpost.com/"+e.submissionId+f+"/0_thumb",{}).success(function(b,e){a.isPhotoUploaded=!0;c(i)(a,function(a,b){d.html(a)})}).error(function(){})})}}]).directive("mediaPreview",["$timeout","$http","$compile",function(a,b,c){return function(a,d,e){a.$watch(e.mediaPreview,function(f){e.submissionId&&b.get("/"+e.submissionId+"/"+e.mediasetId+"/mediaset.json").success(function(b){for(var e=b[0].mediasets[0].media,f="",g=0;g<e.length;g++)f+=e[g].hasOwnProperty("mediaUrlThumb")?"<li><img class='photo-preview' src='"+e[g].mediaUrlThumb+"'></li>":"<li>"+e[g].originalName+": <a href='"+e[g].mediaUrl+"' target='_blank'>http:"+e[g].mediaUrl+"</a></li>",console.log("mediasetType is "+e[g].mediaSetType),"image"==e[g].mediaSetType&&(a.isPhotoUploaded=!0);c("<ul class='list-unstyled'>"+f+"</ul>")(a,function(a,b){d.html(a)})})})}}]).directive("dobcheck",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.unshift(function(a){var b=new Date(a).toISOString();return d.$setValidity("dobcheck",c.dobcheck>=b),a})}}}).directive("autoNext",function(){return{restrict:"A",link:function(a,b,c,d){var e=parseInt(c.tabindex),f=parseInt(c.ngMaxlength);b.on("keyup",function(a){if(b.val().length>f-1){var c=angular.element(document.body).find("[tabindex="+(e+1)+"]");return c.length>0?(c.focus(),c.triggerHandler("keyup",{which:a.which})):!1}return!0})}}});var uuids=angular.module("uuids",[]);uuids.factory("rfc4122",function(){return{newuuid:function(){for(var a=[],b="0123456789abcdef",c=0;36>c;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);return a[14]="4",a[19]=b.substr(3&a[19]|8,1),a[8]=a[13]=a[18]=a[23]="-",a.join("")}}}),angular.module("loggingModuleServices",[]).factory("subLogService",["$log","$window",function(a,b){return{error:function(c,d){a.error.apply(a,arguments),$.ajax({type:"POST",url:"/clientErrorlogger",contentType:"application/json",data:angular.toJson({
url:b.location.href,message:c,type:"error"})})},debug:function(c,d){a.log.apply(a,arguments),$.ajax({type:"POST",url:"/clientDebuglogger",contentType:"application/json",data:angular.toJson({url:b.location.href,message:c,response:d,type:"debug"})})}}}]);
//# sourceMappingURL=pup.min.js.map